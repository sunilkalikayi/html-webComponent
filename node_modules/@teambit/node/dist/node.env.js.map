{"version":3,"names":["NodeEnvType","NodeEnv","constructor","tsAspect","reactAspect","getDependencies","devDependencies","getCompiler","transformers","tsModule","reactEnv","getTsCjsCompiler","getBuildPipe","modifiers","tsTransformers","tsModifier","compilerTask","getCjsCompilerTask","module","pipeWithoutCompiler","getBuildPipeWithoutCompiler","getTester","jestConfigPath","jestModulePath","config","require","resolve","getCjsJestTester","getPreviewConfig","strategyName","splitComponentBundle","getPackageJsonProps","getCjsPackageJsonProps","__getDescriptor","type"],"sources":["node.env.ts"],"sourcesContent":["import { DependenciesEnv, PackageEnv, PipeServiceModifier, PipeServiceModifiersMap } from '@teambit/envs';\nimport { VariantPolicyConfigObject } from '@teambit/dependency-resolver';\nimport { TsConfigTransformer, TypescriptMain } from '@teambit/typescript';\nimport { ReactMain } from '@teambit/react';\nimport { Tester } from '@teambit/tester';\nimport { BuildTask } from '@teambit/builder';\n\nexport const NodeEnvType = 'node';\n\ntype GetBuildPipeModifiers = PipeServiceModifiersMap & {\n  tsModifier?: PipeServiceModifier;\n};\nexport class NodeEnv implements DependenciesEnv, PackageEnv {\n  constructor(protected tsAspect: TypescriptMain, protected reactAspect: ReactMain) {}\n\n  icon = 'https://static.bit.dev/extensions-icons/nodejs.svg';\n\n  getDependencies(): VariantPolicyConfigObject {\n    return {\n      devDependencies: {\n        '@types/jest': '26.0.20',\n        '@types/node': '12.20.4',\n        // This is added as dev dep since our jest file transformer uses babel plugins that require this to be installed\n        '@babel/runtime': '7.12.18',\n      },\n    };\n  }\n\n  getCompiler(transformers: TsConfigTransformer[] = [], tsModule) {\n    return this.reactAspect.reactEnv.getTsCjsCompiler('dev', transformers, tsModule);\n  }\n\n  /**\n   * returns the component build pipeline.\n   */\n  getBuildPipe(modifiers: GetBuildPipeModifiers = {}): BuildTask[] {\n    const tsTransformers: TsConfigTransformer[] =\n      (modifiers?.tsModifier?.transformers as any as TsConfigTransformer[]) || [];\n    const compilerTask = this.reactAspect.reactEnv.getCjsCompilerTask(tsTransformers, modifiers?.tsModifier?.module);\n\n    const pipeWithoutCompiler = this.reactAspect.reactEnv.getBuildPipeWithoutCompiler();\n    return [compilerTask, ...pipeWithoutCompiler];\n  }\n\n  /**\n   * returns a component tester.\n   */\n  getTester(jestConfigPath: string, jestModulePath?: string): Tester {\n    const config = jestConfigPath || require.resolve('./jest/jest.config');\n    return this.reactAspect.reactEnv.getCjsJestTester(config, jestModulePath);\n  }\n\n  getPreviewConfig() {\n    return {\n      strategyName: 'component',\n      splitComponentBundle: false,\n    };\n  }\n\n  getPackageJsonProps() {\n    return this.tsAspect.getCjsPackageJsonProps();\n  }\n\n  async __getDescriptor() {\n    return {\n      type: NodeEnvType,\n    };\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;AAOO,MAAMA,WAAW,GAAG,MAAM;AAAC;AAK3B,MAAMC,OAAO,CAAwC;EAC1DC,WAAW,CAAWC,QAAwB,EAAYC,WAAsB,EAAE;IAAA,KAA5DD,QAAwB,GAAxBA,QAAwB;IAAA,KAAYC,WAAsB,GAAtBA,WAAsB;IAAA,8CAEzE,oDAAoD;EAFwB;EAInFC,eAAe,GAA8B;IAC3C,OAAO;MACLC,eAAe,EAAE;QACf,aAAa,EAAE,SAAS;QACxB,aAAa,EAAE,SAAS;QACxB;QACA,gBAAgB,EAAE;MACpB;IACF,CAAC;EACH;EAEAC,WAAW,CAACC,YAAmC,GAAG,EAAE,EAAEC,QAAQ,EAAE;IAC9D,OAAO,IAAI,CAACL,WAAW,CAACM,QAAQ,CAACC,gBAAgB,CAAC,KAAK,EAAEH,YAAY,EAAEC,QAAQ,CAAC;EAClF;;EAEA;AACF;AACA;EACEG,YAAY,CAACC,SAAgC,GAAG,CAAC,CAAC,EAAe;IAAA;IAC/D,MAAMC,cAAqC,GACzC,CAACD,SAAS,aAATA,SAAS,gDAATA,SAAS,CAAEE,UAAU,0DAArB,sBAAuBP,YAAY,KAAqC,EAAE;IAC7E,MAAMQ,YAAY,GAAG,IAAI,CAACZ,WAAW,CAACM,QAAQ,CAACO,kBAAkB,CAACH,cAAc,EAAED,SAAS,aAATA,SAAS,iDAATA,SAAS,CAAEE,UAAU,2DAArB,uBAAuBG,MAAM,CAAC;IAEhH,MAAMC,mBAAmB,GAAG,IAAI,CAACf,WAAW,CAACM,QAAQ,CAACU,2BAA2B,EAAE;IACnF,OAAO,CAACJ,YAAY,EAAE,GAAGG,mBAAmB,CAAC;EAC/C;;EAEA;AACF;AACA;EACEE,SAAS,CAACC,cAAsB,EAAEC,cAAuB,EAAU;IACjE,MAAMC,MAAM,GAAGF,cAAc,IAAIG,OAAO,CAACC,OAAO,CAAC,oBAAoB,CAAC;IACtE,OAAO,IAAI,CAACtB,WAAW,CAACM,QAAQ,CAACiB,gBAAgB,CAACH,MAAM,EAAED,cAAc,CAAC;EAC3E;EAEAK,gBAAgB,GAAG;IACjB,OAAO;MACLC,YAAY,EAAE,WAAW;MACzBC,oBAAoB,EAAE;IACxB,CAAC;EACH;EAEAC,mBAAmB,GAAG;IACpB,OAAO,IAAI,CAAC5B,QAAQ,CAAC6B,sBAAsB,EAAE;EAC/C;EAEA,MAAMC,eAAe,GAAG;IACtB,OAAO;MACLC,IAAI,EAAElC;IACR,CAAC;EACH;AACF;AAAC"}