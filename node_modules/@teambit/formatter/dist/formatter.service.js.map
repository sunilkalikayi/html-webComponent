{"version":3,"names":["FormatterService","constructor","formatterConfig","run","context","options","mergedOpts","optionsWithDefaults","formatterContext","mergeContext","formatter","env","getFormatter","results","check","format","defaults","Object","assign","render","descriptor","getDescriptor","id","displayName","version","config","highlight","language","ignoreIllegals","undefined","icon","displayConfig"],"sources":["formatter.service.tsx"],"sourcesContent":["import { defaults } from 'lodash';\nimport React from 'react';\nimport { EnvService, ExecutionContext, EnvDefinition } from '@teambit/envs';\nimport { Text, Newline } from 'ink';\nimport highlight from 'cli-highlight';\nimport { Formatter, FormatResults } from './formatter';\nimport { FormatterContext, FormatterOptions } from './formatter-context';\nimport { FormatterConfig } from './formatter.main.runtime';\n\nexport type FormatterServiceOptions = FormatterOptions & {\n  check?: boolean;\n};\n\nexport class FormatterService implements EnvService<FormatResults> {\n  name = 'formatter';\n\n  constructor(private formatterConfig: FormatterConfig) {}\n\n  async run(context: ExecutionContext, options: FormatterServiceOptions): Promise<FormatResults> {\n    const mergedOpts = this.optionsWithDefaults(options);\n    const formatterContext: FormatterContext = this.mergeContext(mergedOpts, context);\n    const formatter: Formatter = context.env.getFormatter(formatterContext);\n\n    const results = options.check ? await formatter.check(formatterContext) : await formatter.format(formatterContext);\n    return results;\n  }\n\n  private optionsWithDefaults(options: FormatterServiceOptions): FormatterServiceOptions {\n    return defaults(options, this.formatterConfig);\n  }\n\n  private mergeContext(options: FormatterServiceOptions, context?: ExecutionContext): FormatterContext {\n    const formatterContext: FormatterContext = Object.assign({}, options, context);\n    return formatterContext;\n  }\n\n  render(env: EnvDefinition) {\n    const descriptor = this.getDescriptor(env);\n\n    return (\n      <Text key={descriptor?.id}>\n        <Text color=\"cyan\">configured formatter: </Text>\n        <Text>\n          {descriptor?.id} ({descriptor?.displayName} @ {descriptor?.version})\n        </Text>\n        <Newline />\n        <Text color=\"cyan\">formatter config:</Text>\n        <Newline />\n        <Text>\n          {descriptor?.config && highlight(descriptor?.config, { language: 'javascript', ignoreIllegals: true })}\n        </Text>\n        <Newline />\n      </Text>\n    );\n  }\n\n  getDescriptor(env: EnvDefinition) {\n    if (!env.env.getFormatter) return undefined;\n    const mergedOpts = this.optionsWithDefaults({});\n    const formatterContext = this.mergeContext(mergedOpts);\n    const formatter = env.env.getFormatter(formatterContext);\n\n    return {\n      id: formatter.id,\n      icon: formatter.icon,\n      config: formatter.displayConfig ? formatter.displayConfig() : undefined,\n      version: formatter.version ? formatter.version() : '?',\n      displayName: formatter.displayName ? formatter.displayName : '?',\n    };\n  }\n}\n"],"mappings":"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"}