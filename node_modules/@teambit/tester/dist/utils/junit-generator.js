"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.testsResultsToJUnitFormat = testsResultsToJUnitFormat;
function _junitReportBuilder() {
  const data = _interopRequireDefault(require("junit-report-builder"));
  _junitReportBuilder = function () {
    return data;
  };
  return data;
}
function _stripAnsi() {
  const data = _interopRequireDefault(require("strip-ansi"));
  _stripAnsi = function () {
    return data;
  };
  return data;
}
function testsResultsToJUnitFormat(components) {
  const builder = _junitReportBuilder().default.newBuilder();
  components.forEach(compResult => {
    var _compResult$results, _compResult$results3;
    const suite = builder.testSuite().name(compResult.componentId.toString());
    if ((_compResult$results = compResult.results) !== null && _compResult$results !== void 0 && _compResult$results.start) {
      var _compResult$results2;
      suite.timestamp(new Date((_compResult$results2 = compResult.results) === null || _compResult$results2 === void 0 ? void 0 : _compResult$results2.start).toISOString());
    }
    (_compResult$results3 = compResult.results) === null || _compResult$results3 === void 0 ? void 0 : _compResult$results3.testFiles.forEach(testFile => {
      if (testFile.error) {
        const testCase = suite.testCase().className(testFile.file).name(testFile.file);
        testCase.error((0, _stripAnsi().default)(testFile.error.message));
      }
      testFile.tests.forEach(test => {
        const testCase = suite.testCase().className(testFile.file).name(test.name);
        if (test.error) {
          testCase.error((0, _stripAnsi().default)(test.error));
        }
        if (test.failure) {
          testCase.failure((0, _stripAnsi().default)(test.failure));
        }
        if (test.status === 'skipped' || test.status === 'pending') {
          testCase.skipped();
        }
        if (test.duration) {
          testCase.time(test.duration / 1000);
        }
      });
    });
  });
  return builder.build();
}

//# sourceMappingURL=junit-generator.js.map