{"version":3,"names":["createRoot","aspectDefs","rootExtensionName","rootAspect","UIAspect","id","runtime","config","rootId","identifiers","getIdentifiers","idSetters","getIdSetters","stringifiedConfig","toWindowsCompatiblePath","JSON","stringify","replace","createImports","join","defs","filter","def","runtimePath","getImportStatements","pathProp","suffix","map","aspectDef","getIdentifier","getId","undefined","val","component","local","getCoreIdentifier","aspectPath","getRegularAspectIdentifier","camelCase","parse","base","path","name","split"],"sources":["create-root.ts"],"sourcesContent":["import { AspectDefinition } from '@teambit/aspect-loader';\nimport { toWindowsCompatiblePath } from '@teambit/toolbox.path.to-windows-compatible-path';\nimport { camelCase } from 'lodash';\nimport { parse } from 'path';\n\nimport { UIAspect } from './ui.aspect';\n\nexport async function createRoot(\n  aspectDefs: AspectDefinition[],\n  rootExtensionName?: string,\n  rootAspect = UIAspect.id,\n  runtime = 'ui',\n  config = {}\n) {\n  const rootId = rootExtensionName ? `'${rootExtensionName}'` : '';\n  const identifiers = getIdentifiers(aspectDefs, 'Aspect');\n\n  const idSetters = getIdSetters(aspectDefs, 'Aspect');\n  config['teambit.harmony/bit'] = rootExtensionName;\n  // Escaping \"'\" in case for example in the config you have something like:\n  // description: \"team's scope\"\n  const stringifiedConfig = toWindowsCompatiblePath(JSON.stringify(config)).replace(/'/g, \"\\\\'\");\n\n  return `\n${createImports(aspectDefs)}\n\nconst isBrowser = typeof window !== \"undefined\";\nconst config = JSON.parse('${stringifiedConfig}');\n${idSetters.join('\\n')}\nexport default function render(...props){\n  return Harmony.load([${identifiers.join(', ')}], '${runtime}', config)\n    .then((harmony) => {\n      return harmony\n      .run()\n      .then(() => harmony.get('${rootAspect}'))\n      .then((rootExtension) => {\n        const ssrSetup = !isBrowser && rootExtension.setupSsr;\n        const setup = rootExtension.setup;\n        const setupFunc = (ssrSetup || setup || function noop(){}).bind(rootExtension);\n\n        return (\n          Promise.resolve(setupFunc())\n            .then(() => rootExtension)\n        );\n      })\n      .then((rootExtension) => {\n        if (isBrowser) {\n          return rootExtension.render(${rootId}, ...props);\n        } else {\n          return rootExtension.renderSsr(${rootId}, ...props);\n        }\n      })\n      .catch((err) => {\n        throw err;\n      });\n    });\n}\n\nif (isBrowser) render();\n`;\n}\n\nfunction createImports(aspectDefs: AspectDefinition[]) {\n  const defs = aspectDefs.filter((def) => def.runtimePath);\n\n  return `import { Harmony } from '@teambit/harmony';\n${getImportStatements(aspectDefs, 'aspectPath', 'Aspect')}\n${getImportStatements(defs, 'runtimePath', 'Runtime')}`;\n}\n\nfunction getImportStatements(aspectDefs: AspectDefinition[], pathProp: string, suffix: string): string {\n  return aspectDefs\n    .map(\n      (aspectDef) =>\n        `import ${getIdentifier(aspectDef, suffix)} from '${toWindowsCompatiblePath(aspectDef[pathProp])}';`\n    )\n    .join('\\n');\n}\n\nfunction getIdentifiers(aspectDefs: AspectDefinition[], suffix: string): string[] {\n  return aspectDefs.map((aspectDef) => `${getIdentifier(aspectDef, suffix)}`);\n}\n\nfunction getIdSetters(defs: AspectDefinition[], suffix: string) {\n  return defs\n    .map((def) => {\n      if (!def.getId) return undefined;\n      return `${getIdentifier(def, suffix)}.id = '${def.getId}';`;\n    })\n    .filter((val) => !!val);\n}\n\nfunction getIdentifier(aspectDef: AspectDefinition, suffix: string): string {\n  if (!aspectDef.component && !aspectDef.local) {\n    return getCoreIdentifier(aspectDef.aspectPath, suffix);\n  }\n  return getRegularAspectIdentifier(aspectDef, suffix);\n}\n\nfunction getRegularAspectIdentifier(aspectDef: AspectDefinition, suffix: string): string {\n  return camelCase(`${parse(aspectDef.aspectPath).base.replace(/\\./, '__').replace('@', '__')}${suffix}`);\n}\n\nfunction getCoreIdentifier(path: string, suffix: string): string {\n  return camelCase(`${parse(path).name.split('.')[0]}${suffix}`);\n}\n"],"mappings":"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"}