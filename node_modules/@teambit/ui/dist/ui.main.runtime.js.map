{"version":3,"names":["UiMain","constructor","pubsub","config","graphql","uiRootSlot","express","preStartSlot","onStartSlot","publicDirOverwriteSlot","buildMethodOverwriteSlot","componentExtension","cache","logger","harmony","startPluginSlot","targetHost","targetPort","uiRoot","UiServerStartedEvent","Date","now","publicDir","overwriteFn","getOverwritePublic","hasDir","startsWith","substring","getUiByName","name","roots","toArray","root","find","build","uiRootName","debug","maybeUiRoot","getUi","UnknownUI","possibleUis","ssr","buildOptions","mainEntry","generateRoot","resolveAspects","UIRuntime","browserConfig","createWebpackConfig","path","ssrConfig","createSsrWebpackConfig","filter","x","compiler","webpack","compilerRun","promisify","run","bind","results","UnknownBuildError","hasErrors","clearConsole","Error","toString","registerStartPlugin","startPlugin","register","initiatePlugins","options","plugins","values","pMapSeries","plugin","initiate","createRuntime","pattern","dev","port","rebuild","verbose","isHost","setHostPriority","uiServer","UIServer","create","uiRootExtension","ui","startPlugins","addSignalListener","portRange","buildUI","start","pub","UIAspect","id","createUiServerStartedEvent","host","process","on","exit","getPort","selectPort","registerPreStart","preStartFn","registerOnStart","onStartFn","registerBuildUIOverwrite","fn","registerPublicDirOverwrite","getOverwriteBuildFn","buildMethodOverwrite","undefined","overwritePublic","invokePreStart","preStartOpts","onPreStartFuncs","invokeOnStart","onStartFuncs","registerUiRoot","get","uis","length","priority","isHostAvailable","Boolean","getHost","getUiName","map","createLink","aspectDefs","rootExtensionName","createRoot","runtimeName","rootAspect","contents","toObject","filepath","resolve","join","__dirname","sha1","fs","existsSync","outputFileSync","from","to","usedPorts","Port","set","concat","overwrite","hash","buildIfChanged","buildIfNoBundle","buildUiHash","runtime","aspects","sort","a","b","aspectPath","aspect","runtimePath","force","hashed","console","chalk","cyan","configFile","stdout","write","platform","output","pathExistsSync","publicUrl","provider","cli","loggerMain","proxyGetterSlot","createLogger","StartCmd","UIBuildCmd","MainRuntime","PubsubAspect","CLIAspect","GraphqlAspect","ExpressAspect","ComponentAspect","CacheAspect","LoggerAspect","Slot","withType","addRuntime"],"sources":["ui.main.runtime.ts"],"sourcesContent":["import type { AspectMain } from '@teambit/aspect';\nimport { ComponentType } from 'react';\nimport { AspectDefinition } from '@teambit/aspect-loader';\nimport { CacheAspect, CacheMain } from '@teambit/cache';\nimport { CLIAspect, CLIMain, MainRuntime } from '@teambit/cli';\nimport type { ComponentMain } from '@teambit/component';\nimport { ComponentAspect } from '@teambit/component';\nimport { ExpressAspect, ExpressMain } from '@teambit/express';\nimport type { GraphqlMain } from '@teambit/graphql';\nimport { GraphqlAspect } from '@teambit/graphql';\nimport chalk from 'chalk';\nimport { Slot, SlotRegistry, Harmony } from '@teambit/harmony';\nimport { Logger, LoggerAspect, LoggerMain } from '@teambit/logger';\nimport PubsubAspect, { PubsubMain } from '@teambit/pubsub';\nimport { sha1 } from '@teambit/legacy/dist/utils';\nimport pMapSeries from 'p-map-series';\nimport fs from 'fs-extra';\nimport { Port } from '@teambit/toolbox.network.get-port';\nimport { join, resolve } from 'path';\nimport { promisify } from 'util';\nimport webpack from 'webpack';\nimport { UiServerStartedEvent } from './events';\nimport { createRoot } from './create-root';\nimport { UnknownUI, UnknownBuildError } from './exceptions';\nimport { StartCmd } from './start.cmd';\nimport { UIBuildCmd } from './ui-build.cmd';\nimport { UIRoot } from './ui-root';\nimport { UIServer } from './ui-server';\nimport { UIAspect, UIRuntime } from './ui.aspect';\nimport createWebpackConfig from './webpack/webpack.browser.config';\nimport createSsrWebpackConfig from './webpack/webpack.ssr.config';\nimport { StartPlugin, StartPluginOptions } from './start-plugin';\n\nexport type UIDeps = [PubsubMain, CLIMain, GraphqlMain, ExpressMain, ComponentMain, CacheMain, LoggerMain, AspectMain];\n\nexport type UIRootRegistry = SlotRegistry<UIRoot>;\n\nexport type PreStart = (preStartOpts: PreStartOpts) => Promise<void>;\n\nexport type PreStartOpts = { skipCompilation?: boolean };\n\nexport type OnStart = () => Promise<undefined | ComponentType<{}>>;\n\nexport type StartPluginSlot = SlotRegistry<StartPlugin>;\n\nexport type PublicDirOverwrite = (uiRoot: UIRoot) => Promise<string | undefined>;\n\nexport type BuildMethodOverwrite = (name: string, uiRoot: UIRoot, rebuild?: boolean) => Promise<string>;\n\nexport type PreStartSlot = SlotRegistry<PreStart>;\n\nexport type OnStartSlot = SlotRegistry<OnStart>;\n\nexport type PublicDirOverwriteSlot = SlotRegistry<PublicDirOverwrite>;\n\nexport type BuildMethodOverwriteSlot = SlotRegistry<BuildMethodOverwrite>;\n\nexport type UIConfig = {\n  /**\n   * port for the UI root to use.\n   */\n  port?: number;\n\n  /**\n   * port range for the UI root to use.\n   */\n  portRange: [number, number];\n\n  /**\n   * host for the UI root\n   */\n  host: string;\n\n  /**\n   * directory in workspace to use for public assets.\n   * always relative to the workspace root directory.\n   */\n  publicDir: string;\n\n  /** the url to display when server is listening. Note that bit does not provide proxying to this url */\n  publicUrl?: string;\n};\n\nexport type RuntimeOptions = {\n  /**\n   * determine whether to initiate on verbose mode.\n   */\n  verbose?: boolean;\n\n  /**\n   * name of the UI root to load.\n   */\n  uiRootName?: string;\n\n  /**\n   * component selector pattern to load.\n   */\n  pattern?: string;\n\n  /**\n   * determine whether to start a dev server (defaults to false).\n   */\n  dev?: boolean;\n\n  /**\n   * port of the config.\n   */\n  port?: number;\n\n  /**\n   * determine whether to rebuild the UI before start.\n   */\n  rebuild?: boolean;\n};\n\nexport class UiMain {\n  constructor(\n    /**\n     * Pubsub extension.\n     */\n    private pubsub: PubsubMain,\n\n    private config: UIConfig,\n\n    /**\n     * graphql extension.\n     */\n    private graphql: GraphqlMain,\n\n    /**\n     * slot registry of ui roots.\n     */\n    private uiRootSlot: UIRootRegistry,\n\n    /**\n     * express extension.\n     */\n    private express: ExpressMain,\n\n    /**\n     * pre-start slot\n     */\n    private preStartSlot: PreStartSlot,\n\n    /**\n     * on start slot\n     */\n    private onStartSlot: OnStartSlot,\n\n    /**\n     * Overwrite the public dir Slot\n     */\n    private publicDirOverwriteSlot: PublicDirOverwriteSlot,\n\n    /**\n     * Overwrite the build ui method\n     */\n    private buildMethodOverwriteSlot: BuildMethodOverwriteSlot,\n\n    /**\n     * component extension.\n     */\n    private componentExtension: ComponentMain,\n\n    /**\n     * ui logger instance.\n     */\n    private cache: CacheMain,\n\n    /**\n     * ui logger instance.\n     */\n    private logger: Logger,\n\n    private harmony: Harmony,\n\n    private startPluginSlot: StartPluginSlot\n  ) {}\n\n  async publicDir(uiRoot: UIRoot) {\n    const overwriteFn = this.getOverwritePublic();\n    if (overwriteFn) {\n      const hasDir = await overwriteFn(uiRoot);\n      if (hasDir) return hasDir;\n    }\n\n    if (this.config.publicDir.startsWith('/')) {\n      return this.config.publicDir.substring(1);\n    }\n\n    return this.config.publicDir;\n  }\n\n  private getUiByName(name: string) {\n    const roots = this.uiRootSlot.toArray();\n    const [, root] =\n      roots.find(([, uiRoot]) => {\n        return uiRoot.name === name;\n      }) || [];\n\n    return root;\n  }\n\n  /**\n   * create a build of the given UI root.\n   */\n  async build(uiRootName?: string): Promise<webpack.MultiStats | undefined> {\n    // TODO: change to MultiStats from webpack once they export it in their types\n    this.logger.debug(`build, uiRootName: \"${uiRootName}\"`);\n    const maybeUiRoot = this.getUi(uiRootName);\n\n    if (!maybeUiRoot) throw new UnknownUI(uiRootName, this.possibleUis());\n    const [name, uiRoot] = maybeUiRoot;\n\n    // TODO: @uri refactor all dev server related code to use the bundler extension instead.\n    const ssr = uiRoot.buildOptions?.ssr || false;\n    const mainEntry = await this.generateRoot(await uiRoot.resolveAspects(UIRuntime.name), name);\n\n    const browserConfig = createWebpackConfig(uiRoot.path, [mainEntry], uiRoot.name, await this.publicDir(uiRoot));\n    const ssrConfig = ssr && createSsrWebpackConfig(uiRoot.path, [mainEntry], await this.publicDir(uiRoot));\n\n    const config = [browserConfig, ssrConfig].filter((x) => !!x) as webpack.Configuration[];\n    const compiler = webpack(config);\n    this.logger.debug(`build, uiRootName: \"${uiRootName}\" running webpack`);\n    const compilerRun = promisify(compiler.run.bind(compiler));\n    const results = await compilerRun();\n    this.logger.debug(`build, uiRootName: \"${uiRootName}\" completed webpack`);\n    if (!results) throw new UnknownBuildError();\n    if (results?.hasErrors()) {\n      this.clearConsole();\n      throw new Error(results?.toString());\n    }\n\n    return results;\n  }\n\n  registerStartPlugin(startPlugin: StartPlugin) {\n    this.startPluginSlot.register(startPlugin);\n    return this;\n  }\n\n  private async initiatePlugins(options: StartPluginOptions) {\n    const plugins = this.startPluginSlot.values();\n    await pMapSeries(plugins, (plugin) => plugin.initiate(options));\n    return plugins;\n  }\n\n  /**\n   * create a Bit UI runtime.\n   */\n  async createRuntime({ uiRootName, pattern, dev, port, rebuild, verbose }: RuntimeOptions) {\n    const maybeUiRoot = this.getUi(uiRootName);\n    if (!maybeUiRoot) throw new UnknownUI(uiRootName, this.possibleUis());\n\n    const [name, uiRoot] = maybeUiRoot;\n\n    const plugins = await this.initiatePlugins({\n      verbose,\n      pattern,\n    });\n\n    if (this.componentExtension.isHost(name)) this.componentExtension.setHostPriority(name);\n\n    const uiServer = UIServer.create({\n      express: this.express,\n      graphql: this.graphql,\n      uiRoot,\n      uiRootExtension: name,\n      ui: this,\n      logger: this.logger,\n      publicDir: await this.publicDir(uiRoot),\n      startPlugins: plugins,\n    });\n\n    // Adding signal listeners to make sure we immediately close the process on sigint / sigterm (otherwise webpack dev server closing will take time)\n    this.addSignalListener();\n    if (dev) {\n      await uiServer.dev({ portRange: port || this.config.portRange });\n    } else {\n      await this.buildUI(name, uiRoot, rebuild);\n      await uiServer.start({ portRange: port || this.config.portRange });\n    }\n\n    this.pubsub.pub(UIAspect.id, this.createUiServerStartedEvent(this.config.host, uiServer.port, uiRoot));\n\n    return uiServer;\n  }\n\n  private addSignalListener() {\n    process.on('SIGTERM', () => {\n      process.exit();\n    });\n\n    process.on('SIGINT', () => {\n      process.exit();\n    });\n  }\n\n  async getPort(port?: number): Promise<number> {\n    if (port) return port;\n    return this.config.port || this.selectPort();\n  }\n\n  /**\n   * Events\n   */\n  private createUiServerStartedEvent = (targetHost, targetPort, uiRoot) => {\n    return new UiServerStartedEvent(Date.now(), targetHost, targetPort, uiRoot);\n  };\n\n  /**\n   * pre-start events are triggered and *completed* before the webserver started.\n   * (the promise is awaited)\n   */\n  registerPreStart(preStartFn: PreStart) {\n    this.preStartSlot.register(preStartFn);\n  }\n\n  /**\n   * bind to ui server start event.\n   */\n  registerOnStart(onStartFn: OnStart) {\n    this.onStartSlot.register(onStartFn);\n    return this;\n  }\n\n  /**\n   * overwrite the build ui function\n   */\n  registerBuildUIOverwrite(fn: BuildMethodOverwrite) {\n    this.buildMethodOverwriteSlot.register(fn);\n    return this;\n  }\n\n  /**\n   * overwrite the build ui function\n   */\n  registerPublicDirOverwrite(fn: PublicDirOverwrite) {\n    this.publicDirOverwriteSlot.register(fn);\n    return this;\n  }\n\n  private getOverwriteBuildFn() {\n    const buildMethodOverwrite = this.buildMethodOverwriteSlot.toArray();\n    if (buildMethodOverwrite[0]) {\n      const [, fn] = buildMethodOverwrite[0];\n      return fn;\n    }\n    return undefined;\n  }\n\n  private getOverwritePublic() {\n    const overwritePublic = this.publicDirOverwriteSlot.toArray();\n    if (overwritePublic[0]) {\n      const [, fn] = overwritePublic[0];\n      return fn;\n    }\n    return undefined;\n  }\n\n  async invokePreStart(preStartOpts: PreStartOpts): Promise<void> {\n    const onPreStartFuncs = this.preStartSlot.values();\n    await pMapSeries(onPreStartFuncs, async (fn) => fn(preStartOpts));\n  }\n\n  async invokeOnStart(): Promise<ComponentType[]> {\n    const onStartFuncs = this.onStartSlot.values();\n    const startPlugins = await pMapSeries(onStartFuncs, async (fn) => fn());\n    return startPlugins.filter((plugin) => !!plugin) as ComponentType[];\n  }\n\n  /**\n   * register a UI slot.\n   */\n  registerUiRoot(uiRoot: UIRoot) {\n    return this.uiRootSlot.register(uiRoot);\n  }\n\n  /**\n   * get a UI runtime instance.\n   */\n  getUi(uiRootName?: string): [string, UIRoot] | undefined {\n    if (uiRootName) {\n      const root = this.uiRootSlot.get(uiRootName) || this.getUiByName(uiRootName);\n      if (!root) return undefined;\n      return [uiRootName, root];\n    }\n    const uis = this.uiRootSlot.toArray();\n    if (uis.length === 1) return uis[0];\n    return uis.find(([, root]) => root.priority);\n  }\n\n  isHostAvailable(): boolean {\n    return Boolean(this.componentExtension.getHost());\n  }\n\n  getUiName(uiRootName?: string): string | undefined {\n    const [, ui] = this.getUi(uiRootName) || [];\n    if (!ui) return undefined;\n\n    return ui.name;\n  }\n\n  private possibleUis() {\n    return this.uiRootSlot.toArray().map(([id]) => id);\n  }\n\n  createLink(aspectDefs: AspectDefinition[], rootExtensionName: string) {\n    return createRoot(aspectDefs, rootExtensionName);\n  }\n\n  /**\n   * generate the root file of the UI runtime.\n   */\n  async generateRoot(\n    aspectDefs: AspectDefinition[],\n    rootExtensionName: string,\n    runtimeName = UIRuntime.name,\n    rootAspect = UIAspect.id,\n    config?: object,\n    path?: string\n  ) {\n    const contents = await createRoot(\n      aspectDefs,\n      rootExtensionName,\n      rootAspect,\n      runtimeName,\n      config || this.harmony.config.toObject()\n    );\n    const filepath = resolve(join(path || __dirname, `${runtimeName}.root${sha1(contents)}.js`));\n    if (fs.existsSync(filepath)) return filepath;\n    fs.outputFileSync(filepath, contents);\n    return filepath;\n  }\n\n  private async selectPort() {\n    const [from, to] = this.config.portRange;\n    const usedPorts = (await this.cache.get<number[]>(`${from}${to}`)) || [];\n    const port = await Port.getPort(from, to, usedPorts);\n    // this will lock the port for 1 min to avoid race conditions\n    await this.cache.set(`${from}${to}`, usedPorts.concat(port), 5000);\n    return port;\n  }\n\n  private async buildUI(name: string, uiRoot: UIRoot, rebuild?: boolean): Promise<string> {\n    this.logger.debug(`buildUI, name ${name}`);\n    const overwrite = this.getOverwriteBuildFn();\n    if (overwrite) return overwrite(name, uiRoot, rebuild);\n    const hash = await this.buildIfChanged(name, uiRoot, rebuild);\n    await this.buildIfNoBundle(name, uiRoot);\n    return hash;\n  }\n\n  async buildUiHash(uiRoot: UIRoot, runtime = 'ui'): Promise<string> {\n    const aspects = await uiRoot.resolveAspects(runtime);\n    aspects.sort((a, b) => (a.aspectPath > b.aspectPath ? 1 : -1));\n    const hash = aspects.map((aspect) => {\n      return [aspect.aspectPath, aspect.runtimePath].join('');\n    });\n    return sha1(hash.join(''));\n  }\n\n  async buildIfChanged(name: string, uiRoot: UIRoot, force: boolean | undefined): Promise<string> {\n    this.logger.debug(`buildIfChanged, name ${name}`);\n    const hash = await this.buildUiHash(uiRoot);\n    const hashed = await this.cache.get(uiRoot.path);\n    if (hash === hashed && !force) {\n      this.logger.debug(`buildIfChanged, name ${name}, returned from cache`);\n      return hash;\n    }\n    if (!hashed) {\n      this.logger.console(\n        `Building UI assets for '${chalk.cyan(uiRoot.name)}' in target directory: ${chalk.cyan(\n          await this.publicDir(uiRoot)\n        )}. The first time we build the UI it may take a few minutes.`\n      );\n    } else {\n      this.logger.console(\n        `Rebuilding UI assets for '${chalk.cyan(uiRoot.name)} in target directory: ${chalk.cyan(\n          await this.publicDir(uiRoot)\n        )}' as ${uiRoot.configFile} has been changed.`\n      );\n    }\n\n    await this.build(name);\n    await this.cache.set(uiRoot.path, hash);\n    return hash;\n  }\n\n  clearConsole() {\n    process.stdout.write(process.platform === 'win32' ? '\\x1B[2J\\x1B[0f' : '\\x1B[2J\\x1B[3J\\x1B[H');\n  }\n\n  async buildIfNoBundle(name: string, uiRoot: UIRoot) {\n    const config = createWebpackConfig(\n      uiRoot.path,\n      [await this.generateRoot(await uiRoot.resolveAspects(UIRuntime.name), name)],\n      uiRoot.name,\n      await this.publicDir(uiRoot)\n    );\n    if (config.output?.path && fs.pathExistsSync(config.output.path)) return;\n    const hash = await this.buildUiHash(uiRoot);\n    await this.build(name);\n    await this.cache.set(uiRoot.path, hash);\n  }\n\n  get publicUrl() {\n    return this.config.publicUrl;\n  }\n\n  static defaultConfig: UIConfig = {\n    publicDir: 'public/bit',\n    portRange: [3000, 3100],\n    host: 'localhost',\n  };\n\n  static runtime = MainRuntime;\n  static dependencies = [\n    PubsubAspect,\n    CLIAspect,\n    GraphqlAspect,\n    ExpressAspect,\n    ComponentAspect,\n    CacheAspect,\n    LoggerAspect,\n  ];\n\n  static slots = [\n    Slot.withType<UIRoot>(),\n    Slot.withType<PreStart>(),\n    Slot.withType<OnStart>(),\n    Slot.withType<PublicDirOverwriteSlot>(),\n    Slot.withType<BuildMethodOverwriteSlot>(),\n    Slot.withType<StartPlugin>(),\n  ];\n\n  static async provider(\n    [pubsub, cli, graphql, express, componentExtension, cache, loggerMain]: UIDeps,\n    config,\n    [uiRootSlot, preStartSlot, onStartSlot, publicDirOverwriteSlot, buildMethodOverwriteSlot, proxyGetterSlot]: [\n      UIRootRegistry,\n      PreStartSlot,\n      OnStartSlot,\n      PublicDirOverwriteSlot,\n      BuildMethodOverwriteSlot,\n      StartPluginSlot\n    ],\n    harmony: Harmony\n  ) {\n    // aspectExtension.registerRuntime(new RuntimeDefinition('ui', []))\n    const logger = loggerMain.createLogger(UIAspect.id);\n\n    const ui = new UiMain(\n      pubsub,\n      config,\n      graphql,\n      uiRootSlot,\n      express,\n      preStartSlot,\n      onStartSlot,\n      publicDirOverwriteSlot,\n      buildMethodOverwriteSlot,\n      componentExtension,\n      cache,\n      logger,\n      harmony,\n      proxyGetterSlot\n    );\n    cli.register(new StartCmd(ui, logger), new UIBuildCmd(ui));\n    return ui;\n  }\n}\n\nUIAspect.addRuntime(UiMain);\n"],"mappings":"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"}