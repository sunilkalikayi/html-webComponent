{"version":3,"names":["SignCmd","constructor","signMain","report","components","multiple","alwaysSucceed","push","lane","componentIds","map","c","ComponentID","fromString","warnForMissingVersions","results","sign","chalk","bold","status","error","BuildStatus","Failed","Succeed","color","signed","length","id","toString","join","data","code","compIds","compIdsWithoutVer","filter","hasVersion","compIdsStr","console","warn","yellow"],"sources":["sign.cmd.ts"],"sourcesContent":["import chalk from 'chalk';\nimport { Command, CommandOptions } from '@teambit/cli';\nimport { ComponentID } from '@teambit/component';\nimport { BuildStatus } from '@teambit/legacy/dist/constants';\nimport { SignMain } from './sign.main.runtime';\n\ntype SignOptions = { multiple: boolean; alwaysSucceed: boolean; push: boolean; lane?: string };\nexport class SignCmd implements Command {\n  name = 'sign [component...]';\n  private = true;\n  description = 'complete the build process for components';\n  extendedDescription = `without --multiple, this will be running on the original scope.\nwith --multiple, a new bare-scope needs to be created and it will import the components to this scope first`;\n  alias = '';\n  group = 'development';\n  options = [\n    ['', 'multiple', 'sign components from multiple scopes'],\n    ['', 'always-succeed', 'exit with code 0 even though the build failed'],\n    ['', 'push', 'export the updated objects to the original scopes once done'],\n    ['', 'lane <lane-id>', 'helps to fetch the components from the lane scope (relevant for --multiple)'],\n  ] as CommandOptions;\n\n  constructor(private signMain: SignMain) {}\n\n  async report([components = []]: [string[]], { multiple, alwaysSucceed, push, lane }: SignOptions) {\n    const componentIds = components.map((c) => ComponentID.fromString(c));\n    this.warnForMissingVersions(componentIds);\n    const results = await this.signMain.sign(componentIds, multiple, push, lane);\n    if (!results) {\n      return chalk.bold('no more components left to sign');\n    }\n    const status = results.error ? BuildStatus.Failed : BuildStatus.Succeed;\n    const error = results.error ? `${results.error}\\n\\n` : '';\n    const color = error ? 'red' : 'green';\n    const signed = `the following ${results.components.length} component(s) were signed with build-status \"${status}\"\n${results.components.map((c) => c.id.toString()).join('\\n')}`;\n    return {\n      data: error + chalk.bold[color](signed),\n      code: error && !alwaysSucceed ? 1 : 0,\n    };\n  }\n\n  private warnForMissingVersions(compIds: ComponentID[]) {\n    const compIdsWithoutVer = compIds.filter((c) => !c.hasVersion());\n    if (compIdsWithoutVer.length) {\n      const compIdsStr = compIdsWithoutVer.map((c) => c.toString()).join(', ');\n      // eslint-disable-next-line no-console\n      console.warn(\n        chalk.yellow(\n          `the following component-id(s) don't have a version: ${compIdsStr}, as a result, it might sign the wrong version especially when running with lanes`\n        )\n      );\n    }\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAIO,MAAMA,OAAO,CAAoB;EAetCC,WAAW,CAASC,QAAkB,EAAE;IAAA,KAApBA,QAAkB,GAAlBA,QAAkB;IAAA,8CAd/B,qBAAqB;IAAA,iDAClB,IAAI;IAAA,qDACA,2CAA2C;IAAA,6DAClC;AACzB,4GAA4G;IAAA,+CAClG,EAAE;IAAA,+CACF,aAAa;IAAA,iDACX,CACR,CAAC,EAAE,EAAE,UAAU,EAAE,sCAAsC,CAAC,EACxD,CAAC,EAAE,EAAE,gBAAgB,EAAE,+CAA+C,CAAC,EACvE,CAAC,EAAE,EAAE,MAAM,EAAE,6DAA6D,CAAC,EAC3E,CAAC,EAAE,EAAE,gBAAgB,EAAE,6EAA6E,CAAC,CACtG;EAEwC;EAEzC,MAAMC,MAAM,CAAC,CAACC,UAAU,GAAG,EAAE,CAAa,EAAE;IAAEC,QAAQ;IAAEC,aAAa;IAAEC,IAAI;IAAEC;EAAkB,CAAC,EAAE;IAChG,MAAMC,YAAY,GAAGL,UAAU,CAACM,GAAG,CAAEC,CAAC,IAAKC,wBAAW,CAACC,UAAU,CAACF,CAAC,CAAC,CAAC;IACrE,IAAI,CAACG,sBAAsB,CAACL,YAAY,CAAC;IACzC,MAAMM,OAAO,GAAG,MAAM,IAAI,CAACb,QAAQ,CAACc,IAAI,CAACP,YAAY,EAAEJ,QAAQ,EAAEE,IAAI,EAAEC,IAAI,CAAC;IAC5E,IAAI,CAACO,OAAO,EAAE;MACZ,OAAOE,gBAAK,CAACC,IAAI,CAAC,iCAAiC,CAAC;IACtD;IACA,MAAMC,MAAM,GAAGJ,OAAO,CAACK,KAAK,GAAGC,wBAAW,CAACC,MAAM,GAAGD,wBAAW,CAACE,OAAO;IACvE,MAAMH,KAAK,GAAGL,OAAO,CAACK,KAAK,GAAI,GAAEL,OAAO,CAACK,KAAM,MAAK,GAAG,EAAE;IACzD,MAAMI,KAAK,GAAGJ,KAAK,GAAG,KAAK,GAAG,OAAO;IACrC,MAAMK,MAAM,GAAI,iBAAgBV,OAAO,CAACX,UAAU,CAACsB,MAAO,gDAA+CP,MAAO;AACpH,EAAEJ,OAAO,CAACX,UAAU,CAACM,GAAG,CAAEC,CAAC,IAAKA,CAAC,CAACgB,EAAE,CAACC,QAAQ,EAAE,CAAC,CAACC,IAAI,CAAC,IAAI,CAAE,EAAC;IACzD,OAAO;MACLC,IAAI,EAAEV,KAAK,GAAGH,gBAAK,CAACC,IAAI,CAACM,KAAK,CAAC,CAACC,MAAM,CAAC;MACvCM,IAAI,EAAEX,KAAK,IAAI,CAACd,aAAa,GAAG,CAAC,GAAG;IACtC,CAAC;EACH;EAEQQ,sBAAsB,CAACkB,OAAsB,EAAE;IACrD,MAAMC,iBAAiB,GAAGD,OAAO,CAACE,MAAM,CAAEvB,CAAC,IAAK,CAACA,CAAC,CAACwB,UAAU,EAAE,CAAC;IAChE,IAAIF,iBAAiB,CAACP,MAAM,EAAE;MAC5B,MAAMU,UAAU,GAAGH,iBAAiB,CAACvB,GAAG,CAAEC,CAAC,IAAKA,CAAC,CAACiB,QAAQ,EAAE,CAAC,CAACC,IAAI,CAAC,IAAI,CAAC;MACxE;MACAQ,OAAO,CAACC,IAAI,CACVrB,gBAAK,CAACsB,MAAM,CACT,uDAAsDH,UAAW,mFAAkF,CACrJ,CACF;IACH;EACF;AACF;AAAC"}