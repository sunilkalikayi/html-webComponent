{"version":3,"names":["LinterMain","constructor","envs","linterService","lint","components","opts","envsRuntime","createEnvironment","lintResults","run","createTask","name","LintTask","LinterAspect","id","provider","cli","component","loggerAspect","workspace","config","logger","createLogger","LinterService","path","linterAspect","registerService","register","LintCmd","getHost","MainRuntime","EnvsAspect","CLIAspect","ComponentAspect","LoggerAspect","WorkspaceAspect","extensionFormats","fixTypes","addRuntime"],"sources":["linter.main.runtime.ts"],"sourcesContent":["import { CLIAspect, CLIMain, MainRuntime } from '@teambit/cli';\nimport { Component, ComponentAspect, ComponentMain } from '@teambit/component';\nimport { EnvsAspect, EnvsMain } from '@teambit/envs';\nimport { LoggerAspect, LoggerMain } from '@teambit/logger';\nimport { Workspace, WorkspaceAspect } from '@teambit/workspace';\nimport { LinterAspect } from './linter.aspect';\nimport { LinterService } from './linter.service';\nimport { LintTask } from './lint.task';\nimport { LintCmd } from './lint.cmd';\nimport { FixTypes, LinterOptions } from './linter-context';\n\nexport type LinterConfig = {\n  /**\n   * extension formats to lint.\n   */\n  extensionFormats: string[];\n  fixTypes?: FixTypes;\n};\n\nexport class LinterMain {\n  static runtime = MainRuntime;\n\n  constructor(private envs: EnvsMain, private linterService: LinterService) {}\n\n  /**\n   * lint an array of components.\n   */\n  async lint(components: Component[], opts: LinterOptions) {\n    const envsRuntime = await this.envs.createEnvironment(components);\n    const lintResults = envsRuntime.run(this.linterService, opts);\n    return lintResults;\n  }\n\n  /**\n   * create a lint task for build pipelines.\n   * @param name name of the task.\n   */\n  createTask(name?: string): LintTask {\n    return new LintTask(LinterAspect.id, name);\n  }\n\n  static dependencies = [EnvsAspect, CLIAspect, ComponentAspect, LoggerAspect, WorkspaceAspect];\n\n  static defaultConfig: LinterConfig = {\n    extensionFormats: ['.ts', '.tsx', '.js', '.jsx', '.mjs'],\n    fixTypes: ['layout', 'problem', 'suggestion'],\n  };\n\n  static async provider(\n    [envs, cli, component, loggerAspect, workspace]: [EnvsMain, CLIMain, ComponentMain, LoggerMain, Workspace],\n    config: LinterConfig\n  ) {\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    const logger = loggerAspect.createLogger(LinterAspect.id);\n    const linterService = new LinterService(config, workspace?.path);\n    const linterAspect = new LinterMain(envs, linterService);\n    envs.registerService(linterService);\n    cli.register(new LintCmd(linterAspect, component.getHost(), workspace));\n\n    return linterAspect;\n  }\n}\n\nLinterAspect.addRuntime(LinterMain);\n"],"mappings":";;;;;;;;;;;;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAWO,MAAMA,UAAU,CAAC;EAGtBC,WAAW,CAASC,IAAc,EAAUC,aAA4B,EAAE;IAAA,KAAtDD,IAAc,GAAdA,IAAc;IAAA,KAAUC,aAA4B,GAA5BA,aAA4B;EAAG;;EAE3E;AACF;AACA;EACE,MAAMC,IAAI,CAACC,UAAuB,EAAEC,IAAmB,EAAE;IACvD,MAAMC,WAAW,GAAG,MAAM,IAAI,CAACL,IAAI,CAACM,iBAAiB,CAACH,UAAU,CAAC;IACjE,MAAMI,WAAW,GAAGF,WAAW,CAACG,GAAG,CAAC,IAAI,CAACP,aAAa,EAAEG,IAAI,CAAC;IAC7D,OAAOG,WAAW;EACpB;;EAEA;AACF;AACA;AACA;EACEE,UAAU,CAACC,IAAa,EAAY;IAClC,OAAO,KAAIC,gBAAQ,EAACC,sBAAY,CAACC,EAAE,EAAEH,IAAI,CAAC;EAC5C;EASA,aAAaI,QAAQ,CACnB,CAACd,IAAI,EAAEe,GAAG,EAAEC,SAAS,EAAEC,YAAY,EAAEC,SAAS,CAA4D,EAC1GC,MAAoB,EACpB;IACA;IACA,MAAMC,MAAM,GAAGH,YAAY,CAACI,YAAY,CAACT,sBAAY,CAACC,EAAE,CAAC;IACzD,MAAMZ,aAAa,GAAG,KAAIqB,wBAAa,EAACH,MAAM,EAAED,SAAS,aAATA,SAAS,uBAATA,SAAS,CAAEK,IAAI,CAAC;IAChE,MAAMC,YAAY,GAAG,IAAI1B,UAAU,CAACE,IAAI,EAAEC,aAAa,CAAC;IACxDD,IAAI,CAACyB,eAAe,CAACxB,aAAa,CAAC;IACnCc,GAAG,CAACW,QAAQ,CAAC,KAAIC,gBAAO,EAACH,YAAY,EAAER,SAAS,CAACY,OAAO,EAAE,EAAEV,SAAS,CAAC,CAAC;IAEvE,OAAOM,YAAY;EACrB;AACF;AAAC;AAAA,gCA1CY1B,UAAU,aACJ+B,kBAAW;AAAA,gCADjB/B,UAAU,kBAsBC,CAACgC,kBAAU,EAAEC,gBAAS,EAAEC,4BAAe,EAAEC,sBAAY,EAAEC,4BAAe,CAAC;AAAA,gCAtBlFpC,UAAU,mBAwBgB;EACnCqC,gBAAgB,EAAE,CAAC,KAAK,EAAE,MAAM,EAAE,KAAK,EAAE,MAAM,EAAE,MAAM,CAAC;EACxDC,QAAQ,EAAE,CAAC,QAAQ,EAAE,SAAS,EAAE,YAAY;AAC9C,CAAC;AAiBHxB,sBAAY,CAACyB,UAAU,CAACvC,UAAU,CAAC"}