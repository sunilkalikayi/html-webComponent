{"version":3,"names":["LinterService","constructor","linterConfig","rootDir","run","context","options","mergedOpts","optionsWithDefaults","linterContext","mergeContext","linter","env","getLinter","results","lint","defaults","Object","assign","quiet","extensionFormats","fixTypes","fix","render","descriptor","getDescriptor","id","displayName","version","config","highlight","language","ignoreIllegals","undefined","icon","displayConfig"],"sources":["linter.service.tsx"],"sourcesContent":["import React from 'react';\nimport { defaults } from 'lodash';\nimport { EnvService, ExecutionContext, EnvDefinition } from '@teambit/envs';\nimport { Text, Newline } from 'ink';\nimport highlight from 'cli-highlight';\nimport { Linter, LintResults } from './linter';\nimport { LinterContext, LinterOptions } from './linter-context';\nimport { LinterConfig } from './linter.main.runtime';\n\nexport class LinterService implements EnvService<LintResults> {\n  name = 'linter';\n\n  constructor(private linterConfig: LinterConfig, private rootDir?: string) {}\n\n  async run(context: ExecutionContext, options: LinterOptions): Promise<LintResults> {\n    const mergedOpts = this.optionsWithDefaults(options);\n    const linterContext = this.mergeContext(mergedOpts, context);\n    const linter: Linter = context.env.getLinter(linterContext);\n\n    const results = await linter.lint(linterContext);\n    return results;\n  }\n\n  private optionsWithDefaults(options: LinterOptions): LinterOptions {\n    return defaults(options, this.linterConfig);\n  }\n\n  private mergeContext(options: LinterOptions, context?: ExecutionContext): LinterContext {\n    const linterContext: LinterContext = Object.assign(\n      {},\n      {\n        rootDir: this.rootDir,\n        quiet: false,\n        extensionFormats: options.extensionFormats,\n        fixTypes: options.fixTypes,\n        fix: options.fix,\n      },\n      context\n    );\n    return linterContext;\n  }\n\n  render(env: EnvDefinition) {\n    const descriptor = this.getDescriptor(env);\n\n    return (\n      <Text key={descriptor?.id}>\n        <Text color=\"cyan\">configured linter: </Text>\n        <Text>\n          {descriptor?.id} ({descriptor?.displayName} @ {descriptor?.version})\n        </Text>\n        <Newline />\n        <Text color=\"cyan\">linter config:</Text>\n        <Newline />\n        <Text>\n          {descriptor?.config && highlight(descriptor?.config, { language: 'javascript', ignoreIllegals: true })}\n        </Text>\n        <Newline />\n      </Text>\n    );\n  }\n\n  getDescriptor(env: EnvDefinition) {\n    if (!env.env.getLinter) return undefined;\n    const mergedOpts = this.optionsWithDefaults({});\n    const linterContext = this.mergeContext(mergedOpts);\n    const linter = env.env.getLinter(linterContext);\n\n    return {\n      id: linter.id,\n      icon: linter.icon,\n      config: linter.displayConfig ? linter.displayConfig() : undefined,\n      version: linter.version ? linter.version() : '?',\n      displayName: linter.displayName ? linter.displayName : '?',\n    };\n  }\n}\n"],"mappings":"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"}