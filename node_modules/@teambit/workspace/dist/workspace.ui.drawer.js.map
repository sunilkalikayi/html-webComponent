{"version":3,"names":["workspaceDrawer","treeWidgets","filtersSlot","drawerWidgetSlot","ComponentsDrawer","order","id","name","plugins","tree","widgets","customRenderer","treeNodeSlot","TreeNode","props","children","node","payload","ScopePayload","filters","drawerWidgets","emptyMessage","useComponents","lanesModel","loading","lanesLoading","useLanes","viewedLaneId","viewedLane","defaultLane","getDefaultLane","isViewingDefaultLane","isEqual","components","laneComponents","laneCompsLoading","useLaneComponents","mainComponents","mainCompsLoading","undefined","mergeComponents","mainComponentsThatAreNotOnLane","filter","mainComponent","find","laneComponent","toStringWithoutVersion","concat"],"sources":["workspace.ui.drawer.tsx"],"sourcesContent":["import React from 'react';\nimport { ComponentsDrawer, ComponentFiltersSlot, DrawerWidgetSlot } from '@teambit/component.ui.component-drawer';\nimport {\n  ComponentView,\n  NamespaceTreeNode,\n  PayloadType,\n  ScopePayload,\n  ScopeTreeNode,\n} from '@teambit/ui-foundation.ui.side-bar';\nimport { useLanes } from '@teambit/lanes.hooks.use-lanes';\nimport { useLaneComponents } from '@teambit/lanes.hooks.use-lane-components';\nimport { TreeNodeProps } from '@teambit/design.ui.tree';\nimport { ComponentModel } from '@teambit/component';\nimport { SidebarWidgetSlot } from './workspace.ui.runtime';\n\nexport type WorkspaceDrawerProps = {\n  treeWidgets: SidebarWidgetSlot;\n  filtersSlot: ComponentFiltersSlot;\n  drawerWidgetSlot: DrawerWidgetSlot;\n};\n\nexport const workspaceDrawer = ({ treeWidgets, filtersSlot, drawerWidgetSlot }: WorkspaceDrawerProps) =>\n  new ComponentsDrawer({\n    order: 0,\n    id: 'workspace-components-drawer',\n    name: 'COMPONENTS',\n    plugins: {\n      tree: {\n        widgets: treeWidgets,\n        customRenderer: (treeNodeSlot) =>\n          function TreeNode(props: TreeNodeProps<PayloadType>) {\n            const children = props.node.children;\n\n            if (!children) return <ComponentView {...props} treeNodeSlot={treeNodeSlot} />; // non collapse\n\n            if (props.node.payload instanceof ScopePayload) return <ScopeTreeNode {...props} />;\n\n            return <NamespaceTreeNode {...props} />;\n          },\n      },\n      filters: filtersSlot,\n      drawerWidgets: drawerWidgetSlot,\n    },\n    emptyMessage: 'Workspace is empty',\n    useComponents: () => {\n      const { lanesModel, loading: lanesLoading } = useLanes();\n      const viewedLaneId = lanesModel?.viewedLane?.id;\n      const defaultLane = lanesModel?.getDefaultLane();\n      const isViewingDefaultLane = viewedLaneId && defaultLane?.id.isEqual(viewedLaneId);\n\n      const { components: laneComponents = [], loading: laneCompsLoading } = useLaneComponents(viewedLaneId);\n      const { components: mainComponents = [], loading: mainCompsLoading } = useLaneComponents(\n        !isViewingDefaultLane ? defaultLane?.id : undefined\n      );\n\n      // lane components + main components\n      const components = isViewingDefaultLane ? laneComponents : mergeComponents(mainComponents, laneComponents);\n\n      return {\n        loading: lanesLoading || laneCompsLoading || mainCompsLoading,\n        components,\n      };\n    },\n  });\n\nfunction mergeComponents(mainComponents: ComponentModel[], laneComponents: ComponentModel[]): ComponentModel[] {\n  const mainComponentsThatAreNotOnLane = mainComponents.filter((mainComponent) => {\n    return !laneComponents.find(\n      (laneComponent) => laneComponent.id.toStringWithoutVersion() === mainComponent.id.toStringWithoutVersion()\n    );\n  });\n  return laneComponents.concat(mainComponentsThatAreNotOnLane);\n}\n"],"mappings":";;;;;;;;;;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAOA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAWO,MAAMA,eAAe,GAAG,CAAC;EAAEC,WAAW;EAAEC,WAAW;EAAEC;AAAuC,CAAC,KAClG,KAAIC,+BAAgB,EAAC;EACnBC,KAAK,EAAE,CAAC;EACRC,EAAE,EAAE,6BAA6B;EACjCC,IAAI,EAAE,YAAY;EAClBC,OAAO,EAAE;IACPC,IAAI,EAAE;MACJC,OAAO,EAAET,WAAW;MACpBU,cAAc,EAAGC,YAAY,IAC3B,SAASC,QAAQ,CAACC,KAAiC,EAAE;QACnD,MAAMC,QAAQ,GAAGD,KAAK,CAACE,IAAI,CAACD,QAAQ;QAEpC,IAAI,CAACA,QAAQ,EAAE,oBAAO,+BAAC,+BAAa,+BAAKD,KAAK;UAAE,YAAY,EAAEF;QAAa,GAAG,CAAC,CAAC;;QAEhF,IAAIE,KAAK,CAACE,IAAI,CAACC,OAAO,YAAYC,8BAAY,EAAE,oBAAO,+BAAC,+BAAa,EAAKJ,KAAK,CAAI;QAEnF,oBAAO,+BAAC,mCAAiB,EAAKA,KAAK,CAAI;MACzC;IACJ,CAAC;IACDK,OAAO,EAAEjB,WAAW;IACpBkB,aAAa,EAAEjB;EACjB,CAAC;EACDkB,YAAY,EAAE,oBAAoB;EAClCC,aAAa,EAAE,MAAM;IAAA;IACnB,MAAM;MAAEC,UAAU;MAAEC,OAAO,EAAEC;IAAa,CAAC,GAAG,IAAAC,sBAAQ,GAAE;IACxD,MAAMC,YAAY,GAAGJ,UAAU,aAAVA,UAAU,gDAAVA,UAAU,CAAEK,UAAU,0DAAtB,sBAAwBtB,EAAE;IAC/C,MAAMuB,WAAW,GAAGN,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAEO,cAAc,EAAE;IAChD,MAAMC,oBAAoB,GAAGJ,YAAY,KAAIE,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAEvB,EAAE,CAAC0B,OAAO,CAACL,YAAY,CAAC;IAElF,MAAM;MAAEM,UAAU,EAAEC,cAAc,GAAG,EAAE;MAAEV,OAAO,EAAEW;IAAiB,CAAC,GAAG,IAAAC,gCAAiB,EAACT,YAAY,CAAC;IACtG,MAAM;MAAEM,UAAU,EAAEI,cAAc,GAAG,EAAE;MAAEb,OAAO,EAAEc;IAAiB,CAAC,GAAG,IAAAF,gCAAiB,EACtF,CAACL,oBAAoB,GAAGF,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAEvB,EAAE,GAAGiC,SAAS,CACpD;;IAED;IACA,MAAMN,UAAU,GAAGF,oBAAoB,GAAGG,cAAc,GAAGM,eAAe,CAACH,cAAc,EAAEH,cAAc,CAAC;IAE1G,OAAO;MACLV,OAAO,EAAEC,YAAY,IAAIU,gBAAgB,IAAIG,gBAAgB;MAC7DL;IACF,CAAC;EACH;AACF,CAAC,CAAC;AAAC;AAEL,SAASO,eAAe,CAACH,cAAgC,EAAEH,cAAgC,EAAoB;EAC7G,MAAMO,8BAA8B,GAAGJ,cAAc,CAACK,MAAM,CAAEC,aAAa,IAAK;IAC9E,OAAO,CAACT,cAAc,CAACU,IAAI,CACxBC,aAAa,IAAKA,aAAa,CAACvC,EAAE,CAACwC,sBAAsB,EAAE,KAAKH,aAAa,CAACrC,EAAE,CAACwC,sBAAsB,EAAE,CAC3G;EACH,CAAC,CAAC;EACF,OAAOZ,cAAc,CAACa,MAAM,CAACN,8BAA8B,CAAC;AAC9D"}