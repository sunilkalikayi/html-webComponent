{"version":3,"names":["WorkspaceUI","constructor","routeSlot","componentUi","menuSlot","menuItemSlot","sidebar","sidebarSlot","sidebarItemSlot","drawerWidgetSlot","drawerComponentsFiltersSlot","commandBarUI","menuItems","register","routes","components","updateComponents","links","filters","widgets","category","title","keyChar","handler","run","registerRoutes","registerDrawers","drawers","registerDrawer","registerSidebarWidget","componentTreeNode","uiRoot","workspaceDrawer","treeWidgets","filtersSlot","setKeyBindHandler","addCommand","id","action","displayName","keybinding","path","element","listSidebarItems","items","flatten","values","compact","map","item","component","provider","ui","componentTree","graphUI","config","registerTreeNode","ComponentTreeWidget","registerComponentWidget","widget","workspaceUI","registerDrawerComponentFilters","DeprecateFilter","EnvsFilter","ShowMainFilter","registerDrawerWidgets","registerRoot","bind","registerMenuItem","registerSidebarLink","Gallery","registerMenuRoutes","routePath","getMenu","WorkspaceAspect","getComponentUI","UIAspect","ComponentAspect","SidebarAspect","ComponentTreeAspect","CommandBarAspect","GraphAspect","UIRuntime","Slot","withType","addRuntime"],"sources":["workspace.ui.runtime.tsx"],"sourcesContent":["import { ComponentAspect, ComponentUI, ComponentModel } from '@teambit/component';\nimport { compact, flatten } from 'lodash';\nimport { ComponentTreeAspect, ComponentTreeUI, ComponentTreeNode } from '@teambit/component-tree';\nimport { Slot, SlotRegistry } from '@teambit/harmony';\nimport { RouteSlot } from '@teambit/ui-foundation.ui.react-router.slot-router';\nimport { Menu } from '@teambit/ui-foundation.ui.menu';\nimport SidebarAspect, { SidebarUI, SidebarItem, SidebarItemSlot } from '@teambit/sidebar';\nimport { MenuItemSlot, MenuItem } from '@teambit/ui-foundation.ui.main-dropdown';\nimport { UIAspect, UIRootUI as UIRoot, UIRuntime, UiUI } from '@teambit/ui';\nimport { GraphAspect, GraphUI } from '@teambit/graph';\nimport React, { ReactNode } from 'react';\nimport { RouteProps } from 'react-router-dom';\nimport CommandBarAspect, { CommandBarUI, CommandHandler } from '@teambit/command-bar';\nimport { MenuLinkItem } from '@teambit/design.ui.surfaces.menu.link-item';\nimport type { DrawerType } from '@teambit/ui-foundation.ui.tree.drawer';\nimport { ComponentFilters } from '@teambit/component.ui.component-filters.component-filter-context';\nimport { DeprecateFilter } from '@teambit/component.ui.component-filters.deprecate-filter';\nimport { EnvsFilter } from '@teambit/component.ui.component-filters.env-filter';\nimport { ShowMainFilter } from '@teambit/component.ui.component-filters.show-main-filter';\nimport {\n  DrawerWidgetSlot,\n  FilterWidget,\n  TreeToggleWidget,\n  ComponentFiltersSlot,\n} from '@teambit/component.ui.component-drawer';\nimport { ComponentTreeWidget } from './component-tree.widget';\nimport { Workspace } from './ui';\nimport { WorkspaceAspect } from './workspace.aspect';\nimport { workspaceDrawer } from './workspace.ui.drawer';\n\nexport type SidebarWidgetSlot = SlotRegistry<ComponentTreeNode>;\n\nexport class WorkspaceUI {\n  constructor(\n    /**\n     * route slot.\n     */\n    private routeSlot: RouteSlot,\n\n    /**\n     * component ui extension.\n     */\n    private componentUi: ComponentUI,\n\n    /**\n     * menu slot\n     */\n    private menuSlot: RouteSlot,\n\n    private menuItemSlot: MenuItemSlot,\n\n    private sidebar: SidebarUI,\n\n    private sidebarSlot: SidebarWidgetSlot,\n\n    /**\n     * sidebar link slot\n     */\n    private sidebarItemSlot: SidebarItemSlot,\n\n    private drawerWidgetSlot: DrawerWidgetSlot,\n\n    private drawerComponentsFiltersSlot: ComponentFiltersSlot,\n\n    private commandBarUI: CommandBarUI\n  ) {}\n\n  private setKeyBindHandler: (updated: CommandHandler) => void = () => {};\n\n  /**\n   * register a route to the workspace.\n   */\n  registerRoutes(routes: RouteProps[]) {\n    this.routeSlot.register(routes);\n    return this;\n  }\n\n  registerDrawers(...drawers: DrawerType[]) {\n    this.sidebar.registerDrawer(...drawers);\n    return this;\n  }\n\n  registerSidebarWidget(componentTreeNode: ComponentTreeNode) {\n    this.sidebarSlot.register(componentTreeNode);\n    return this;\n  }\n\n  registerMenuItem = (menuItems: MenuItem[]) => {\n    this.menuItemSlot.register(menuItems);\n  };\n\n  registerMenuRoutes = (routes: RouteProps[]) => {\n    this.menuSlot.register(routes);\n    return this;\n  };\n\n  setComponents = (components: ComponentModel[]) => {\n    this.componentUi.updateComponents(components);\n  };\n\n  registerSidebarLink = (...links: SidebarItem[]) => {\n    this.sidebarItemSlot.register(links);\n  };\n\n  /**\n   * register component filters\n   */\n  registerDrawerComponentFilters = (filters: ComponentFilters) => {\n    this.drawerComponentsFiltersSlot.register(filters);\n  };\n\n  registerDrawerWidgets = (widgets: ReactNode[]) => {\n    this.drawerWidgetSlot.register(widgets);\n  };\n\n  uiRoot(): UIRoot {\n    this.registerDrawers(\n      workspaceDrawer({\n        treeWidgets: this.sidebarSlot,\n        drawerWidgetSlot: this.drawerWidgetSlot,\n        filtersSlot: this.drawerComponentsFiltersSlot,\n      })\n    );\n\n    const [setKeyBindHandler] = this.commandBarUI.addCommand({\n      id: 'sidebar.toggle', // TODO - extract to a component!\n      action: () => {},\n      displayName: 'Toggle component list',\n      keybinding: 'alt+s',\n    });\n    this.setKeyBindHandler = setKeyBindHandler;\n\n    return {\n      routes: [\n        {\n          path: '/*',\n          element: (\n            <Workspace\n              menuSlot={this.menuSlot}\n              routeSlot={this.routeSlot}\n              sidebar={<this.sidebar.render items={this.listSidebarItems()} />}\n              workspaceUI={this}\n              onSidebarTogglerChange={this.setKeyBindHandler}\n            />\n          ),\n        },\n      ],\n    };\n  }\n\n  listSidebarItems() {\n    const items = flatten(this.sidebarItemSlot.values());\n    return compact(\n      items.map((item) => {\n        return item.component;\n      })\n    );\n  }\n\n  private menuItems: MenuItem[] = [\n    {\n      category: 'general',\n      title: 'Open command bar',\n      keyChar: 'mod+k',\n      handler: () => this.commandBarUI?.run('command-bar.open'),\n    },\n    {\n      category: 'general',\n      title: 'Toggle component list',\n      keyChar: 'alt+s',\n      handler: () => this.commandBarUI?.run('sidebar.toggle'),\n    },\n  ];\n\n  static dependencies = [UIAspect, ComponentAspect, SidebarAspect, ComponentTreeAspect, CommandBarAspect, GraphAspect];\n\n  static runtime = UIRuntime;\n\n  static slots = [\n    Slot.withType<RouteProps>(),\n    Slot.withType<RouteProps>(),\n    Slot.withType<ComponentTreeNode>(),\n    Slot.withType<MenuItemSlot>(),\n    Slot.withType<SidebarItemSlot>(),\n    Slot.withType<DrawerWidgetSlot>(),\n    Slot.withType<ComponentFiltersSlot>(),\n  ];\n\n  static async provider(\n    [ui, componentUi, sidebar, componentTree, commandBarUI, graphUI]: [\n      UiUI,\n      ComponentUI,\n      SidebarUI,\n      ComponentTreeUI,\n      CommandBarUI,\n      GraphUI\n    ],\n    config,\n    [routeSlot, menuSlot, menuItemSlot, sidebarSlot, sidebarItemSlot, drawerWidgetSlot, drawerComponentsFiltersSlot]: [\n      RouteSlot,\n      RouteSlot,\n      MenuItemSlot,\n      SidebarWidgetSlot,\n      SidebarItemSlot,\n      DrawerWidgetSlot,\n      ComponentFiltersSlot\n    ]\n  ) {\n    componentTree.registerTreeNode(new ComponentTreeWidget());\n    sidebarSlot.register(new ComponentTreeWidget());\n    graphUI.registerComponentWidget(new ComponentTreeWidget().widget);\n\n    const workspaceUI = new WorkspaceUI(\n      routeSlot,\n      componentUi,\n      menuSlot,\n      menuItemSlot,\n      sidebar,\n      sidebarSlot,\n      sidebarItemSlot,\n      drawerWidgetSlot,\n      drawerComponentsFiltersSlot,\n      commandBarUI\n    );\n\n    workspaceUI.registerDrawerComponentFilters([DeprecateFilter, EnvsFilter, ShowMainFilter(true)]);\n    workspaceUI.registerDrawerWidgets([\n      <FilterWidget key={'workspace-filter-widget'} />,\n      <TreeToggleWidget key={'workspace-tree-toggle-widget'} />,\n    ]);\n    ui.registerRoot(workspaceUI.uiRoot.bind(workspaceUI));\n    workspaceUI.registerMenuItem(workspaceUI.menuItems);\n\n    workspaceUI.registerSidebarLink({\n      component: function Gallery() {\n        return (\n          <MenuLinkItem exact href=\"/\" icon=\"comps\">\n            Workspace Overview\n          </MenuLinkItem>\n        );\n      },\n    });\n\n    workspaceUI.registerMenuRoutes([\n      {\n        path: '/',\n        element: <Menu menuItemSlot={workspaceUI.menuItemSlot} />,\n      },\n      {\n        path: workspaceUI.componentUi.routePath,\n        element: workspaceUI.componentUi.getMenu(WorkspaceAspect.id),\n      },\n    ]);\n\n    workspaceUI.registerRoutes([\n      {\n        path: workspaceUI.componentUi.routePath,\n        element: workspaceUI.componentUi.getComponentUI(WorkspaceAspect.id),\n      },\n    ]);\n\n    return workspaceUI;\n  }\n}\n\nexport default WorkspaceUI;\n\nWorkspaceAspect.addRuntime(WorkspaceUI);\n"],"mappings":";;;;;;;;;;;;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAGA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAMA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAIO,MAAMA,WAAW,CAAC;EACvBC,WAAW;EACT;AACJ;AACA;EACYC,SAAoB;EAE5B;AACJ;AACA;EACYC,WAAwB;EAEhC;AACJ;AACA;EACYC,QAAmB,EAEnBC,YAA0B,EAE1BC,OAAkB,EAElBC,WAA8B;EAEtC;AACJ;AACA;EACYC,eAAgC,EAEhCC,gBAAkC,EAElCC,2BAAiD,EAEjDC,YAA0B,EAClC;IAAA,KA5BQT,SAAoB,GAApBA,SAAoB;IAAA,KAKpBC,WAAwB,GAAxBA,WAAwB;IAAA,KAKxBC,QAAmB,GAAnBA,QAAmB;IAAA,KAEnBC,YAA0B,GAA1BA,YAA0B;IAAA,KAE1BC,OAAkB,GAAlBA,OAAkB;IAAA,KAElBC,WAA8B,GAA9BA,WAA8B;IAAA,KAK9BC,eAAgC,GAAhCA,eAAgC;IAAA,KAEhCC,gBAAkC,GAAlCA,gBAAkC;IAAA,KAElCC,2BAAiD,GAAjDA,2BAAiD;IAAA,KAEjDC,YAA0B,GAA1BA,YAA0B;IAAA,2DAG2B,MAAM,CAAC,CAAC;IAAA,0DAoBnDC,SAAqB,IAAK;MAC5C,IAAI,CAACP,YAAY,CAACQ,QAAQ,CAACD,SAAS,CAAC;IACvC,CAAC;IAAA,4DAEqBE,MAAoB,IAAK;MAC7C,IAAI,CAACV,QAAQ,CAACS,QAAQ,CAACC,MAAM,CAAC;MAC9B,OAAO,IAAI;IACb,CAAC;IAAA,uDAEgBC,UAA4B,IAAK;MAChD,IAAI,CAACZ,WAAW,CAACa,gBAAgB,CAACD,UAAU,CAAC;IAC/C,CAAC;IAAA,6DAEqB,CAAC,GAAGE,KAAoB,KAAK;MACjD,IAAI,CAACT,eAAe,CAACK,QAAQ,CAACI,KAAK,CAAC;IACtC,CAAC;IAAA,wEAKiCC,OAAyB,IAAK;MAC9D,IAAI,CAACR,2BAA2B,CAACG,QAAQ,CAACK,OAAO,CAAC;IACpD,CAAC;IAAA,+DAEwBC,OAAoB,IAAK;MAChD,IAAI,CAACV,gBAAgB,CAACI,QAAQ,CAACM,OAAO,CAAC;IACzC,CAAC;IAAA,mDA8C+B,CAC9B;MACEC,QAAQ,EAAE,SAAS;MACnBC,KAAK,EAAE,kBAAkB;MACzBC,OAAO,EAAE,OAAO;MAChBC,OAAO,EAAE;QAAA;QAAA,6BAAM,IAAI,CAACZ,YAAY,uDAAjB,mBAAmBa,GAAG,CAAC,kBAAkB,CAAC;MAAA;IAC3D,CAAC,EACD;MACEJ,QAAQ,EAAE,SAAS;MACnBC,KAAK,EAAE,uBAAuB;MAC9BC,OAAO,EAAE,OAAO;MAChBC,OAAO,EAAE;QAAA;QAAA,8BAAM,IAAI,CAACZ,YAAY,wDAAjB,oBAAmBa,GAAG,CAAC,gBAAgB,CAAC;MAAA;IACzD,CAAC,CACF;EA3GE;EAIH;AACF;AACA;EACEC,cAAc,CAACX,MAAoB,EAAE;IACnC,IAAI,CAACZ,SAAS,CAACW,QAAQ,CAACC,MAAM,CAAC;IAC/B,OAAO,IAAI;EACb;EAEAY,eAAe,CAAC,GAAGC,OAAqB,EAAE;IACxC,IAAI,CAACrB,OAAO,CAACsB,cAAc,CAAC,GAAGD,OAAO,CAAC;IACvC,OAAO,IAAI;EACb;EAEAE,qBAAqB,CAACC,iBAAoC,EAAE;IAC1D,IAAI,CAACvB,WAAW,CAACM,QAAQ,CAACiB,iBAAiB,CAAC;IAC5C,OAAO,IAAI;EACb;EA8BAC,MAAM,GAAW;IACf,IAAI,CAACL,eAAe,CAClB,IAAAM,8BAAe,EAAC;MACdC,WAAW,EAAE,IAAI,CAAC1B,WAAW;MAC7BE,gBAAgB,EAAE,IAAI,CAACA,gBAAgB;MACvCyB,WAAW,EAAE,IAAI,CAACxB;IACpB,CAAC,CAAC,CACH;IAED,MAAM,CAACyB,iBAAiB,CAAC,GAAG,IAAI,CAACxB,YAAY,CAACyB,UAAU,CAAC;MACvDC,EAAE,EAAE,gBAAgB;MAAE;MACtBC,MAAM,EAAE,MAAM,CAAC,CAAC;MAChBC,WAAW,EAAE,uBAAuB;MACpCC,UAAU,EAAE;IACd,CAAC,CAAC;IACF,IAAI,CAACL,iBAAiB,GAAGA,iBAAiB;IAE1C,OAAO;MACLrB,MAAM,EAAE,CACN;QACE2B,IAAI,EAAE,IAAI;QACVC,OAAO,eACL,+BAAC,gBAAS;UACR,QAAQ,EAAE,IAAI,CAACtC,QAAS;UACxB,SAAS,EAAE,IAAI,CAACF,SAAU;UAC1B,OAAO,eAAE,oCAAM,OAAO,CAAC,MAAM;YAAC,KAAK,EAAE,IAAI,CAACyC,gBAAgB;UAAG,EAAI;UACjE,WAAW,EAAE,IAAK;UAClB,sBAAsB,EAAE,IAAI,CAACR;QAAkB;MAGrD,CAAC;IAEL,CAAC;EACH;EAEAQ,gBAAgB,GAAG;IACjB,MAAMC,KAAK,GAAG,IAAAC,iBAAO,EAAC,IAAI,CAACrC,eAAe,CAACsC,MAAM,EAAE,CAAC;IACpD,OAAO,IAAAC,iBAAO,EACZH,KAAK,CAACI,GAAG,CAAEC,IAAI,IAAK;MAClB,OAAOA,IAAI,CAACC,SAAS;IACvB,CAAC,CAAC,CACH;EACH;EA+BA,aAAaC,QAAQ,CACnB,CAACC,EAAE,EAAEjD,WAAW,EAAEG,OAAO,EAAE+C,aAAa,EAAE1C,YAAY,EAAE2C,OAAO,CAO9D,EACDC,MAAM,EACN,CAACrD,SAAS,EAAEE,QAAQ,EAAEC,YAAY,EAAEE,WAAW,EAAEC,eAAe,EAAEC,gBAAgB,EAAEC,2BAA2B,CAQ9G,EACD;IACA2C,aAAa,CAACG,gBAAgB,CAAC,KAAIC,qCAAmB,GAAE,CAAC;IACzDlD,WAAW,CAACM,QAAQ,CAAC,KAAI4C,qCAAmB,GAAE,CAAC;IAC/CH,OAAO,CAACI,uBAAuB,CAAC,KAAID,qCAAmB,GAAE,CAACE,MAAM,CAAC;IAEjE,MAAMC,WAAW,GAAG,IAAI5D,WAAW,CACjCE,SAAS,EACTC,WAAW,EACXC,QAAQ,EACRC,YAAY,EACZC,OAAO,EACPC,WAAW,EACXC,eAAe,EACfC,gBAAgB,EAChBC,2BAA2B,EAC3BC,YAAY,CACb;IAEDiD,WAAW,CAACC,8BAA8B,CAAC,CAACC,8CAAe,EAAEC,0CAAU,EAAE,IAAAC,8CAAc,EAAC,IAAI,CAAC,CAAC,CAAC;IAC/FJ,WAAW,CAACK,qBAAqB,CAAC,cAChC,+BAAC,2BAAY;MAAC,GAAG,EAAE;IAA0B,EAAG,eAChD,+BAAC,+BAAgB;MAAC,GAAG,EAAE;IAA+B,EAAG,CAC1D,CAAC;IACFb,EAAE,CAACc,YAAY,CAACN,WAAW,CAAC7B,MAAM,CAACoC,IAAI,CAACP,WAAW,CAAC,CAAC;IACrDA,WAAW,CAACQ,gBAAgB,CAACR,WAAW,CAAChD,SAAS,CAAC;IAEnDgD,WAAW,CAACS,mBAAmB,CAAC;MAC9BnB,SAAS,EAAE,SAASoB,OAAO,GAAG;QAC5B,oBACE,+BAAC,oCAAY;UAAC,KAAK;UAAC,IAAI,EAAC,GAAG;UAAC,IAAI,EAAC;QAAO,wBAE1B;MAEnB;IACF,CAAC,CAAC;IAEFV,WAAW,CAACW,kBAAkB,CAAC,CAC7B;MACE9B,IAAI,EAAE,GAAG;MACTC,OAAO,eAAE,+BAAC,sBAAI;QAAC,YAAY,EAAEkB,WAAW,CAACvD;MAAa;IACxD,CAAC,EACD;MACEoC,IAAI,EAAEmB,WAAW,CAACzD,WAAW,CAACqE,SAAS;MACvC9B,OAAO,EAAEkB,WAAW,CAACzD,WAAW,CAACsE,OAAO,CAACC,4BAAe,CAACrC,EAAE;IAC7D,CAAC,CACF,CAAC;IAEFuB,WAAW,CAACnC,cAAc,CAAC,CACzB;MACEgB,IAAI,EAAEmB,WAAW,CAACzD,WAAW,CAACqE,SAAS;MACvC9B,OAAO,EAAEkB,WAAW,CAACzD,WAAW,CAACwE,cAAc,CAACD,4BAAe,CAACrC,EAAE;IACpE,CAAC,CACF,CAAC;IAEF,OAAOuB,WAAW;EACpB;AACF;AAAC;AAAA,gCAvOY5D,WAAW,kBA8IA,CAAC4E,cAAQ,EAAEC,4BAAe,EAAEC,kBAAa,EAAEC,oCAAmB,EAAEC,qBAAgB,EAAEC,oBAAW,CAAC;AAAA,gCA9IzGjF,WAAW,aAgJLkF,eAAS;AAAA,gCAhJflF,WAAW,WAkJP,CACbmF,eAAI,CAACC,QAAQ,EAAc,EAC3BD,eAAI,CAACC,QAAQ,EAAc,EAC3BD,eAAI,CAACC,QAAQ,EAAqB,EAClCD,eAAI,CAACC,QAAQ,EAAgB,EAC7BD,eAAI,CAACC,QAAQ,EAAmB,EAChCD,eAAI,CAACC,QAAQ,EAAoB,EACjCD,eAAI,CAACC,QAAQ,EAAwB,CACtC;AAAA,eA+EYpF,WAAW;AAAA;AAE1B0E,4BAAe,CAACW,UAAU,CAACrF,WAAW,CAAC"}