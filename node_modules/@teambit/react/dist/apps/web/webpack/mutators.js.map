{"version":3,"names":["addDevServer","configMutator","addTopLevel","allowedHosts","historyApiFallback","index","disableDotRule","headers","setOutput","raw","output","publicPath","replaceTerserPlugin","prerender","optimization","minimizer","remove","constructor","name","terserer","CreateTerserPluginForPrerender","CreateTerserPlugin","push","TerserPlugin","minify","esbuildMinify","terserOptions","extractComments","parse","ecma","compress","warnings","comparisons","inline","mangle","safari10","comments","ascii_only"],"sources":["mutators.ts"],"sourcesContent":["import { WebpackConfigMutator } from '@teambit/webpack';\nimport { remove } from 'lodash';\nimport TerserPlugin from 'terser-webpack-plugin';\n\nexport function addDevServer(configMutator: WebpackConfigMutator) {\n  return configMutator.addTopLevel('devServer', {\n    allowedHosts: 'all',\n    historyApiFallback: {\n      index: '/index.html',\n      disableDotRule: true,\n    },\n    headers: {\n      'Access-Control-Allow-Origin': '*',\n    },\n  });\n}\n\nexport function setOutput(configMutator: WebpackConfigMutator) {\n  if (!configMutator.raw.output) configMutator.raw.output = {};\n  configMutator.raw.output.publicPath = '/';\n\n  return configMutator;\n}\n\nexport function replaceTerserPlugin({ prerender = false }: { prerender: boolean }) {\n  return (configMutator: WebpackConfigMutator) => {\n    if (!configMutator.raw.optimization?.minimizer) return configMutator;\n\n    remove(configMutator.raw.optimization?.minimizer, (minimizer) => {\n      return minimizer.constructor.name === 'TerserPlugin';\n    });\n\n    const terserer = prerender ? CreateTerserPluginForPrerender() : CreateTerserPlugin();\n    configMutator.raw.optimization?.minimizer.push(terserer);\n\n    return configMutator;\n  };\n}\n\nfunction CreateTerserPlugin() {\n  return new TerserPlugin({\n    minify: TerserPlugin.esbuildMinify,\n    // `terserOptions` options will be passed to `esbuild`\n    // Link to options - https://esbuild.github.io/api/#minify\n    terserOptions: {\n      minify: true,\n    },\n  });\n}\n\nfunction CreateTerserPluginForPrerender() {\n  return new TerserPlugin({\n    extractComments: false,\n    terserOptions: {\n      parse: {\n        // We want terser to parse ecma 8 code. However, we don't want it\n        // to apply any minification steps that turns valid ecma 5 code\n        // into invalid ecma 5 code. This is why the 'compress' and 'output'\n        // sections only apply transformations that are ecma 5 safe\n        // https://github.com/facebook/create-react-app/pull/4234\n        ecma: 8,\n      },\n      compress: {\n        ecma: 5,\n        warnings: false,\n        // Disabled because of an issue with Uglify breaking seemingly valid code:\n        // https://github.com/facebook/create-react-app/issues/2376\n        // Pending further investigation:\n        // https://github.com/mishoo/UglifyJS2/issues/2011\n        comparisons: false,\n        // Disabled because of an issue with Terser breaking valid code:\n        // https://github.com/facebook/create-react-app/issues/5250\n        // Pending further investigation:\n        // https://github.com/terser-js/terser/issues/120\n        inline: 2,\n      },\n      mangle: {\n        safari10: true,\n      },\n      output: {\n        ecma: 5,\n        comments: false,\n        // Turned on because emoji and regex is not minified properly using default\n        // https://github.com/facebook/create-react-app/issues/2488\n        ascii_only: true,\n      },\n    },\n  });\n}\n"],"mappings":";;;;;;;;;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEO,SAASA,YAAY,CAACC,aAAmC,EAAE;EAChE,OAAOA,aAAa,CAACC,WAAW,CAAC,WAAW,EAAE;IAC5CC,YAAY,EAAE,KAAK;IACnBC,kBAAkB,EAAE;MAClBC,KAAK,EAAE,aAAa;MACpBC,cAAc,EAAE;IAClB,CAAC;IACDC,OAAO,EAAE;MACP,6BAA6B,EAAE;IACjC;EACF,CAAC,CAAC;AACJ;AAEO,SAASC,SAAS,CAACP,aAAmC,EAAE;EAC7D,IAAI,CAACA,aAAa,CAACQ,GAAG,CAACC,MAAM,EAAET,aAAa,CAACQ,GAAG,CAACC,MAAM,GAAG,CAAC,CAAC;EAC5DT,aAAa,CAACQ,GAAG,CAACC,MAAM,CAACC,UAAU,GAAG,GAAG;EAEzC,OAAOV,aAAa;AACtB;AAEO,SAASW,mBAAmB,CAAC;EAAEC,SAAS,GAAG;AAA8B,CAAC,EAAE;EACjF,OAAQZ,aAAmC,IAAK;IAAA;IAC9C,IAAI,2BAACA,aAAa,CAACQ,GAAG,CAACK,YAAY,kDAA9B,sBAAgCC,SAAS,GAAE,OAAOd,aAAa;IAEpE,IAAAe,gBAAM,4BAACf,aAAa,CAACQ,GAAG,CAACK,YAAY,2DAA9B,uBAAgCC,SAAS,EAAGA,SAAS,IAAK;MAC/D,OAAOA,SAAS,CAACE,WAAW,CAACC,IAAI,KAAK,cAAc;IACtD,CAAC,CAAC;IAEF,MAAMC,QAAQ,GAAGN,SAAS,GAAGO,8BAA8B,EAAE,GAAGC,kBAAkB,EAAE;IACpF,0BAAApB,aAAa,CAACQ,GAAG,CAACK,YAAY,2DAA9B,uBAAgCC,SAAS,CAACO,IAAI,CAACH,QAAQ,CAAC;IAExD,OAAOlB,aAAa;EACtB,CAAC;AACH;AAEA,SAASoB,kBAAkB,GAAG;EAC5B,OAAO,KAAIE,8BAAY,EAAC;IACtBC,MAAM,EAAED,8BAAY,CAACE,aAAa;IAClC;IACA;IACAC,aAAa,EAAE;MACbF,MAAM,EAAE;IACV;EACF,CAAC,CAAC;AACJ;AAEA,SAASJ,8BAA8B,GAAG;EACxC,OAAO,KAAIG,8BAAY,EAAC;IACtBI,eAAe,EAAE,KAAK;IACtBD,aAAa,EAAE;MACbE,KAAK,EAAE;QACL;QACA;QACA;QACA;QACA;QACAC,IAAI,EAAE;MACR,CAAC;MACDC,QAAQ,EAAE;QACRD,IAAI,EAAE,CAAC;QACPE,QAAQ,EAAE,KAAK;QACf;QACA;QACA;QACA;QACAC,WAAW,EAAE,KAAK;QAClB;QACA;QACA;QACA;QACAC,MAAM,EAAE;MACV,CAAC;MACDC,MAAM,EAAE;QACNC,QAAQ,EAAE;MACZ,CAAC;MACDzB,MAAM,EAAE;QACNmB,IAAI,EAAE,CAAC;QACPO,QAAQ,EAAE,KAAK;QACf;QACA;QACAC,UAAU,EAAE;MACd;IACF;EACF,CAAC,CAAC;AACJ"}