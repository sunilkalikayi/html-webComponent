{"version":3,"names":["ReactApp","constructor","name","entry","ssr","portRange","reactEnv","logger","dependencyResolver","prerender","bundler","ssrBundler","devServer","transformers","deploy","favicon","run","context","from","to","port","Port","getPort","listen","devServerContext","getDevServerContext","getDevServer","addDevServer","setOutput","runSsr","clientBundle","buildClient","errors","length","info","serverBundle","buildSsr","app","loadSsrApp","workdir","appName","expressApp","createExpressSsr","assets","parseAssets","htmlConfig","title","templateContent","html","minify","ctx","Object","assign","create","targets","entries","getEntries","components","appComponent","outputPath","resolve","calcOutputPath","hostDependencies","getPeers","aliasHostDependencies","capsuleNetwork","undefined","previousTasksResults","getBundler","config","merge","clientConfig","bundleResult","getSsrEntries","ssrConfig","build","ssrAppDir","join","getPublicDir","artifactsDir","buildSsrApp","computeResults","publicDir","dir","ssrPublicDir","getSsrBundler","runner","readFileSync","__dirname","toString","capsule","fs","writeFileSync","capsuleSsrDir","getPath","installer","getInstaller","packageManager","rootDir","cacheRootDirectory","install","getSsrPolicy","ComponentMap","Map","workspacePolicy","WorkspacePolicy","add","lifecycleType","dependencyId","value","version","getDefaultBundler","getDefaultSsrBundler","path","bundlerContext","getBuildContext","compact","configMutator","buildConfig","addPlugin","prerenderPlugin","replaceTerserPlugin","env","ssrBuildConfig","ssrDir","distDir","getCompiler","targetEntries","map","require","basename","component","hostRootDir","rootPath","metaData","initiator","envId","id","applicationType","Array","isArray","BitError","publicPath","getPeerDependenciesList"],"sources":["react.application.ts"],"sourcesContent":["import { readFileSync } from 'fs';\nimport { join, resolve, basename } from 'path';\nimport { Application, AppContext, AppBuildContext, AppResult } from '@teambit/application';\nimport type { Bundler, DevServer, BundlerContext, DevServerContext, BundlerHtmlConfig } from '@teambit/bundler';\nimport { Port } from '@teambit/toolbox.network.get-port';\nimport { ComponentMap } from '@teambit/component';\nimport type { Logger } from '@teambit/logger';\nimport { DependencyResolverMain, WorkspacePolicy } from '@teambit/dependency-resolver';\nimport compact from 'lodash.compact';\nimport { WebpackConfigTransformer } from '@teambit/webpack';\nimport { BitError } from '@teambit/bit-error';\nimport { ReactEnv } from '../../react.env';\nimport { prerenderPlugin } from './plugins';\nimport { ReactAppBuildResult } from './react-build-result';\nimport { ReactAppPrerenderOptions } from './react-app-options';\nimport { html } from '../../webpack';\nimport { ReactDeployContext } from '.';\nimport { computeResults } from './compute-results';\nimport { clientConfig, ssrConfig, calcOutputPath, ssrBuildConfig, buildConfig } from './webpack/webpack.app.ssr.config';\nimport { addDevServer, setOutput, replaceTerserPlugin } from './webpack/mutators';\nimport { createExpressSsr, loadSsrApp, parseAssets } from './ssr/ssr-express';\n\nexport class ReactApp implements Application {\n  constructor(\n    readonly name: string,\n    readonly entry: string[] | ((path?: string) => Promise<string[]>),\n    readonly ssr: string | (() => Promise<string>) | undefined,\n    readonly portRange: [number, number],\n    private reactEnv: ReactEnv,\n    private logger: Logger,\n    private dependencyResolver: DependencyResolverMain,\n    readonly prerender?: ReactAppPrerenderOptions,\n    readonly bundler?: Bundler,\n    readonly ssrBundler?: Bundler,\n    readonly devServer?: DevServer,\n    readonly transformers: WebpackConfigTransformer[] = [],\n    readonly deploy?: (context: ReactDeployContext) => Promise<void>,\n    readonly favicon?: string\n  ) {}\n  readonly applicationType = 'react-common-js';\n  readonly dir = 'public';\n  readonly ssrDir = 'ssr';\n\n  async run(context: AppContext): Promise<number> {\n    const [from, to] = this.portRange;\n    const port = await Port.getPort(from, to);\n\n    if (this.devServer) {\n      await this.devServer.listen(port);\n      return port;\n    }\n\n    const devServerContext = await this.getDevServerContext(context);\n    const devServer = this.reactEnv.getDevServer(devServerContext, [addDevServer, setOutput, ...this.transformers]);\n    await devServer.listen(port);\n    return port;\n  }\n\n  async runSsr(context: AppContext): Promise<AppResult> {\n    const [from, to] = this.portRange;\n    const port = await Port.getPort(from, to);\n\n    // bundle client\n    const clientBundle = await this.buildClient(context);\n    if (clientBundle.errors.length > 0) return { errors: clientBundle.errors };\n    this.logger?.info('[react.application] [ssr] client bundle - complete');\n\n    // bundle server\n    const serverBundle = await this.buildSsr(context);\n    if (serverBundle.errors.length > 0) return { errors: serverBundle.errors };\n    this.logger?.info('[react.application] [ssr] server bundle - complete');\n\n    // load server-side runtime\n    const app = await loadSsrApp(context.workdir, context.appName);\n    this.logger?.info('[react.application] [ssr] bundle code - loaded');\n\n    const expressApp = createExpressSsr({\n      name: context.appName,\n      workdir: context.workdir,\n      port,\n      app,\n      assets: parseAssets(clientBundle.assets),\n      logger: this.logger,\n    });\n\n    expressApp.listen(port);\n    return { port };\n  }\n\n  private async buildClient(context: AppContext) {\n    const htmlConfig: BundlerHtmlConfig[] = [\n      {\n        title: context.appName,\n        templateContent: html(context.appName),\n        minify: false,\n        favicon: this.favicon,\n      },\n    ];\n\n    // extend, including prototype methods\n    const ctx: BundlerContext = Object.assign(Object.create(context), {\n      html: htmlConfig,\n      targets: [\n        {\n          entries: await this.getEntries(),\n          components: [context.appComponent],\n          outputPath: resolve(context.workdir, calcOutputPath(context.appName, 'browser')),\n          hostDependencies: await this.getPeers(),\n          aliasHostDependencies: true,\n        },\n      ],\n\n      // @ts-ignore\n      capsuleNetwork: undefined,\n      previousTasksResults: [],\n    });\n\n    const bundler = await this.reactEnv.getBundler(ctx, [\n      (config) => config.merge([clientConfig()]),\n      ...this.transformers,\n    ]);\n\n    const bundleResult = await bundler.run();\n    return bundleResult[0];\n  }\n\n  private async buildSsr(context: AppContext) {\n    // extend, including prototype methods\n    const ctx: BundlerContext = Object.assign(Object.create(context), {\n      ...context,\n      targets: [\n        {\n          entries: await this.getSsrEntries(),\n          components: [context.appComponent],\n          outputPath: resolve(context.workdir, calcOutputPath(context.appName, 'ssr')),\n          hostDependencies: await this.getPeers(),\n          aliasHostDependencies: true,\n        },\n      ],\n\n      // @ts-ignore\n      capsuleNetwork: undefined,\n      previousTasksResults: [],\n    });\n\n    const bundler = await this.reactEnv.getBundler(ctx, [\n      (config) => config.merge([ssrConfig()]),\n      ...this.transformers,\n    ]);\n\n    const bundleResult = await bundler.run();\n    return bundleResult[0];\n  }\n\n  async build(context: AppBuildContext): Promise<ReactAppBuildResult> {\n    const htmlConfig: BundlerHtmlConfig[] = [\n      {\n        title: context.name,\n        templateContent: html(context.name),\n        minify: false,\n        favicon: this.favicon,\n        // filename: ''.html`,\n      },\n    ];\n    Object.assign(context, {\n      html: htmlConfig,\n    });\n    const bundler = await this.getBundler(context);\n    const bundleResult = await bundler.run();\n    const ssrAppDir = join(this.getPublicDir(context.artifactsDir));\n\n    if (this.ssr) await this.buildSsrApp(context, ssrAppDir);\n    return computeResults(bundleResult, {\n      publicDir: `${this.getPublicDir(context.artifactsDir)}/${this.dir}`,\n      ssrPublicDir: ssrAppDir,\n    });\n  }\n\n  private async buildSsrApp(context: AppBuildContext, ssrAppDir: string) {\n    const ssrBundler = await this.getSsrBundler(context);\n    await ssrBundler.run();\n    const runner = readFileSync(join(__dirname, './ssr/app/runner')).toString();\n    context.capsule.fs.writeFileSync(join(ssrAppDir, 'runner.js'), runner);\n    const capsuleSsrDir = context.capsule.fs.getPath(ssrAppDir);\n    const installer = this.dependencyResolver.getInstaller({\n      packageManager: 'teambit.dependencies/yarn',\n      rootDir: capsuleSsrDir,\n      cacheRootDirectory: capsuleSsrDir,\n    });\n    await installer.install(capsuleSsrDir, this.getSsrPolicy(), new ComponentMap(new Map()));\n    return ssrAppDir;\n  }\n\n  private getSsrPolicy() {\n    const workspacePolicy = new WorkspacePolicy([]);\n    workspacePolicy.add({ lifecycleType: 'runtime', dependencyId: 'express', value: { version: '4.18.1' } });\n    workspacePolicy.add({\n      lifecycleType: 'runtime',\n      dependencyId: '@teambit/react.rendering.ssr',\n      value: { version: '0.0.3' },\n    });\n    workspacePolicy.add({\n      lifecycleType: 'runtime',\n      dependencyId: '@teambit/ui-foundation.ui.pages.static-error',\n      value: { version: '0.0.75' },\n    });\n\n    workspacePolicy.add({\n      lifecycleType: 'peer',\n      dependencyId: 'react',\n      value: { version: '17.0.2' },\n    });\n\n    workspacePolicy.add({\n      lifecycleType: 'peer',\n      dependencyId: 'react-dom',\n      value: { version: '17.0.2' },\n    });\n    return workspacePolicy;\n  }\n\n  private getBundler(context: AppBuildContext) {\n    if (this.bundler) return this.bundler;\n    return this.getDefaultBundler(context);\n  }\n\n  private getSsrBundler(context: AppBuildContext) {\n    if (this.ssrBundler) return this.ssrBundler;\n    return this.getDefaultSsrBundler(context);\n  }\n\n  private async getDefaultBundler(context: AppBuildContext) {\n    const { capsule } = context;\n    const publicDir = this.getPublicDir(context.artifactsDir);\n    const outputPath = join(capsule.path, publicDir);\n\n    const bundlerContext = await this.getBuildContext(context, { outputPath });\n    const transformers: WebpackConfigTransformer[] = compact([\n      (configMutator) => configMutator.merge(buildConfig({ outputPath: join(outputPath, this.dir) })),\n      (config) => {\n        if (this.prerender) config.addPlugin(prerenderPlugin(this.prerender));\n        return config;\n      },\n      replaceTerserPlugin({ prerender: !!this.prerender }),\n      ...this.transformers,\n    ]);\n\n    const reactEnv = context.env as ReactEnv;\n    const bundler: Bundler = await reactEnv.getBundler(bundlerContext, transformers);\n    return bundler;\n  }\n\n  private async getDefaultSsrBundler(context: AppBuildContext) {\n    const { capsule } = context;\n    const publicDir = this.getPublicDir(context.artifactsDir);\n    const outputPath = join(capsule.path, publicDir);\n\n    const bundlerContext = await this.getBuildContext(context, { outputPath });\n    const transformers: WebpackConfigTransformer[] = compact([\n      (configMutator) => configMutator.merge(ssrBuildConfig({ outputPath: join(outputPath, this.ssrDir) })),\n      replaceTerserPlugin({ prerender: !!this.prerender }),\n      ...this.transformers,\n    ]);\n\n    const reactEnv = context.env as ReactEnv;\n    const bundler: Bundler = await reactEnv.getBundler(bundlerContext, transformers);\n    return bundler;\n  }\n\n  private async getBuildContext(context: AppBuildContext, { outputPath }: { outputPath: string }) {\n    const { capsule } = context;\n    const reactEnv = context.env as ReactEnv;\n    const { distDir } = reactEnv.getCompiler();\n    const targetEntries = await this.getEntries(`${capsule.path}/${distDir}`);\n    const entries = targetEntries.map((entry) => require.resolve(`${capsule.path}/${distDir}/${basename(entry)}`));\n\n    const bundlerContext: BundlerContext = Object.assign(context, {\n      targets: [\n        {\n          components: [capsule?.component],\n          entries,\n          outputPath,\n          hostRootDir: capsule?.path,\n          hostDependencies: await this.getPeers(),\n          aliasHostDependencies: true,\n        },\n      ],\n      entry: [],\n      rootPath: '/',\n      metaData: {\n        initiator: `building app: ${context.name}`,\n        envId: context.id,\n      },\n    });\n\n    return bundlerContext;\n  }\n\n  private getPublicDir(artifactsDir: string) {\n    return join(artifactsDir, this.applicationType, this.name);\n  }\n\n  async getEntries(path?: string): Promise<string[]> {\n    if (Array.isArray(this.entry)) return this.entry;\n    return this.entry(path);\n  }\n\n  async getSsrEntries(): Promise<string[]> {\n    if (!this.ssr) throw new BitError('tried to build ssr without ssr entries');\n    if (typeof this.ssr === 'string') return [this.ssr];\n    return [await this.ssr()];\n  }\n\n  private async getDevServerContext(context: AppContext): Promise<DevServerContext> {\n    const entries = await this.getEntries();\n    return Object.assign(context, {\n      entry: entries,\n      rootPath: '',\n      publicPath: `public/${this.name}`,\n      title: this.name,\n      favicon: this.favicon,\n      hostDependencies: await this.getPeers(),\n      aliasHostDependencies: true,\n    });\n  }\n\n  private getPeers(): Promise<string[]> {\n    return this.reactEnv.getPeerDependenciesList();\n  }\n}\n"],"mappings":"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"}