{"version":3,"names":["DocsPreview","constructor","preview","componentId","modules","compositions","context","docsModule","selectPreviewModel","fullName","isObject","mainModule","default","apiObject","docsPropsArray","NoopProvider","toString","docsProps","Provider","docs","relevant","componentMap","undefined","provider","docsPreview","registerPreview","name","render","bind","include","PreviewRuntime","PreviewAspect","DocsAspect","addRuntime","children"],"sources":["docs.preview.runtime.tsx"],"sourcesContent":["import React, { ReactNode } from 'react';\nimport { PreviewAspect, RenderingContext, PreviewPreview, PreviewRuntime, PreviewModule } from '@teambit/preview';\nimport { ComponentID } from '@teambit/component-id';\n\nimport { DocsAspect } from './docs.aspect';\nimport type { Docs } from './docs';\n\nexport type DocsRootProps = {\n  Provider: React.ComponentType | undefined;\n  componentId: string;\n  docs: Docs | undefined;\n  compositions: any;\n  context: RenderingContext;\n};\n\nexport class DocsPreview {\n  constructor(\n    /**\n     * preview extension.\n     */\n    private preview: PreviewPreview\n  ) {}\n\n  render = (componentId: ComponentID, modules: PreviewModule, [compositions]: [any], context: RenderingContext) => {\n    const docsModule = this.selectPreviewModel(componentId.fullName, modules);\n\n    const isObject = !!modules.mainModule.default.apiObject;\n\n    /**\n     * for backwards compatibility - can be removed end of 2022\n     */\n    if (!isObject) {\n      const docsPropsArray = [\n        NoopProvider as React.ComponentType,\n        componentId.toString(),\n        docsModule as Docs,\n        compositions,\n        context,\n      ];\n      modules.mainModule.default(...docsPropsArray);\n      return;\n    }\n\n    const docsProps: DocsRootProps = {\n      Provider: NoopProvider as React.ComponentType,\n      componentId: componentId.toString(),\n      docs: docsModule as Docs,\n      compositions,\n      context,\n    };\n\n    modules.mainModule.default(docsProps);\n  };\n\n  selectPreviewModel(componentId: string, modules: PreviewModule) {\n    const relevant = modules.componentMap[componentId];\n    if (!relevant) return undefined;\n\n    // only one doc file is supported.\n    return relevant[0];\n  }\n\n  static runtime = PreviewRuntime;\n  static dependencies = [PreviewAspect];\n\n  static async provider([preview]: [PreviewPreview]) {\n    const docsPreview = new DocsPreview(preview);\n    preview.registerPreview({\n      name: 'overview',\n      render: docsPreview.render.bind(docsPreview),\n      selectPreviewModel: docsPreview.selectPreviewModel.bind(docsPreview),\n      include: ['compositions'],\n    });\n\n    return docsPreview;\n  }\n}\n\nDocsAspect.addRuntime(DocsPreview);\n\nfunction NoopProvider({ children }: { children: ReactNode }) {\n  return <>{children}</>;\n}\n"],"mappings":";;;;;;;;;;;;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAGA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAWO,MAAMA,WAAW,CAAC;EACvBC,WAAW;EACT;AACJ;AACA;EACYC,OAAuB,EAC/B;IAAA,KADQA,OAAuB,GAAvBA,OAAuB;IAAA,gDAGxB,CAACC,WAAwB,EAAEC,OAAsB,EAAE,CAACC,YAAY,CAAQ,EAAEC,OAAyB,KAAK;MAC/G,MAAMC,UAAU,GAAG,IAAI,CAACC,kBAAkB,CAACL,WAAW,CAACM,QAAQ,EAAEL,OAAO,CAAC;MAEzE,MAAMM,QAAQ,GAAG,CAAC,CAACN,OAAO,CAACO,UAAU,CAACC,OAAO,CAACC,SAAS;;MAEvD;AACJ;AACA;MACI,IAAI,CAACH,QAAQ,EAAE;QACb,MAAMI,cAAc,GAAG,CACrBC,YAAY,EACZZ,WAAW,CAACa,QAAQ,EAAE,EACtBT,UAAU,EACVF,YAAY,EACZC,OAAO,CACR;QACDF,OAAO,CAACO,UAAU,CAACC,OAAO,CAAC,GAAGE,cAAc,CAAC;QAC7C;MACF;MAEA,MAAMG,SAAwB,GAAG;QAC/BC,QAAQ,EAAEH,YAAmC;QAC7CZ,WAAW,EAAEA,WAAW,CAACa,QAAQ,EAAE;QACnCG,IAAI,EAAEZ,UAAkB;QACxBF,YAAY;QACZC;MACF,CAAC;MAEDF,OAAO,CAACO,UAAU,CAACC,OAAO,CAACK,SAAS,CAAC;IACvC,CAAC;EA/BE;EAiCHT,kBAAkB,CAACL,WAAmB,EAAEC,OAAsB,EAAE;IAC9D,MAAMgB,QAAQ,GAAGhB,OAAO,CAACiB,YAAY,CAAClB,WAAW,CAAC;IAClD,IAAI,CAACiB,QAAQ,EAAE,OAAOE,SAAS;;IAE/B;IACA,OAAOF,QAAQ,CAAC,CAAC,CAAC;EACpB;EAKA,aAAaG,QAAQ,CAAC,CAACrB,OAAO,CAAmB,EAAE;IACjD,MAAMsB,WAAW,GAAG,IAAIxB,WAAW,CAACE,OAAO,CAAC;IAC5CA,OAAO,CAACuB,eAAe,CAAC;MACtBC,IAAI,EAAE,UAAU;MAChBC,MAAM,EAAEH,WAAW,CAACG,MAAM,CAACC,IAAI,CAACJ,WAAW,CAAC;MAC5ChB,kBAAkB,EAAEgB,WAAW,CAAChB,kBAAkB,CAACoB,IAAI,CAACJ,WAAW,CAAC;MACpEK,OAAO,EAAE,CAAC,cAAc;IAC1B,CAAC,CAAC;IAEF,OAAOL,WAAW;EACpB;AACF;AAAC;AAAA,gCA7DYxB,WAAW,aA+CL8B,yBAAc;AAAA,gCA/CpB9B,WAAW,kBAgDA,CAAC+B,wBAAa,CAAC;AAevCC,kBAAU,CAACC,UAAU,CAACjC,WAAW,CAAC;AAElC,SAASe,YAAY,CAAC;EAAEmB;AAAkC,CAAC,EAAE;EAC3D,oBAAO,gEAAGA,QAAQ,CAAI;AACxB"}