{"version":3,"names":["ReactNativeEnvType","ReactNativeEnv","constructor","react","aspect","getHostDependencies","reactAdditional","reactEnv","getAdditionalHostDependencies","currentPeers","Object","keys","getDependencies","peerDependencies","uniq","concat","filter","dep","getTemplateBundler","context","transformers","createTemplateWebpackBundler","aspectEnv","removeExposedReactNative","removeReactNativePeerEntry","reactNativeAlias","dependencies","devDependencies","__getDescriptor","type"],"sources":["react-native.env.ts"],"sourcesContent":["import { AspectMain } from '@teambit/aspect';\nimport { Bundler, BundlerContext } from '@teambit/bundler';\nimport { Environment, DependenciesEnv, PreviewEnv } from '@teambit/envs';\nimport type { ReactMain } from '@teambit/react';\nimport { WebpackConfigTransformer } from '@teambit/webpack';\nimport { uniq } from 'lodash';\nimport { reactNativeAlias } from './webpack/react-native-alias';\n\nimport { removeExposedReactNative, removeReactNativePeerEntry } from './webpack/webpack-template-transformers';\n\nexport const ReactNativeEnvType = 'react-native';\n\nexport class ReactNativeEnv implements Environment, DependenciesEnv, PreviewEnv {\n  constructor(private react: ReactMain, private aspect: AspectMain) {}\n\n  async getHostDependencies() {\n    const reactAdditional = await this.react.reactEnv.getAdditionalHostDependencies();\n    const currentPeers = Object.keys(this.getDependencies().peerDependencies);\n    // We filter react-native as we don't want to bundle it to the web\n    return uniq(reactAdditional.concat(currentPeers).filter((dep) => dep !== 'react-native'));\n  }\n\n  async getTemplateBundler(context: BundlerContext, transformers: WebpackConfigTransformer[] = []): Promise<Bundler> {\n    return this.createTemplateWebpackBundler(context, transformers);\n  }\n\n  async createTemplateWebpackBundler(\n    context: BundlerContext,\n    transformers: WebpackConfigTransformer[] = []\n  ): Promise<Bundler> {\n    return this.aspect.aspectEnv.createTemplateWebpackBundler(context, [\n      removeExposedReactNative,\n      removeReactNativePeerEntry,\n      reactNativeAlias,\n      ...transformers,\n    ]);\n  }\n\n  getDependencies() {\n    return {\n      dependencies: {\n        react: '-',\n        'react-dom': '-',\n        'react-native': '-',\n      },\n      devDependencies: {\n        react: '-',\n        'react-dom': '-',\n        'react-native': '-',\n        '@types/jest': '^26.0.0',\n        '@types/react': '^17.0.8',\n        '@types/react-dom': '^17.0.5',\n        '@types/react-native': '^0.64.1',\n        // This is added as dev dep since our jest file transformer uses babel plugins that require this to be installed\n        '@babel/runtime': '7.12.18',\n        '@types/testing-library__jest-dom': '5.9.5',\n      },\n      peerDependencies: {\n        react: '^16.8.0 || ^17.0.0',\n        'react-dom': '^16.8.0 || ^17.0.0',\n        'react-native': '^0.64.1',\n        'react-native-web': '^0.16.0',\n      },\n    };\n  }\n\n  async __getDescriptor() {\n    return {\n      type: ReactNativeEnvType,\n    };\n  }\n}\n"],"mappings":";;;;;;;;AAKA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEO,MAAMA,kBAAkB,GAAG,cAAc;AAAC;AAE1C,MAAMC,cAAc,CAAqD;EAC9EC,WAAW,CAASC,KAAgB,EAAUC,MAAkB,EAAE;IAAA,KAA9CD,KAAgB,GAAhBA,KAAgB;IAAA,KAAUC,MAAkB,GAAlBA,MAAkB;EAAG;EAEnE,MAAMC,mBAAmB,GAAG;IAC1B,MAAMC,eAAe,GAAG,MAAM,IAAI,CAACH,KAAK,CAACI,QAAQ,CAACC,6BAA6B,EAAE;IACjF,MAAMC,YAAY,GAAGC,MAAM,CAACC,IAAI,CAAC,IAAI,CAACC,eAAe,EAAE,CAACC,gBAAgB,CAAC;IACzE;IACA,OAAO,IAAAC,cAAI,EAACR,eAAe,CAACS,MAAM,CAACN,YAAY,CAAC,CAACO,MAAM,CAAEC,GAAG,IAAKA,GAAG,KAAK,cAAc,CAAC,CAAC;EAC3F;EAEA,MAAMC,kBAAkB,CAACC,OAAuB,EAAEC,YAAwC,GAAG,EAAE,EAAoB;IACjH,OAAO,IAAI,CAACC,4BAA4B,CAACF,OAAO,EAAEC,YAAY,CAAC;EACjE;EAEA,MAAMC,4BAA4B,CAChCF,OAAuB,EACvBC,YAAwC,GAAG,EAAE,EAC3B;IAClB,OAAO,IAAI,CAAChB,MAAM,CAACkB,SAAS,CAACD,4BAA4B,CAACF,OAAO,EAAE,CACjEI,uDAAwB,EACxBC,yDAA0B,EAC1BC,oCAAgB,EAChB,GAAGL,YAAY,CAChB,CAAC;EACJ;EAEAR,eAAe,GAAG;IAChB,OAAO;MACLc,YAAY,EAAE;QACZvB,KAAK,EAAE,GAAG;QACV,WAAW,EAAE,GAAG;QAChB,cAAc,EAAE;MAClB,CAAC;MACDwB,eAAe,EAAE;QACfxB,KAAK,EAAE,GAAG;QACV,WAAW,EAAE,GAAG;QAChB,cAAc,EAAE,GAAG;QACnB,aAAa,EAAE,SAAS;QACxB,cAAc,EAAE,SAAS;QACzB,kBAAkB,EAAE,SAAS;QAC7B,qBAAqB,EAAE,SAAS;QAChC;QACA,gBAAgB,EAAE,SAAS;QAC3B,kCAAkC,EAAE;MACtC,CAAC;MACDU,gBAAgB,EAAE;QAChBV,KAAK,EAAE,oBAAoB;QAC3B,WAAW,EAAE,oBAAoB;QACjC,cAAc,EAAE,SAAS;QACzB,kBAAkB,EAAE;MACtB;IACF,CAAC;EACH;EAEA,MAAMyB,eAAe,GAAG;IACtB,OAAO;MACLC,IAAI,EAAE7B;IACR,CAAC;EACH;AACF;AAAC"}