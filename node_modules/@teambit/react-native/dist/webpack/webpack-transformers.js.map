{"version":3,"names":["reactNativePackagesRule","test","include","RegExp","sep","loader","require","resolve","options","cacheDirectory","presets","plugins","commonTransformation","config","_context","reactNativeAlias","reactNativeExternal","addModuleRule","reactNativeExternalVal","get","raw","reactNativeWebExternalVal","externals","set","previewConfigTransformer","context","newConfig","devServerConfigTransformer"],"sources":["webpack-transformers.ts"],"sourcesContent":["import { sep } from 'path';\nimport { WebpackConfigTransformer, WebpackConfigMutator, WebpackConfigTransformContext } from '@teambit/webpack';\nimport { get, set } from 'lodash';\nimport { reactNativeAlias } from './react-native-alias';\n\nconst reactNativePackagesRule = {\n  test: /\\.(jsx?|tsx?)$/,\n  include: [new RegExp(`node_modules\\\\${sep}react-native-`)],\n  loader: require.resolve('babel-loader'),\n  options: {\n    cacheDirectory: false,\n    presets: [require.resolve('@babel/preset-env'), require.resolve('@babel/preset-react')],\n    plugins: [require.resolve('@babel/plugin-proposal-class-properties')],\n  },\n};\n\n/**\n * Transformation to apply for both preview and dev server\n * @param config\n * @param _context\n */\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nfunction commonTransformation(config: WebpackConfigMutator, _context: WebpackConfigTransformContext) {\n  reactNativeAlias(config);\n  reactNativeExternal(config);\n  config.addModuleRule(reactNativePackagesRule);\n\n  return config;\n}\n\n/**\n * expect the react-native to be on the global object with the same name of react-native-web\n * @param config\n * @returns\n */\nfunction reactNativeExternal(config: WebpackConfigMutator) {\n  const reactNativeExternalVal = get(config.raw, 'externals.react-native');\n  const reactNativeWebExternalVal = get(config.raw, 'externals.react-native-web');\n  if (config?.raw?.externals && reactNativeExternalVal && reactNativeWebExternalVal) {\n    set(config.raw, 'externals.react-native', reactNativeWebExternalVal);\n  }\n  return config;\n}\n\n/**\n * Transformation for the preview only\n * @param config\n * @param context\n * @returns\n */\nexport const previewConfigTransformer: WebpackConfigTransformer = (\n  config: WebpackConfigMutator,\n  context: WebpackConfigTransformContext\n) => {\n  const newConfig = commonTransformation(config, context);\n  return newConfig;\n};\n\n/**\n * Transformation for the dev server only\n * @param config\n * @param context\n * @returns\n */\nexport const devServerConfigTransformer: WebpackConfigTransformer = (\n  config: WebpackConfigMutator,\n  context: WebpackConfigTransformContext\n) => {\n  const newConfig = commonTransformation(config, context);\n  return newConfig;\n};\n"],"mappings":";;;;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA,MAAMA,uBAAuB,GAAG;EAC9BC,IAAI,EAAE,gBAAgB;EACtBC,OAAO,EAAE,CAAC,IAAIC,MAAM,CAAE,iBAAgBC,WAAI,eAAc,CAAC,CAAC;EAC1DC,MAAM,EAAEC,OAAO,CAACC,OAAO,CAAC,cAAc,CAAC;EACvCC,OAAO,EAAE;IACPC,cAAc,EAAE,KAAK;IACrBC,OAAO,EAAE,CAACJ,OAAO,CAACC,OAAO,CAAC,mBAAmB,CAAC,EAAED,OAAO,CAACC,OAAO,CAAC,qBAAqB,CAAC,CAAC;IACvFI,OAAO,EAAE,CAACL,OAAO,CAACC,OAAO,CAAC,yCAAyC,CAAC;EACtE;AACF,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA,SAASK,oBAAoB,CAACC,MAA4B,EAAEC,QAAuC,EAAE;EACnG,IAAAC,oCAAgB,EAACF,MAAM,CAAC;EACxBG,mBAAmB,CAACH,MAAM,CAAC;EAC3BA,MAAM,CAACI,aAAa,CAACjB,uBAAuB,CAAC;EAE7C,OAAOa,MAAM;AACf;;AAEA;AACA;AACA;AACA;AACA;AACA,SAASG,mBAAmB,CAACH,MAA4B,EAAE;EAAA;EACzD,MAAMK,sBAAsB,GAAG,IAAAC,aAAG,EAACN,MAAM,CAACO,GAAG,EAAE,wBAAwB,CAAC;EACxE,MAAMC,yBAAyB,GAAG,IAAAF,aAAG,EAACN,MAAM,CAACO,GAAG,EAAE,4BAA4B,CAAC;EAC/E,IAAIP,MAAM,aAANA,MAAM,8BAANA,MAAM,CAAEO,GAAG,wCAAX,YAAaE,SAAS,IAAIJ,sBAAsB,IAAIG,yBAAyB,EAAE;IACjF,IAAAE,aAAG,EAACV,MAAM,CAACO,GAAG,EAAE,wBAAwB,EAAEC,yBAAyB,CAAC;EACtE;EACA,OAAOR,MAAM;AACf;;AAEA;AACA;AACA;AACA;AACA;AACA;AACO,MAAMW,wBAAkD,GAAG,CAChEX,MAA4B,EAC5BY,OAAsC,KACnC;EACH,MAAMC,SAAS,GAAGd,oBAAoB,CAACC,MAAM,EAAEY,OAAO,CAAC;EACvD,OAAOC,SAAS;AAClB,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AALA;AAMO,MAAMC,0BAAoD,GAAG,CAClEd,MAA4B,EAC5BY,OAAsC,KACnC;EACH,MAAMC,SAAS,GAAGd,oBAAoB,CAACC,MAAM,EAAEY,OAAO,CAAC;EACvD,OAAOC,SAAS;AAClB,CAAC;AAAC"}