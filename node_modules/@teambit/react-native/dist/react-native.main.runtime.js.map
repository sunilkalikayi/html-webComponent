{"version":3,"names":["jestConfig","require","resolve","ReactNativeMain","constructor","react","reactNativeEnv","envs","overrideTsConfig","bind","overrideJestConfig","overrideBuildPipe","overrideBuildTsConfig","overridePackageJsonProps","useTypescript","usePrettier","useEslint","icon","useWebpack","modifiers","mergedModifiers","previewConfig","previewConfigTransformer","concat","devServerConfig","devServerConfigTransformer","overrideDependencies","dependencyPolicy","override","getDependencies","mergeDeepLeft","compose","transformers","targetEnv","merge","provider","generator","aspect","webpackModifiers","reactNativeComposedEnv","ReactNativeEnv","registerEnv","registerComponentTemplate","componentTemplates","registerWorkspaceTemplate","workspaceTemplates","ReactAspect","EnvsAspect","GeneratorAspect","AspectAspect","MainRuntime","ReactNativeAspect","addRuntime"],"sources":["react-native.main.runtime.ts"],"sourcesContent":["import mergeDeepLeft from 'ramda/src/mergeDeepLeft';\nimport { EnvPolicyConfigObject } from '@teambit/dependency-resolver';\nimport { GeneratorAspect, GeneratorMain } from '@teambit/generator';\nimport { TsConfigSourceFile } from 'typescript';\nimport type { TsCompilerOptionsWithoutTsConfig } from '@teambit/typescript';\nimport { MainRuntime } from '@teambit/cli';\nimport { BuildTask } from '@teambit/builder';\nimport { Aspect } from '@teambit/harmony';\nimport AspectAspect, { AspectMain } from '@teambit/aspect';\nimport { PackageJsonProps } from '@teambit/pkg';\nimport { EnvsAspect, EnvsMain, EnvTransformer, Environment } from '@teambit/envs';\nimport { ReactAspect, ReactMain, ReactEnv, UseWebpackModifiers } from '@teambit/react';\nimport { ReactNativeAspect } from './react-native.aspect';\nimport { componentTemplates, workspaceTemplates } from './react-native.templates';\nimport { previewConfigTransformer, devServerConfigTransformer } from './webpack/webpack-transformers';\nimport { ReactNativeEnv } from './react-native.env';\n\nconst jestConfig = require.resolve('./jest/jest.config');\n\nexport class ReactNativeMain {\n  constructor(\n    private react: ReactMain,\n\n    readonly reactNativeEnv: ReactNativeEnv,\n\n    private envs: EnvsMain\n  ) {}\n\n  icon() {\n    return 'https://static.bit.dev/extensions-icons/react.svg';\n  }\n\n  /**\n   * @deprecated use useTypescript()\n   * override the TS config of the environment.\n   */\n  overrideTsConfig: (\n    tsconfig?: TsConfigSourceFile,\n    compilerOptions?: Partial<TsCompilerOptionsWithoutTsConfig>,\n    tsModule?: any\n  ) => EnvTransformer = this.react.overrideTsConfig.bind(this.react);\n\n  /**\n   * override the jest config of the environment.\n   */\n  overrideJestConfig = this.react.overrideJestConfig.bind(this.react);\n\n  /**\n   * override the env build pipeline.\n   */\n  overrideBuildPipe: (tasks: BuildTask[]) => EnvTransformer = this.react.overrideBuildPipe.bind(this.react);\n\n  /**\n   * @deprecated use useTypescript()\n   * override the build ts config.\n   */\n  overrideBuildTsConfig: (\n    tsconfig?: TsConfigSourceFile,\n    compilerOptions?: Partial<TsCompilerOptionsWithoutTsConfig>\n  ) => EnvTransformer = this.react.overrideBuildTsConfig.bind(this.react);\n\n  /**\n   * override package json properties.\n   */\n  overridePackageJsonProps: (props: PackageJsonProps) => EnvTransformer = this.react.overridePackageJsonProps.bind(\n    this.react\n  );\n\n  /**\n   * override the env's typescript config for both dev and build time.\n   * Replaces both overrideTsConfig (devConfig) and overrideBuildTsConfig (buildConfig)\n   */\n  useTypescript = this.react.useTypescript.bind(this.react);\n\n  /**\n   * override the env's dev server and preview webpack configurations.\n   * Replaces both overrideDevServerConfig and overridePreviewConfig\n   */\n  useWebpack(modifiers?: UseWebpackModifiers) {\n    const mergedModifiers: UseWebpackModifiers = {\n      previewConfig: [previewConfigTransformer].concat(modifiers?.previewConfig ?? []),\n      devServerConfig: [devServerConfigTransformer].concat(modifiers?.devServerConfig ?? []),\n    };\n    return this.react.useWebpack(mergedModifiers);\n  }\n\n  /**\n   * An API to mutate the prettier config\n   */\n  usePrettier = this.react.usePrettier.bind(this.react);\n\n  /**\n   * An API to mutate the eslint config\n   */\n  useEslint = this.react.useEslint.bind(this.react);\n\n  /**\n   * override the dependency configuration of the component environment.\n   */\n  overrideDependencies(dependencyPolicy: EnvPolicyConfigObject) {\n    return this.envs.override({\n      getDependencies: () => mergeDeepLeft(dependencyPolicy, this.reactNativeEnv.getDependencies()),\n    });\n  }\n\n  /**\n   * create a new composition of the node environment.\n   */\n  compose(transformers: EnvTransformer[], targetEnv: Environment = {}) {\n    return this.envs.compose(this.envs.merge(targetEnv, this.reactNativeEnv), transformers);\n  }\n\n  static dependencies: Aspect[] = [ReactAspect, EnvsAspect, GeneratorAspect, AspectAspect];\n  static runtime = MainRuntime;\n  static async provider([react, envs, generator, aspect]: [ReactMain, EnvsMain, GeneratorMain, AspectMain]) {\n    const webpackModifiers: UseWebpackModifiers = {\n      previewConfig: [previewConfigTransformer],\n      devServerConfig: [devServerConfigTransformer],\n    };\n\n    const reactNativeComposedEnv: ReactNativeEnv = envs.merge<ReactNativeEnv, ReactEnv>(\n      new ReactNativeEnv(react, aspect),\n      react.compose([react.useWebpack(webpackModifiers), react.overrideJestConfig(jestConfig)])\n    );\n    envs.registerEnv(reactNativeComposedEnv);\n    generator.registerComponentTemplate(componentTemplates);\n    generator.registerWorkspaceTemplate(workspaceTemplates);\n    return new ReactNativeMain(react, reactNativeComposedEnv, envs);\n  }\n}\n\nReactNativeAspect.addRuntime(ReactNativeMain);\n"],"mappings":"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"}