{"version":3,"names":["ShowCmd","constructor","component","name","description","getComponent","idStr","remote","bitId","BitId","parse","host","getHost","id","resolveComponentId","getRemoteComponent","Error","get","MissingBitMapComponent","useLegacy","json","compare","legacyShow","LegacyShow","showData","action","versions","undefined","report","legacy","fragments","getShowFragments","rows","Promise","all","map","fragment","row","renderRow","content","title","table","CLITable","compact","render","JSON","filter"],"sources":["show.cmd.ts"],"sourcesContent":["import { Command, CommandOptions } from '@teambit/cli';\nimport { compact } from 'lodash';\n// import { Logger } from '@teambit/logger';\n// import chalk from 'chalk';\nimport { CLITable } from '@teambit/cli-table';\nimport { MissingBitMapComponent } from '@teambit/legacy/dist/consumer/bit-map/exceptions';\nimport { BitId } from '@teambit/legacy-bit-id';\nimport LegacyShow from '@teambit/legacy/dist/cli/commands/public-cmds/show-cmd';\nimport { ComponentMain } from '../component.main.runtime';\n\nexport class ShowCmd implements Command {\n  name = 'show <component-name>';\n  description = \"display the component's essential information\";\n  alias = '';\n  group = 'info';\n  arguments = [{ name: 'component-name', description: 'component name or component id' }];\n  options = [\n    ['j', 'json', 'return the component data in a json format'],\n    ['l', 'legacy', 'use the legacy bit show.'],\n    ['r', 'remote', 'show a remote component'],\n    [\n      'c',\n      'compare',\n      'compare current file system component to the latest tagged component [default=latest]. only works in legacy.',\n    ],\n  ] as CommandOptions;\n\n  constructor(private component: ComponentMain) {}\n\n  private async getComponent(idStr: string, remote: boolean) {\n    if (remote) {\n      const bitId: BitId = BitId.parse(idStr, true); // user used --remote so we know it has a scope\n      const host = this.component.getHost('teambit.scope/scope');\n      const id = await host.resolveComponentId(bitId);\n      if (!host.getRemoteComponent) {\n        throw new Error('Component Host does not implement getRemoteComponent()');\n      }\n      const component = await host.getRemoteComponent(id);\n      return component;\n    }\n    const host = this.component.getHost();\n    const id = await host.resolveComponentId(idStr);\n    const component = await host.get(id);\n    if (!component) throw new MissingBitMapComponent(idStr);\n    return component;\n  }\n\n  async useLegacy(id: string, json = false, remote = false, compare = false) {\n    const legacyShow = new LegacyShow();\n    const showData = await legacyShow.action([id], {\n      json,\n      versions: undefined,\n      remote,\n      compare,\n    });\n\n    return legacyShow.report(showData);\n  }\n\n  async report([idStr]: [string], { legacy, remote, compare }: { legacy: boolean; remote: boolean; compare: boolean }) {\n    if (legacy) return this.useLegacy(idStr, false, remote, compare);\n    const component = await this.getComponent(idStr, remote);\n    const fragments = this.component.getShowFragments();\n    const rows = await Promise.all(\n      fragments.map(async (fragment) => {\n        const row = await fragment.renderRow(component);\n        if (!row.content) return null;\n        return [row.title, row.content];\n      })\n    );\n\n    const table = new CLITable([], compact(rows));\n    return table.render();\n  }\n\n  async json([idStr]: [string], { remote, legacy }: { remote: boolean; legacy: boolean }) {\n    if (legacy) return JSON.parse(await this.useLegacy(idStr, true, remote));\n    const component = await this.getComponent(idStr, remote);\n    const fragments = this.component.getShowFragments();\n    const rows = await Promise.all(\n      fragments.map(async (fragment) => {\n        return fragment.json ? fragment.json(component) : undefined;\n      })\n    );\n\n    return rows.filter((row) => !!row);\n  }\n}\n"],"mappings":"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"}