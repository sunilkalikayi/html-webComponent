{"version":3,"names":["ComponentRoute","constructor","registerRoute","componentExtension","dynamicRouteRegex","route","method","componentMiddlewares","concat","middlewares","req","res","next","resolveComponent","componentId","params","host","getHost","compId","resolveComponentId","component","get"],"sources":["component.route.ts"],"sourcesContent":["import { NextFunction, Request, Response, Route } from '@teambit/express';\n\nimport { ComponentMain } from './component.main.runtime';\n\nexport type RegisteredComponentRoute = Route & {\n  resolveComponent?: boolean;\n};\n\nexport type ComponentUrlParams = {\n  componentId: string;\n};\n\nexport class ComponentRoute implements Route {\n  constructor(private registerRoute: RegisteredComponentRoute, private componentExtension: ComponentMain) {}\n  dynamicRouteRegex = '/?[^/@]+/[^~]*';\n  readonly route = `/:componentId(${this.dynamicRouteRegex})/~aspect${this.registerRoute.route}`;\n\n  get componentMiddlewares() {\n    return [\n      async (req: Request<ComponentUrlParams>, res: Response, next: NextFunction) => {\n        const resolveComponent = this.registerRoute.resolveComponent ?? true;\n        if (resolveComponent) {\n          const { componentId } = req.params;\n          const host = this.componentExtension.getHost();\n          const compId = await host.resolveComponentId(componentId);\n          const component = await host.get(compId);\n          // @ts-ignore\n          req.component = component;\n        }\n        next();\n      },\n    ];\n  }\n\n  method = this.registerRoute.method;\n  // @ts-ignore\n  middlewares = this.componentMiddlewares.concat(this.registerRoute.middlewares);\n}\n"],"mappings":";;;;;;;;;;;;;;;AAYO,MAAMA,cAAc,CAAkB;EAC3CC,WAAW,CAASC,aAAuC,EAAUC,kBAAiC,EAAE;IAAA,KAApFD,aAAuC,GAAvCA,aAAuC;IAAA,KAAUC,kBAAiC,GAAjCA,kBAAiC;IAAA,2DAClF,gBAAgB;IAAA,+CAClB,iBAAgB,IAAI,CAACC,iBAAkB,YAAW,IAAI,CAACF,aAAa,CAACG,KAAM,EAAC;IAAA,gDAmBrF,IAAI,CAACH,aAAa,CAACI,MAAM;IAAA,qDAEpB,IAAI,CAACC,oBAAoB,CAACC,MAAM,CAAC,IAAI,CAACN,aAAa,CAACO,WAAW,CAAC;EAvB2B;EAIzG,IAAIF,oBAAoB,GAAG;IACzB,OAAO,CACL,OAAOG,GAAgC,EAAEC,GAAa,EAAEC,IAAkB,KAAK;MAAA;MAC7E,MAAMC,gBAAgB,4BAAG,IAAI,CAACX,aAAa,CAACW,gBAAgB,yEAAI,IAAI;MACpE,IAAIA,gBAAgB,EAAE;QACpB,MAAM;UAAEC;QAAY,CAAC,GAAGJ,GAAG,CAACK,MAAM;QAClC,MAAMC,IAAI,GAAG,IAAI,CAACb,kBAAkB,CAACc,OAAO,EAAE;QAC9C,MAAMC,MAAM,GAAG,MAAMF,IAAI,CAACG,kBAAkB,CAACL,WAAW,CAAC;QACzD,MAAMM,SAAS,GAAG,MAAMJ,IAAI,CAACK,GAAG,CAACH,MAAM,CAAC;QACxC;QACAR,GAAG,CAACU,SAAS,GAAGA,SAAS;MAC3B;MACAR,IAAI,EAAE;IACR,CAAC,CACF;EACH;AAKF;AAAC"}