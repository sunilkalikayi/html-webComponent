{"version":3,"names":["describe","workspaceData","snapping","beforeAll","mockWorkspace","workspacePath","console","log","mockComponents","fs","writeFile","path","join","compiler","loadAspect","CompilerAspect","compileOnWorkspace","SnappingAspect","it","tag","ids","err","expect","constructor","name","toEqual","ComponentsHaveIssues","skip","setWorkspaceConfig","IssuesAspect","id","ignoreIssues","results","taggedComponents","length","afterAll","destroyWorkspace"],"sources":["snapping.spec.ts"],"sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\nimport { loadAspect } from '@teambit/harmony.testing.load-aspect';\nimport {\n  mockWorkspace,\n  destroyWorkspace,\n  WorkspaceData,\n  setWorkspaceConfig,\n} from '@teambit/workspace.testing.mock-workspace';\nimport IssuesAspect from '@teambit/issues';\nimport { CompilerAspect, CompilerMain } from '@teambit/compiler';\nimport { mockComponents } from '@teambit/component.testing.mock-components';\nimport { SnappingMain } from './snapping.main.runtime';\nimport { SnappingAspect } from './snapping.aspect';\nimport { ComponentsHaveIssues } from './components-have-issues';\n\ndescribe('Snapping aspect', () => {\n  let workspaceData: WorkspaceData;\n  let snapping: SnappingMain;\n  describe('components with issues', () => {\n    beforeAll(async () => {\n      workspaceData = mockWorkspace();\n      const { workspacePath } = workspaceData;\n      // eslint-disable-next-line no-console\n      console.log('workspace created at ', workspacePath);\n      await mockComponents(workspacePath);\n      await fs.writeFile(path.join(workspacePath, 'comp1/index.js'), `const nonExist = require(\"non-exist\");`);\n      const compiler: CompilerMain = await loadAspect(CompilerAspect, workspacePath);\n      await compiler.compileOnWorkspace();\n      snapping = await loadAspect(SnappingAspect, workspacePath);\n    });\n    it('tag should throw an ComponentsHaveIssues error', async () => {\n      try {\n        await snapping.tag({ ids: ['comp1'] });\n      } catch (err: any) {\n        expect(err.constructor.name).toEqual(ComponentsHaveIssues.name);\n      }\n    });\n    // @todo: this test fails during \"bit build\" for some reason. It passes on \"bit test\";\n    it.skip('should not throw an error if the config was set to ignore MissingPackagesDependenciesOnFs error', async () => {\n      await setWorkspaceConfig(workspaceData.workspacePath, IssuesAspect.id, {\n        ignoreIssues: ['MissingPackagesDependenciesOnFs'],\n      });\n      snapping = await loadAspect(SnappingAspect, workspaceData.workspacePath);\n      const results = await snapping.tag({ ids: ['comp1'] });\n      expect(results?.taggedComponents.length).toEqual(1);\n    });\n    afterAll(async () => {\n      await destroyWorkspace(workspaceData);\n    });\n  });\n});\n"],"mappings":";;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAMA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEAA,QAAQ,CAAC,iBAAiB,EAAE,MAAM;EAChC,IAAIC,aAA4B;EAChC,IAAIC,QAAsB;EAC1BF,QAAQ,CAAC,wBAAwB,EAAE,MAAM;IACvCG,SAAS,CAAC,YAAY;MACpBF,aAAa,GAAG,IAAAG,iCAAa,GAAE;MAC/B,MAAM;QAAEC;MAAc,CAAC,GAAGJ,aAAa;MACvC;MACAK,OAAO,CAACC,GAAG,CAAC,uBAAuB,EAAEF,aAAa,CAAC;MACnD,MAAM,IAAAG,kCAAc,EAACH,aAAa,CAAC;MACnC,MAAMI,kBAAE,CAACC,SAAS,CAACC,eAAI,CAACC,IAAI,CAACP,aAAa,EAAE,gBAAgB,CAAC,EAAG,wCAAuC,CAAC;MACxG,MAAMQ,QAAsB,GAAG,MAAM,IAAAC,4BAAU,EAACC,0BAAc,EAAEV,aAAa,CAAC;MAC9E,MAAMQ,QAAQ,CAACG,kBAAkB,EAAE;MACnCd,QAAQ,GAAG,MAAM,IAAAY,4BAAU,EAACG,0BAAc,EAAEZ,aAAa,CAAC;IAC5D,CAAC,CAAC;IACFa,EAAE,CAAC,gDAAgD,EAAE,YAAY;MAC/D,IAAI;QACF,MAAMhB,QAAQ,CAACiB,GAAG,CAAC;UAAEC,GAAG,EAAE,CAAC,OAAO;QAAE,CAAC,CAAC;MACxC,CAAC,CAAC,OAAOC,GAAQ,EAAE;QACjBC,MAAM,CAACD,GAAG,CAACE,WAAW,CAACC,IAAI,CAAC,CAACC,OAAO,CAACC,4CAAoB,CAACF,IAAI,CAAC;MACjE;IACF,CAAC,CAAC;IACF;IACAN,EAAE,CAACS,IAAI,CAAC,iGAAiG,EAAE,YAAY;MACrH,MAAM,IAAAC,sCAAkB,EAAC3B,aAAa,CAACI,aAAa,EAAEwB,iBAAY,CAACC,EAAE,EAAE;QACrEC,YAAY,EAAE,CAAC,iCAAiC;MAClD,CAAC,CAAC;MACF7B,QAAQ,GAAG,MAAM,IAAAY,4BAAU,EAACG,0BAAc,EAAEhB,aAAa,CAACI,aAAa,CAAC;MACxE,MAAM2B,OAAO,GAAG,MAAM9B,QAAQ,CAACiB,GAAG,CAAC;QAAEC,GAAG,EAAE,CAAC,OAAO;MAAE,CAAC,CAAC;MACtDE,MAAM,CAACU,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEC,gBAAgB,CAACC,MAAM,CAAC,CAACT,OAAO,CAAC,CAAC,CAAC;IACrD,CAAC,CAAC;IACFU,QAAQ,CAAC,YAAY;MACnB,MAAM,IAAAC,oCAAgB,EAACnC,aAAa,CAAC;IACvC,CAAC,CAAC;EACJ,CAAC,CAAC;AACJ,CAAC,CAAC"}