{"version":3,"names":["ResetCmd","constructor","snapping","name","description","COMPONENT_PATTERN_HELP","BASE_DOCS_DOMAIN","report","pattern","all","head","force","soft","BitError","results","isSoftUntag","reset","titleSuffix","title","chalk","green","length","components","map","result","cyan","id","toStringWithoutVersion","versions","join"],"sources":["reset-cmd.ts"],"sourcesContent":["import { BitError } from '@teambit/bit-error';\nimport chalk from 'chalk';\nimport { Command, CommandOptions } from '@teambit/cli';\nimport { BASE_DOCS_DOMAIN, COMPONENT_PATTERN_HELP } from '@teambit/legacy/dist/constants';\nimport { SnappingMain } from './snapping.main.runtime';\n\nexport default class ResetCmd implements Command {\n  name = 'reset [component-pattern]';\n  description = 'revert tagged or snapped versions for component(s)';\n  arguments = [\n    {\n      name: 'component-pattern',\n      description: COMPONENT_PATTERN_HELP,\n    },\n    {\n      name: 'component-version',\n      description: 'the version to untag (semver for tags. hash for snaps)',\n    },\n  ];\n  group = 'development';\n  extendedDescription = `https://${BASE_DOCS_DOMAIN}/components/tags#undoing-a-tag`;\n  alias = '';\n  options = [\n    ['a', 'all', 'revert tag/snap for all tagged/snapped components'],\n    ['', 'head', 'revert the head tag/snap only (by default, all local tags/snaps are reverted)'],\n    ['', 'soft', 'revert only soft-tags (components tagged with --soft flag)'],\n    [\n      'f',\n      'force',\n      'revert the tag even if used as a dependency. WARNING: components that depend on this tag will corrupt',\n    ],\n  ] as CommandOptions;\n  loader = true;\n  migration = true;\n\n  constructor(private snapping: SnappingMain) {}\n\n  async report(\n    [pattern]: [string],\n    {\n      all = false,\n      head = false,\n      force = false,\n      soft = false,\n    }: { all?: boolean; head?: boolean; force?: boolean; soft?: boolean }\n  ) {\n    if (!pattern && !all) {\n      throw new BitError('please specify a component-pattern or use --all flag');\n    }\n    if (pattern && all) {\n      throw new BitError('please specify either a component-pattern or --all flag, not both');\n    }\n    if (soft && head) {\n      throw new BitError('please specify either --soft or --head flag, not both');\n    }\n    const { results, isSoftUntag } = await this.snapping.reset(pattern, head, force, soft);\n    const titleSuffix = isSoftUntag ? 'soft-untagged (are not candidate for tagging anymore)' : 'untagged';\n    const title = chalk.green(`${results.length} component(s) were ${titleSuffix}:\\n`);\n    const components = results.map((result) => {\n      return `${chalk.cyan(result.id.toStringWithoutVersion())}. version(s): ${result.versions.join(', ')}`;\n    });\n    return title + components.join('\\n');\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAGe,MAAMA,QAAQ,CAAoB;EA6B/CC,WAAW,CAASC,QAAsB,EAAE;IAAA,KAAxBA,QAAsB,GAAtBA,QAAsB;IAAA,8CA5BnC,2BAA2B;IAAA,qDACpB,oDAAoD;IAAA,mDACtD,CACV;MACEC,IAAI,EAAE,mBAAmB;MACzBC,WAAW,EAAEC;IACf,CAAC,EACD;MACEF,IAAI,EAAE,mBAAmB;MACzBC,WAAW,EAAE;IACf,CAAC,CACF;IAAA,+CACO,aAAa;IAAA,6DACE,WAAUE,6BAAiB,gCAA+B;IAAA,+CACzE,EAAE;IAAA,iDACA,CACR,CAAC,GAAG,EAAE,KAAK,EAAE,mDAAmD,CAAC,EACjE,CAAC,EAAE,EAAE,MAAM,EAAE,+EAA+E,CAAC,EAC7F,CAAC,EAAE,EAAE,MAAM,EAAE,4DAA4D,CAAC,EAC1E,CACE,GAAG,EACH,OAAO,EACP,uGAAuG,CACxG,CACF;IAAA,gDACQ,IAAI;IAAA,mDACD,IAAI;EAE6B;EAE7C,MAAMC,MAAM,CACV,CAACC,OAAO,CAAW,EACnB;IACEC,GAAG,GAAG,KAAK;IACXC,IAAI,GAAG,KAAK;IACZC,KAAK,GAAG,KAAK;IACbC,IAAI,GAAG;EAC2D,CAAC,EACrE;IACA,IAAI,CAACJ,OAAO,IAAI,CAACC,GAAG,EAAE;MACpB,MAAM,KAAII,oBAAQ,EAAC,sDAAsD,CAAC;IAC5E;IACA,IAAIL,OAAO,IAAIC,GAAG,EAAE;MAClB,MAAM,KAAII,oBAAQ,EAAC,mEAAmE,CAAC;IACzF;IACA,IAAID,IAAI,IAAIF,IAAI,EAAE;MAChB,MAAM,KAAIG,oBAAQ,EAAC,uDAAuD,CAAC;IAC7E;IACA,MAAM;MAAEC,OAAO;MAAEC;IAAY,CAAC,GAAG,MAAM,IAAI,CAACb,QAAQ,CAACc,KAAK,CAACR,OAAO,EAAEE,IAAI,EAAEC,KAAK,EAAEC,IAAI,CAAC;IACtF,MAAMK,WAAW,GAAGF,WAAW,GAAG,uDAAuD,GAAG,UAAU;IACtG,MAAMG,KAAK,GAAGC,gBAAK,CAACC,KAAK,CAAE,GAAEN,OAAO,CAACO,MAAO,sBAAqBJ,WAAY,KAAI,CAAC;IAClF,MAAMK,UAAU,GAAGR,OAAO,CAACS,GAAG,CAAEC,MAAM,IAAK;MACzC,OAAQ,GAAEL,gBAAK,CAACM,IAAI,CAACD,MAAM,CAACE,EAAE,CAACC,sBAAsB,EAAE,CAAE,iBAAgBH,MAAM,CAACI,QAAQ,CAACC,IAAI,CAAC,IAAI,CAAE,EAAC;IACvG,CAAC,CAAC;IACF,OAAOX,KAAK,GAAGI,UAAU,CAACO,IAAI,CAAC,IAAI,CAAC;EACtC;AACF;AAAC"}