{"version":3,"names":["link","promisify","fs","installsRunning","STORE_CACHE","createStoreController","options","authConfig","getAuthConfig","registries","opts","dir","rootDir","cacheDir","storeDir","rawConfig","verifyStoreIntegrity","httpProxy","proxyConfig","httpsProxy","ca","networkConfig","cert","key","localAddress","noProxy","strictSsl","strictSSL","maxSockets","networkConcurrency","packageImportMethod","pnpmHomeDir","path","join","userHome","cacheKey","JSON","stringify","createOrConnectStoreController","generateResolverAndFetcher","pnpmConfig","readConfig","Object","assign","config","timeout","fetchTimeout","retry","factor","fetchRetryFactor","maxTimeout","fetchRetryMaxtimeout","minTimeout","fetchRetryMintimeout","retries","fetchRetries","result","createClient","getPeerDependencyIssues","manifestsByPaths","projects","workspacePackages","manifest","entries","push","buildIndex","name","version","registriesMap","getRegistriesMap","storeController","pnpm","ctrl","overrides","install","logger","dependenciesMeta","readPackage","hoistingLimits","Map","rootComponents","rootComponentWrappers","createRootComponentWrapperManifests","readPackageHook","set","Set","rootComponentsForCapsules","readPackageHookForCapsules","allProjects","packagesToBuild","groupPkgs","preferFrozenLockfile","pruneLockfileImporters","modulesCacheMaxAge","hooks","strictPeerDependencies","peerDependencyRules","allowAny","ignoreMissing","stopReporting","initDefaultReporter","context","argv","reportingOptions","appendOnly","throttleProgress","streamParser","mutateModules","err","pnpmErrorToBitError","modulesState","readModulesManifest","injectedDeps","linkManifestsToInjectedDeps","values","toString","compDir","id","relative","replace","encodeURIComponent","dependencies","peerDependencies","injected","pkg","workspaceDir","readDependencyPackageHook","endsWith","readWorkspacePackageHook","startsWith","newDeps","Promise","all","map","targetDirs","pkgName","pkgJsonPath","existsSync","targetDir","pkgs","graph","createPkgGraph","chunks","sortPackages","forEach","dirs","mutation","resolveRemoteVersion","packageName","resolve","resolveOpts","lockfileDir","preferredVersions","projectDir","registry","parsedPackage","parsePackageName","pickRegistryForPackage","wantedDep","alias","pref","isValidRange","semver","validRange","val","BitError","isSemver","resolvedVia","e","message","includes","undefined","normalizedPref","default","defaultRegistry","uri","NPM_REGISTRY","scopes","registryName","res","alwaysAuth","defaultAuthTokens","getAuthTokenForRegistry","keyName","authTokens","nerfed","toNerfDart","alwaysAuthKeyName","isDefault","originalAuthType","originalAuthValue","split"],"sources":["lynx.ts"],"sourcesContent":["import fs from 'graceful-fs';\nimport path from 'path';\nimport semver from 'semver';\nimport parsePackageName from 'parse-package-name';\nimport { initDefaultReporter } from '@pnpm/default-reporter';\nimport { streamParser } from '@pnpm/logger';\nimport { readModulesManifest } from '@pnpm/modules-yaml';\nimport { StoreController, WantedDependency } from '@pnpm/package-store';\nimport { createOrConnectStoreController, CreateStoreControllerOptions } from '@pnpm/store-connection-manager';\nimport { sortPackages } from '@pnpm/sort-packages';\nimport {\n  ResolvedPackageVersion,\n  Registries,\n  NPM_REGISTRY,\n  Registry,\n  PackageManagerProxyConfig,\n  PackageManagerNetworkConfig,\n} from '@teambit/dependency-resolver';\nimport { BitError } from '@teambit/bit-error';\nimport {\n  MutatedProject,\n  mutateModules,\n  InstallOptions,\n  PeerDependencyIssuesByProjects,\n  ProjectOptions,\n} from '@pnpm/core';\nimport * as pnpm from '@pnpm/core';\nimport { createClient, ClientOptions } from '@pnpm/client';\nimport { pickRegistryForPackage } from '@pnpm/pick-registry-for-package';\nimport { PackageManifest, ProjectManifest, ReadPackageHook } from '@pnpm/types';\nimport { Logger } from '@teambit/logger';\nimport toNerfDart from 'nerf-dart';\nimport { promisify } from 'util';\nimport { createPkgGraph } from 'pkgs-graph';\nimport userHome from 'user-home';\nimport { pnpmErrorToBitError } from './pnpm-error-to-bit-error';\nimport { readConfig } from './read-config';\n\nconst link = promisify(fs.link);\nconst installsRunning: Record<string, Promise<any>> = {};\n\ntype RegistriesMap = {\n  default: string;\n  [registryName: string]: string;\n};\n\nconst STORE_CACHE: Record<string, { ctrl: StoreController; dir: string }> = {};\n\nasync function createStoreController(\n  options: {\n    rootDir: string;\n    storeDir: string;\n    cacheDir: string;\n    registries: Registries;\n    proxyConfig: PackageManagerProxyConfig;\n    networkConfig: PackageManagerNetworkConfig;\n  } & Pick<CreateStoreControllerOptions, 'packageImportMethod'>\n): Promise<{ ctrl: StoreController; dir: string }> {\n  const authConfig = getAuthConfig(options.registries);\n  const opts: CreateStoreControllerOptions = {\n    dir: options.rootDir,\n    cacheDir: options.cacheDir,\n    storeDir: options.storeDir,\n    rawConfig: authConfig,\n    verifyStoreIntegrity: true,\n    httpProxy: options.proxyConfig?.httpProxy,\n    httpsProxy: options.proxyConfig?.httpsProxy,\n    ca: options.networkConfig?.ca,\n    cert: options.networkConfig?.cert,\n    key: options.networkConfig?.key,\n    localAddress: options.networkConfig?.localAddress,\n    noProxy: options.proxyConfig?.noProxy,\n    strictSsl: options.networkConfig.strictSSL,\n    maxSockets: options.networkConfig.maxSockets,\n    networkConcurrency: options.networkConfig.networkConcurrency,\n    packageImportMethod: options.packageImportMethod,\n    pnpmHomeDir: path.join(userHome, '.pnpm'), // This is not actually used in our case\n  };\n  // We should avoid the recreation of store.\n  // The store holds cache that makes subsequent resolutions faster.\n  const cacheKey = JSON.stringify(opts);\n  if (!STORE_CACHE[cacheKey]) {\n    // Although it would be enough to call createNewStoreController(),\n    // that doesn't resolve the store directory location.\n    STORE_CACHE[cacheKey] = await createOrConnectStoreController(opts);\n  }\n  return STORE_CACHE[cacheKey];\n}\n\nasync function generateResolverAndFetcher(\n  cacheDir: string,\n  registries: Registries,\n  proxyConfig: PackageManagerProxyConfig = {},\n  networkConfig: PackageManagerNetworkConfig = {}\n) {\n  const pnpmConfig = await readConfig();\n  const authConfig = getAuthConfig(registries);\n  const opts: ClientOptions = {\n    authConfig: Object.assign({}, pnpmConfig.config.rawConfig, authConfig),\n    cacheDir,\n    httpProxy: proxyConfig?.httpProxy,\n    httpsProxy: proxyConfig?.httpsProxy,\n    ca: networkConfig?.ca,\n    cert: networkConfig?.cert,\n    key: networkConfig?.key,\n    localAddress: networkConfig?.localAddress,\n    noProxy: proxyConfig?.noProxy,\n    strictSsl: networkConfig.strictSSL,\n    timeout: networkConfig.fetchTimeout,\n    retry: {\n      factor: networkConfig.fetchRetryFactor,\n      maxTimeout: networkConfig.fetchRetryMaxtimeout,\n      minTimeout: networkConfig.fetchRetryMintimeout,\n      retries: networkConfig.fetchRetries,\n    },\n  };\n  const result = createClient(opts);\n  return result;\n}\n\nexport async function getPeerDependencyIssues(\n  manifestsByPaths: Record<string, any>,\n  opts: {\n    storeDir: string;\n    cacheDir: string;\n    registries: Registries;\n    rootDir: string;\n    proxyConfig: PackageManagerProxyConfig;\n    networkConfig: PackageManagerNetworkConfig;\n    overrides?: Record<string, string>;\n  } & Pick<CreateStoreControllerOptions, 'packageImportMethod'>\n): Promise<PeerDependencyIssuesByProjects> {\n  const projects: ProjectOptions[] = [];\n  const workspacePackages = {};\n  for (const [rootDir, manifest] of Object.entries(manifestsByPaths)) {\n    projects.push({\n      buildIndex: 0, // this is not used while searching for peer issues anyway\n      manifest,\n      rootDir,\n    });\n    workspacePackages[manifest.name] = workspacePackages[manifest.name] || {};\n    workspacePackages[manifest.name][manifest.version] = { dir: rootDir, manifest };\n  }\n  const registriesMap = getRegistriesMap(opts.registries);\n  const storeController = await createStoreController({\n    ...opts,\n    rootDir: opts.rootDir,\n  });\n  return pnpm.getPeerDependencyIssues(projects, {\n    storeController: storeController.ctrl,\n    storeDir: storeController.dir,\n    overrides: opts.overrides,\n    workspacePackages,\n    registries: registriesMap,\n  });\n}\n\nexport async function install(\n  rootDir: string,\n  manifestsByPaths: Record<string, ProjectManifest>,\n  storeDir: string,\n  cacheDir: string,\n  registries: Registries,\n  proxyConfig: PackageManagerProxyConfig = {},\n  networkConfig: PackageManagerNetworkConfig = {},\n  options: {\n    nodeLinker?: 'hoisted' | 'isolated';\n    overrides?: Record<string, string>;\n    rootComponents?: boolean;\n    rootComponentsForCapsules?: boolean;\n  } & Pick<\n    InstallOptions,\n    'publicHoistPattern' | 'hoistPattern' | 'nodeVersion' | 'engineStrict' | 'peerDependencyRules'\n  > &\n    Pick<CreateStoreControllerOptions, 'packageImportMethod'>,\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  logger?: Logger\n) {\n  if (!manifestsByPaths[rootDir].dependenciesMeta) {\n    manifestsByPaths = {\n      ...manifestsByPaths,\n      [rootDir]: {\n        ...manifestsByPaths[rootDir],\n        dependenciesMeta: {},\n      },\n    };\n  }\n  const readPackage: ReadPackageHook[] = [];\n  let hoistingLimits = new Map();\n  if (options?.rootComponents) {\n    const { rootComponentWrappers, rootComponents } = createRootComponentWrapperManifests(rootDir, manifestsByPaths);\n    manifestsByPaths = {\n      ...rootComponentWrappers,\n      ...manifestsByPaths,\n    };\n    readPackage.push(readPackageHook as ReadPackageHook);\n    hoistingLimits = new Map();\n    hoistingLimits.set('.@', new Set(rootComponents));\n  } else if (options?.rootComponentsForCapsules) {\n    readPackage.push(readPackageHookForCapsules as ReadPackageHook);\n  }\n  const { allProjects, packagesToBuild, workspacePackages } = groupPkgs(manifestsByPaths);\n  const registriesMap = getRegistriesMap(registries);\n  const authConfig = getAuthConfig(registries);\n  const storeController = await createStoreController({\n    rootDir,\n    storeDir,\n    cacheDir,\n    registries,\n    proxyConfig,\n    networkConfig,\n    packageImportMethod: options?.packageImportMethod,\n  });\n  const opts: InstallOptions = {\n    allProjects,\n    storeDir: storeController.dir,\n    dir: rootDir,\n    storeController: storeController.ctrl,\n    workspacePackages,\n    preferFrozenLockfile: true,\n    pruneLockfileImporters: true,\n    modulesCacheMaxAge: 0,\n    registries: registriesMap,\n    rawConfig: authConfig,\n    hooks: { readPackage },\n    hoistingLimits,\n    strictPeerDependencies: false,\n    ...options,\n    peerDependencyRules: {\n      allowAny: ['*'],\n      ignoreMissing: ['*'],\n      ...options?.peerDependencyRules,\n    },\n  };\n\n  const stopReporting = initDefaultReporter({\n    context: {\n      argv: [],\n    },\n    reportingOptions: {\n      appendOnly: false,\n      throttleProgress: 200,\n    },\n    streamParser,\n  });\n  try {\n    await installsRunning[rootDir];\n    installsRunning[rootDir] = mutateModules(packagesToBuild, opts);\n    await installsRunning[rootDir];\n    delete installsRunning[rootDir];\n  } catch (err: any) {\n    throw pnpmErrorToBitError(err);\n  } finally {\n    stopReporting();\n  }\n  if (options.rootComponents) {\n    const modulesState = await readModulesManifest(path.join(rootDir, 'node_modules'));\n    if (modulesState?.injectedDeps) {\n      await linkManifestsToInjectedDeps({\n        injectedDeps: modulesState.injectedDeps,\n        manifestsByPaths,\n        rootDir,\n      });\n    }\n  }\n}\n\n/**\n * This function creates manifests for root component wrappers.\n * Root component wrappers are used to isolated workspace components with their workspace dependencies\n * and peer dependencies.\n * A root component wrapper has the wrapped component in the dependencies and any of its peer dependencies.\n * This way pnpm will install the wrapped component in isolation from other components and their dependencies.\n */\nfunction createRootComponentWrapperManifests(rootDir: string, manifestsByPaths: Record<string, ProjectManifest>) {\n  const rootComponentWrappers: Record<string, ProjectManifest> = {};\n  const rootComponents: string[] = [];\n  for (const manifest of Object.values(manifestsByPaths)) {\n    const name = manifest.name!.toString(); // eslint-disable-line\n    const compDir = path.join(rootDir, 'node_modules', name);\n    const id = path.relative(rootDir, compDir).replace(/\\\\/g, '/');\n    rootComponents.push(encodeURIComponent(id));\n    rootComponentWrappers[compDir] = {\n      name: `${name}__root`,\n      dependencies: {\n        [name]: `workspace:*`,\n        ...manifest.peerDependencies,\n        ...manifest['defaultPeerDependencies'], // eslint-disable-line\n      },\n      dependenciesMeta: {\n        [name]: { injected: true },\n      },\n    };\n  }\n  return {\n    rootComponentWrappers,\n    rootComponents,\n  };\n}\n\n/**\n * This hook is used when installation is executed inside a capsule.\n * The components in the capsules should get their peer dependencies installed,\n * so this hook converts any peer dependencies into runtime dependencies.\n * Also, any local dependencies are extended with the \"injected\" option,\n * this tells pnpm to hard link the packages instead of symlinking them.\n */\nfunction readPackageHookForCapsules(pkg: PackageManifest, workspaceDir?: string): PackageManifest {\n  // workspaceDir is set only for workspace packages\n  if (workspaceDir) {\n    return readDependencyPackageHook({\n      ...pkg,\n      dependencies: {\n        ...pkg.dependencies,\n        ...pkg.peerDependencies,\n        ...pkg['defaultPeerDependencies'], // eslint-disable-line\n      },\n    });\n  }\n  return readDependencyPackageHook(pkg);\n}\n\n/**\n * This hook is used when installation happens in a Bit workspace.\n * We need a different hook for this case because unlike in a capsule, in a workspace,\n * the package manager only links workspace components to subdependencies.\n * For direct dependencies, Bit's linking is used.\n */\nfunction readPackageHook(pkg: PackageManifest, workspaceDir?: string): PackageManifest {\n  if (!pkg.dependencies || pkg.name?.endsWith(`__root`)) {\n    return pkg;\n  }\n  // workspaceDir is set only for workspace packages\n  if (workspaceDir) {\n    return readWorkspacePackageHook(pkg);\n  }\n  return readDependencyPackageHook(pkg);\n}\n\n/**\n * This hook adds the \"injected\" option to any workspace dependency.\n * The injected option tell pnpm to hard link the packages instead of symlinking them.\n */\nfunction readDependencyPackageHook(pkg: PackageManifest): PackageManifest {\n  const dependenciesMeta = pkg.dependenciesMeta ?? {};\n  for (const [name, version] of Object.entries(pkg.dependencies ?? {})) {\n    if (version.startsWith('workspace:')) {\n      // This instructs pnpm to hard link the component from the workspace, not symlink it.\n      dependenciesMeta[name] = { injected: true };\n    }\n  }\n  return {\n    ...pkg,\n    dependenciesMeta,\n  };\n}\n\n/**\n * This hook is used when installation happens in a Bit workspace.\n * It is applied on workspace projects, and it removes any references to other workspace projects.\n * This is needed because Bit has its own linking for workspace projects.\n * pnpm should not override the links created by Bit.\n * Otherwise, the IDE would reference workspace projects from inside `node_modules/.pnpm`.\n */\nfunction readWorkspacePackageHook(pkg: PackageManifest): PackageManifest {\n  const newDeps = {};\n  for (const [name, version] of Object.entries(pkg.dependencies ?? {})) {\n    if (!version.startsWith('workspace:')) {\n      newDeps[name] = version;\n    }\n  }\n  return {\n    ...pkg,\n    dependencies: {\n      ...pkg.peerDependencies,\n      ...pkg['defaultPeerDependencies'], // eslint-disable-line\n      ...newDeps,\n    },\n  };\n}\n\n/*\n * The package.json files of the components are generated into node_modules/<component pkg name>/package.json\n * This function copies the generated package.json file into all the locations of the component.\n */\nasync function linkManifestsToInjectedDeps({\n  rootDir,\n  manifestsByPaths,\n  injectedDeps,\n}: {\n  rootDir: string;\n  manifestsByPaths: Record<string, ProjectManifest>;\n  injectedDeps: Record<string, string[]>;\n}) {\n  await Promise.all(\n    Object.entries(injectedDeps).map(async ([compDir, targetDirs]) => {\n      const pkgName = manifestsByPaths[path.join(rootDir, compDir)]?.name;\n      if (!pkgName) return;\n      const pkgJsonPath = path.join(rootDir, 'node_modules', pkgName, 'package.json');\n      if (fs.existsSync(pkgJsonPath)) {\n        await Promise.all(targetDirs.map((targetDir) => link(pkgJsonPath, path.join(targetDir, 'package.json'))));\n      }\n    })\n  );\n}\n\nfunction groupPkgs(manifestsByPaths: Record<string, ProjectManifest>) {\n  const pkgs = Object.entries(manifestsByPaths).map(([dir, manifest]) => ({ dir, manifest }));\n  const { graph } = createPkgGraph(pkgs);\n  const chunks = sortPackages(graph as any);\n\n  // This will create local link by pnpm to a component exists in the ws.\n  // it will later deleted by the link process\n  // we keep it here to better support case like this:\n  // compA@1.0.0 uses compB@1.0.0\n  // I have compB@2.0.0 in my workspace\n  // now I install compA@1.0.0\n  // compA is hoisted to the root and install B@1.0.0 hoisted to the root as well\n  // now we will make link to B@2.0.0 and A will break\n  // with this we will have a link to the local B by pnpm so it will install B@1.0.0 inside A\n  // then when overriding the link, A will still works\n  // This is the rational behind not deleting this completely, but need further check that it really works\n  const packagesToBuild: MutatedProject[] = []; // @pnpm/core will use this to install the packages\n  const allProjects: ProjectOptions[] = [];\n  const workspacePackages = {}; // @pnpm/core will use this to link packages to each other\n\n  chunks.forEach((dirs, buildIndex) => {\n    for (const rootDir of dirs) {\n      const manifest = manifestsByPaths[rootDir];\n      allProjects.push({\n        buildIndex,\n        manifest,\n        rootDir,\n      });\n      packagesToBuild.push({\n        rootDir,\n        mutation: 'install',\n      });\n      if (manifest.name) {\n        workspacePackages[manifest.name] = workspacePackages[manifest.name] || {};\n        workspacePackages[manifest.name][manifest.version] = { dir: rootDir, manifest };\n      }\n    }\n  });\n  return { packagesToBuild, allProjects, workspacePackages };\n}\n\nexport async function resolveRemoteVersion(\n  packageName: string,\n  rootDir: string,\n  cacheDir: string,\n  registries: Registries,\n  proxyConfig: PackageManagerProxyConfig = {},\n  networkConfig: PackageManagerNetworkConfig = {}\n): Promise<ResolvedPackageVersion> {\n  const { resolve } = await generateResolverAndFetcher(cacheDir, registries, proxyConfig, networkConfig);\n  const resolveOpts = {\n    lockfileDir: rootDir,\n    preferredVersions: {},\n    projectDir: rootDir,\n    registry: '',\n  };\n  try {\n    const parsedPackage = parsePackageName(packageName);\n    const registriesMap = getRegistriesMap(registries);\n    const registry = pickRegistryForPackage(registriesMap, parsedPackage.name);\n    const wantedDep: WantedDependency = {\n      alias: parsedPackage.name,\n      pref: parsedPackage.version,\n    };\n    const isValidRange = parsedPackage.version ? !!semver.validRange(parsedPackage.version) : false;\n    resolveOpts.registry = registry;\n    const val = await resolve(wantedDep, resolveOpts);\n    if (!val.manifest) {\n      throw new BitError('The resolved package has no manifest');\n    }\n    const version = isValidRange ? parsedPackage.version : val.manifest.version;\n\n    return {\n      packageName: val.manifest.name,\n      version,\n      isSemver: true,\n      resolvedVia: val.resolvedVia,\n    };\n  } catch (e: any) {\n    if (!e.message?.includes('is not a valid string')) {\n      throw pnpmErrorToBitError(e);\n    }\n    // The provided package is probably a git url or path to a folder\n    const wantedDep: WantedDependency = {\n      alias: undefined,\n      pref: packageName,\n    };\n    const val = await resolve(wantedDep, resolveOpts);\n    if (!val.manifest) {\n      throw new BitError('The resolved package has no manifest');\n    }\n    if (!val.normalizedPref) {\n      throw new BitError('The resolved package has no version');\n    }\n    return {\n      packageName: val.manifest.name,\n      version: val.normalizedPref,\n      isSemver: false,\n      resolvedVia: val.resolvedVia,\n    };\n  }\n}\n\nfunction getRegistriesMap(registries: Registries): RegistriesMap {\n  const registriesMap = {\n    default: registries.defaultRegistry.uri || NPM_REGISTRY,\n  };\n\n  Object.entries(registries.scopes).forEach(([registryName, registry]) => {\n    registriesMap[`@${registryName}`] = registry.uri;\n  });\n  return registriesMap;\n}\n\nfunction getAuthConfig(registries: Registries): Record<string, any> {\n  const res: any = {};\n  res.registry = registries.defaultRegistry.uri;\n  if (registries.defaultRegistry.alwaysAuth) {\n    res['always-auth'] = true;\n  }\n  const defaultAuthTokens = getAuthTokenForRegistry(registries.defaultRegistry, true);\n  defaultAuthTokens.forEach(({ keyName, val }) => {\n    res[keyName] = val;\n  });\n\n  Object.entries(registries.scopes).forEach(([, registry]) => {\n    const authTokens = getAuthTokenForRegistry(registry);\n    authTokens.forEach(({ keyName, val }) => {\n      res[keyName] = val;\n    });\n    if (registry.alwaysAuth) {\n      const nerfed = toNerfDart(registry.uri);\n      const alwaysAuthKeyName = `${nerfed}:always-auth`;\n      res[alwaysAuthKeyName] = true;\n    }\n  });\n  return res;\n}\n\nfunction getAuthTokenForRegistry(registry: Registry, isDefault = false): { keyName: string; val: string }[] {\n  const nerfed = toNerfDart(registry.uri);\n  if (registry.originalAuthType === 'authToken') {\n    return [\n      {\n        keyName: `${nerfed}:_authToken`,\n        val: registry.originalAuthValue || '',\n      },\n    ];\n  }\n  if (registry.originalAuthType === 'auth') {\n    return [\n      {\n        keyName: isDefault ? '_auth' : `${nerfed}:_auth`,\n        val: registry.originalAuthValue || '',\n      },\n    ];\n  }\n  if (registry.originalAuthType === 'user-pass') {\n    return [\n      {\n        keyName: `${nerfed}:username`,\n        val: registry.originalAuthValue?.split(':')[0] || '',\n      },\n      {\n        keyName: `${nerfed}:_password`,\n        val: registry.originalAuthValue?.split(':')[1] || '',\n      },\n    ];\n  }\n  return [];\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAQA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAQA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAGA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAA2C;AAAA;AAAA;AAAA;AAE3C,MAAMA,IAAI,GAAG,IAAAC,iBAAS,EAACC,qBAAE,CAACF,IAAI,CAAC;AAC/B,MAAMG,eAA6C,GAAG,CAAC,CAAC;AAOxD,MAAMC,WAAmE,GAAG,CAAC,CAAC;AAE9E,eAAeC,qBAAqB,CAClCC,OAO6D,EACZ;EAAA;EACjD,MAAMC,UAAU,GAAGC,aAAa,CAACF,OAAO,CAACG,UAAU,CAAC;EACpD,MAAMC,IAAkC,GAAG;IACzCC,GAAG,EAAEL,OAAO,CAACM,OAAO;IACpBC,QAAQ,EAAEP,OAAO,CAACO,QAAQ;IAC1BC,QAAQ,EAAER,OAAO,CAACQ,QAAQ;IAC1BC,SAAS,EAAER,UAAU;IACrBS,oBAAoB,EAAE,IAAI;IAC1BC,SAAS,0BAAEX,OAAO,CAACY,WAAW,yDAAnB,qBAAqBD,SAAS;IACzCE,UAAU,2BAAEb,OAAO,CAACY,WAAW,0DAAnB,sBAAqBC,UAAU;IAC3CC,EAAE,2BAAEd,OAAO,CAACe,aAAa,0DAArB,sBAAuBD,EAAE;IAC7BE,IAAI,4BAAEhB,OAAO,CAACe,aAAa,2DAArB,uBAAuBC,IAAI;IACjCC,GAAG,4BAAEjB,OAAO,CAACe,aAAa,2DAArB,uBAAuBE,GAAG;IAC/BC,YAAY,4BAAElB,OAAO,CAACe,aAAa,2DAArB,uBAAuBG,YAAY;IACjDC,OAAO,2BAAEnB,OAAO,CAACY,WAAW,0DAAnB,sBAAqBO,OAAO;IACrCC,SAAS,EAAEpB,OAAO,CAACe,aAAa,CAACM,SAAS;IAC1CC,UAAU,EAAEtB,OAAO,CAACe,aAAa,CAACO,UAAU;IAC5CC,kBAAkB,EAAEvB,OAAO,CAACe,aAAa,CAACQ,kBAAkB;IAC5DC,mBAAmB,EAAExB,OAAO,CAACwB,mBAAmB;IAChDC,WAAW,EAAEC,eAAI,CAACC,IAAI,CAACC,mBAAQ,EAAE,OAAO,CAAC,CAAE;EAC7C,CAAC;EACD;EACA;EACA,MAAMC,QAAQ,GAAGC,IAAI,CAACC,SAAS,CAAC3B,IAAI,CAAC;EACrC,IAAI,CAACN,WAAW,CAAC+B,QAAQ,CAAC,EAAE;IAC1B;IACA;IACA/B,WAAW,CAAC+B,QAAQ,CAAC,GAAG,MAAM,IAAAG,wDAA8B,EAAC5B,IAAI,CAAC;EACpE;EACA,OAAON,WAAW,CAAC+B,QAAQ,CAAC;AAC9B;AAEA,eAAeI,0BAA0B,CACvC1B,QAAgB,EAChBJ,UAAsB,EACtBS,WAAsC,GAAG,CAAC,CAAC,EAC3CG,aAA0C,GAAG,CAAC,CAAC,EAC/C;EACA,MAAMmB,UAAU,GAAG,MAAM,IAAAC,wBAAU,GAAE;EACrC,MAAMlC,UAAU,GAAGC,aAAa,CAACC,UAAU,CAAC;EAC5C,MAAMC,IAAmB,GAAG;IAC1BH,UAAU,EAAEmC,MAAM,CAACC,MAAM,CAAC,CAAC,CAAC,EAAEH,UAAU,CAACI,MAAM,CAAC7B,SAAS,EAAER,UAAU,CAAC;IACtEM,QAAQ;IACRI,SAAS,EAAEC,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAED,SAAS;IACjCE,UAAU,EAAED,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAEC,UAAU;IACnCC,EAAE,EAAEC,aAAa,aAAbA,aAAa,uBAAbA,aAAa,CAAED,EAAE;IACrBE,IAAI,EAAED,aAAa,aAAbA,aAAa,uBAAbA,aAAa,CAAEC,IAAI;IACzBC,GAAG,EAAEF,aAAa,aAAbA,aAAa,uBAAbA,aAAa,CAAEE,GAAG;IACvBC,YAAY,EAAEH,aAAa,aAAbA,aAAa,uBAAbA,aAAa,CAAEG,YAAY;IACzCC,OAAO,EAAEP,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAEO,OAAO;IAC7BC,SAAS,EAAEL,aAAa,CAACM,SAAS;IAClCkB,OAAO,EAAExB,aAAa,CAACyB,YAAY;IACnCC,KAAK,EAAE;MACLC,MAAM,EAAE3B,aAAa,CAAC4B,gBAAgB;MACtCC,UAAU,EAAE7B,aAAa,CAAC8B,oBAAoB;MAC9CC,UAAU,EAAE/B,aAAa,CAACgC,oBAAoB;MAC9CC,OAAO,EAAEjC,aAAa,CAACkC;IACzB;EACF,CAAC;EACD,MAAMC,MAAM,GAAG,IAAAC,sBAAY,EAAC/C,IAAI,CAAC;EACjC,OAAO8C,MAAM;AACf;AAEO,eAAeE,uBAAuB,CAC3CC,gBAAqC,EACrCjD,IAQ6D,EACpB;EACzC,MAAMkD,QAA0B,GAAG,EAAE;EACrC,MAAMC,iBAAiB,GAAG,CAAC,CAAC;EAC5B,KAAK,MAAM,CAACjD,OAAO,EAAEkD,QAAQ,CAAC,IAAIpB,MAAM,CAACqB,OAAO,CAACJ,gBAAgB,CAAC,EAAE;IAClEC,QAAQ,CAACI,IAAI,CAAC;MACZC,UAAU,EAAE,CAAC;MAAE;MACfH,QAAQ;MACRlD;IACF,CAAC,CAAC;IACFiD,iBAAiB,CAACC,QAAQ,CAACI,IAAI,CAAC,GAAGL,iBAAiB,CAACC,QAAQ,CAACI,IAAI,CAAC,IAAI,CAAC,CAAC;IACzEL,iBAAiB,CAACC,QAAQ,CAACI,IAAI,CAAC,CAACJ,QAAQ,CAACK,OAAO,CAAC,GAAG;MAAExD,GAAG,EAAEC,OAAO;MAAEkD;IAAS,CAAC;EACjF;EACA,MAAMM,aAAa,GAAGC,gBAAgB,CAAC3D,IAAI,CAACD,UAAU,CAAC;EACvD,MAAM6D,eAAe,GAAG,MAAMjE,qBAAqB,iCAC9CK,IAAI;IACPE,OAAO,EAAEF,IAAI,CAACE;EAAO,GACrB;EACF,OAAO2D,IAAI,GAACb,uBAAuB,CAACE,QAAQ,EAAE;IAC5CU,eAAe,EAAEA,eAAe,CAACE,IAAI;IACrC1D,QAAQ,EAAEwD,eAAe,CAAC3D,GAAG;IAC7B8D,SAAS,EAAE/D,IAAI,CAAC+D,SAAS;IACzBZ,iBAAiB;IACjBpD,UAAU,EAAE2D;EACd,CAAC,CAAC;AACJ;AAEO,eAAeM,OAAO,CAC3B9D,OAAe,EACf+C,gBAAiD,EACjD7C,QAAgB,EAChBD,QAAgB,EAChBJ,UAAsB,EACtBS,WAAsC,GAAG,CAAC,CAAC,EAC3CG,aAA0C,GAAG,CAAC,CAAC,EAC/Cf,OAS2D;AAC3D;AACAqE,MAAe,EACf;EACA,IAAI,CAAChB,gBAAgB,CAAC/C,OAAO,CAAC,CAACgE,gBAAgB,EAAE;IAC/CjB,gBAAgB,mCACXA,gBAAgB;MACnB,CAAC/C,OAAO,mCACH+C,gBAAgB,CAAC/C,OAAO,CAAC;QAC5BgE,gBAAgB,EAAE,CAAC;MAAC;IACrB,EACF;EACH;EACA,MAAMC,WAA8B,GAAG,EAAE;EACzC,IAAIC,cAAc,GAAG,IAAIC,GAAG,EAAE;EAC9B,IAAIzE,OAAO,aAAPA,OAAO,eAAPA,OAAO,CAAE0E,cAAc,EAAE;IAC3B,MAAM;MAAEC,qBAAqB;MAAED;IAAe,CAAC,GAAGE,mCAAmC,CAACtE,OAAO,EAAE+C,gBAAgB,CAAC;IAChHA,gBAAgB,mCACXsB,qBAAqB,GACrBtB,gBAAgB,CACpB;IACDkB,WAAW,CAACb,IAAI,CAACmB,eAAe,CAAoB;IACpDL,cAAc,GAAG,IAAIC,GAAG,EAAE;IAC1BD,cAAc,CAACM,GAAG,CAAC,IAAI,EAAE,IAAIC,GAAG,CAACL,cAAc,CAAC,CAAC;EACnD,CAAC,MAAM,IAAI1E,OAAO,aAAPA,OAAO,eAAPA,OAAO,CAAEgF,yBAAyB,EAAE;IAC7CT,WAAW,CAACb,IAAI,CAACuB,0BAA0B,CAAoB;EACjE;EACA,MAAM;IAAEC,WAAW;IAAEC,eAAe;IAAE5B;EAAkB,CAAC,GAAG6B,SAAS,CAAC/B,gBAAgB,CAAC;EACvF,MAAMS,aAAa,GAAGC,gBAAgB,CAAC5D,UAAU,CAAC;EAClD,MAAMF,UAAU,GAAGC,aAAa,CAACC,UAAU,CAAC;EAC5C,MAAM6D,eAAe,GAAG,MAAMjE,qBAAqB,CAAC;IAClDO,OAAO;IACPE,QAAQ;IACRD,QAAQ;IACRJ,UAAU;IACVS,WAAW;IACXG,aAAa;IACbS,mBAAmB,EAAExB,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEwB;EAChC,CAAC,CAAC;EACF,MAAMpB,IAAoB;IACxB8E,WAAW;IACX1E,QAAQ,EAAEwD,eAAe,CAAC3D,GAAG;IAC7BA,GAAG,EAAEC,OAAO;IACZ0D,eAAe,EAAEA,eAAe,CAACE,IAAI;IACrCX,iBAAiB;IACjB8B,oBAAoB,EAAE,IAAI;IAC1BC,sBAAsB,EAAE,IAAI;IAC5BC,kBAAkB,EAAE,CAAC;IACrBpF,UAAU,EAAE2D,aAAa;IACzBrD,SAAS,EAAER,UAAU;IACrBuF,KAAK,EAAE;MAAEjB;IAAY,CAAC;IACtBC,cAAc;IACdiB,sBAAsB,EAAE;EAAK,GAC1BzF,OAAO;IACV0F,mBAAmB;MACjBC,QAAQ,EAAE,CAAC,GAAG,CAAC;MACfC,aAAa,EAAE,CAAC,GAAG;IAAC,GACjB5F,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAE0F,mBAAmB;EAChC,EACF;EAED,MAAMG,aAAa,GAAG,IAAAC,sCAAmB,EAAC;IACxCC,OAAO,EAAE;MACPC,IAAI,EAAE;IACR,CAAC;IACDC,gBAAgB,EAAE;MAChBC,UAAU,EAAE,KAAK;MACjBC,gBAAgB,EAAE;IACpB,CAAC;IACDC,YAAY,EAAZA;EACF,CAAC,CAAC;EACF,IAAI;IACF,MAAMvG,eAAe,CAACS,OAAO,CAAC;IAC9BT,eAAe,CAACS,OAAO,CAAC,GAAG,IAAA+F,oBAAa,EAAClB,eAAe,EAAE/E,IAAI,CAAC;IAC/D,MAAMP,eAAe,CAACS,OAAO,CAAC;IAC9B,OAAOT,eAAe,CAACS,OAAO,CAAC;EACjC,CAAC,CAAC,OAAOgG,GAAQ,EAAE;IACjB,MAAM,IAAAC,0CAAmB,EAACD,GAAG,CAAC;EAChC,CAAC,SAAS;IACRT,aAAa,EAAE;EACjB;EACA,IAAI7F,OAAO,CAAC0E,cAAc,EAAE;IAC1B,MAAM8B,YAAY,GAAG,MAAM,IAAAC,kCAAmB,EAAC/E,eAAI,CAACC,IAAI,CAACrB,OAAO,EAAE,cAAc,CAAC,CAAC;IAClF,IAAIkG,YAAY,aAAZA,YAAY,eAAZA,YAAY,CAAEE,YAAY,EAAE;MAC9B,MAAMC,2BAA2B,CAAC;QAChCD,YAAY,EAAEF,YAAY,CAACE,YAAY;QACvCrD,gBAAgB;QAChB/C;MACF,CAAC,CAAC;IACJ;EACF;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASsE,mCAAmC,CAACtE,OAAe,EAAE+C,gBAAiD,EAAE;EAC/G,MAAMsB,qBAAsD,GAAG,CAAC,CAAC;EACjE,MAAMD,cAAwB,GAAG,EAAE;EACnC,KAAK,MAAMlB,QAAQ,IAAIpB,MAAM,CAACwE,MAAM,CAACvD,gBAAgB,CAAC,EAAE;IACtD,MAAMO,IAAI,GAAGJ,QAAQ,CAACI,IAAI,CAAEiD,QAAQ,EAAE,CAAC,CAAC;IACxC,MAAMC,OAAO,GAAGpF,eAAI,CAACC,IAAI,CAACrB,OAAO,EAAE,cAAc,EAAEsD,IAAI,CAAC;IACxD,MAAMmD,EAAE,GAAGrF,eAAI,CAACsF,QAAQ,CAAC1G,OAAO,EAAEwG,OAAO,CAAC,CAACG,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC;IAC9DvC,cAAc,CAAChB,IAAI,CAACwD,kBAAkB,CAACH,EAAE,CAAC,CAAC;IAC3CpC,qBAAqB,CAACmC,OAAO,CAAC,GAAG;MAC/BlD,IAAI,EAAG,GAAEA,IAAK,QAAO;MACrBuD,YAAY;QACV,CAACvD,IAAI,GAAI;MAAY,GAClBJ,QAAQ,CAAC4D,gBAAgB,GACzB5D,QAAQ,CAAC,yBAAyB,CAAC,CACvC;MACDc,gBAAgB,EAAE;QAChB,CAACV,IAAI,GAAG;UAAEyD,QAAQ,EAAE;QAAK;MAC3B;IACF,CAAC;EACH;EACA,OAAO;IACL1C,qBAAqB;IACrBD;EACF,CAAC;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASO,0BAA0B,CAACqC,GAAoB,EAAEC,YAAqB,EAAmB;EAChG;EACA,IAAIA,YAAY,EAAE;IAChB,OAAOC,yBAAyB,iCAC3BF,GAAG;MACNH,YAAY,gDACPG,GAAG,CAACH,YAAY,GAChBG,GAAG,CAACF,gBAAgB,GACpBE,GAAG,CAAC,yBAAyB,CAAC;IAClC,GACD;EACJ;EACA,OAAOE,yBAAyB,CAACF,GAAG,CAAC;AACvC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAASzC,eAAe,CAACyC,GAAoB,EAAEC,YAAqB,EAAmB;EAAA;EACrF,IAAI,CAACD,GAAG,CAACH,YAAY,iBAAIG,GAAG,CAAC1D,IAAI,sCAAR,UAAU6D,QAAQ,CAAE,QAAO,CAAC,EAAE;IACrD,OAAOH,GAAG;EACZ;EACA;EACA,IAAIC,YAAY,EAAE;IAChB,OAAOG,wBAAwB,CAACJ,GAAG,CAAC;EACtC;EACA,OAAOE,yBAAyB,CAACF,GAAG,CAAC;AACvC;;AAEA;AACA;AACA;AACA;AACA,SAASE,yBAAyB,CAACF,GAAoB,EAAmB;EAAA;EACxE,MAAMhD,gBAAgB,4BAAGgD,GAAG,CAAChD,gBAAgB,yEAAI,CAAC,CAAC;EACnD,KAAK,MAAM,CAACV,IAAI,EAAEC,OAAO,CAAC,IAAIzB,MAAM,CAACqB,OAAO,sBAAC6D,GAAG,CAACH,YAAY,iEAAI,CAAC,CAAC,CAAC,EAAE;IAAA;IACpE,IAAItD,OAAO,CAAC8D,UAAU,CAAC,YAAY,CAAC,EAAE;MACpC;MACArD,gBAAgB,CAACV,IAAI,CAAC,GAAG;QAAEyD,QAAQ,EAAE;MAAK,CAAC;IAC7C;EACF;EACA,uCACKC,GAAG;IACNhD;EAAgB;AAEpB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASoD,wBAAwB,CAACJ,GAAoB,EAAmB;EACvE,MAAMM,OAAO,GAAG,CAAC,CAAC;EAClB,KAAK,MAAM,CAAChE,IAAI,EAAEC,OAAO,CAAC,IAAIzB,MAAM,CAACqB,OAAO,uBAAC6D,GAAG,CAACH,YAAY,mEAAI,CAAC,CAAC,CAAC,EAAE;IAAA;IACpE,IAAI,CAACtD,OAAO,CAAC8D,UAAU,CAAC,YAAY,CAAC,EAAE;MACrCC,OAAO,CAAChE,IAAI,CAAC,GAAGC,OAAO;IACzB;EACF;EACA,uCACKyD,GAAG;IACNH,YAAY,gDACPG,GAAG,CAACF,gBAAgB,GACpBE,GAAG,CAAC,yBAAyB,CAAC,GAC9BM,OAAO;EACX;AAEL;;AAEA;AACA;AACA;AACA;AACA,eAAejB,2BAA2B,CAAC;EACzCrG,OAAO;EACP+C,gBAAgB;EAChBqD;AAKF,CAAC,EAAE;EACD,MAAMmB,OAAO,CAACC,GAAG,CACf1F,MAAM,CAACqB,OAAO,CAACiD,YAAY,CAAC,CAACqB,GAAG,CAAC,OAAO,CAACjB,OAAO,EAAEkB,UAAU,CAAC,KAAK;IAAA;IAChE,MAAMC,OAAO,4BAAG5E,gBAAgB,CAAC3B,eAAI,CAACC,IAAI,CAACrB,OAAO,EAAEwG,OAAO,CAAC,CAAC,0DAA7C,sBAA+ClD,IAAI;IACnE,IAAI,CAACqE,OAAO,EAAE;IACd,MAAMC,WAAW,GAAGxG,eAAI,CAACC,IAAI,CAACrB,OAAO,EAAE,cAAc,EAAE2H,OAAO,EAAE,cAAc,CAAC;IAC/E,IAAIrI,qBAAE,CAACuI,UAAU,CAACD,WAAW,CAAC,EAAE;MAC9B,MAAML,OAAO,CAACC,GAAG,CAACE,UAAU,CAACD,GAAG,CAAEK,SAAS,IAAK1I,IAAI,CAACwI,WAAW,EAAExG,eAAI,CAACC,IAAI,CAACyG,SAAS,EAAE,cAAc,CAAC,CAAC,CAAC,CAAC;IAC3G;EACF,CAAC,CAAC,CACH;AACH;AAEA,SAAShD,SAAS,CAAC/B,gBAAiD,EAAE;EACpE,MAAMgF,IAAI,GAAGjG,MAAM,CAACqB,OAAO,CAACJ,gBAAgB,CAAC,CAAC0E,GAAG,CAAC,CAAC,CAAC1H,GAAG,EAAEmD,QAAQ,CAAC,MAAM;IAAEnD,GAAG;IAAEmD;EAAS,CAAC,CAAC,CAAC;EAC3F,MAAM;IAAE8E;EAAM,CAAC,GAAG,IAAAC,2BAAc,EAACF,IAAI,CAAC;EACtC,MAAMG,MAAM,GAAG,IAAAC,4BAAY,EAACH,KAAK,CAAQ;;EAEzC;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA,MAAMnD,eAAiC,GAAG,EAAE,CAAC,CAAC;EAC9C,MAAMD,WAA6B,GAAG,EAAE;EACxC,MAAM3B,iBAAiB,GAAG,CAAC,CAAC,CAAC,CAAC;;EAE9BiF,MAAM,CAACE,OAAO,CAAC,CAACC,IAAI,EAAEhF,UAAU,KAAK;IACnC,KAAK,MAAMrD,OAAO,IAAIqI,IAAI,EAAE;MAC1B,MAAMnF,QAAQ,GAAGH,gBAAgB,CAAC/C,OAAO,CAAC;MAC1C4E,WAAW,CAACxB,IAAI,CAAC;QACfC,UAAU;QACVH,QAAQ;QACRlD;MACF,CAAC,CAAC;MACF6E,eAAe,CAACzB,IAAI,CAAC;QACnBpD,OAAO;QACPsI,QAAQ,EAAE;MACZ,CAAC,CAAC;MACF,IAAIpF,QAAQ,CAACI,IAAI,EAAE;QACjBL,iBAAiB,CAACC,QAAQ,CAACI,IAAI,CAAC,GAAGL,iBAAiB,CAACC,QAAQ,CAACI,IAAI,CAAC,IAAI,CAAC,CAAC;QACzEL,iBAAiB,CAACC,QAAQ,CAACI,IAAI,CAAC,CAACJ,QAAQ,CAACK,OAAO,CAAC,GAAG;UAAExD,GAAG,EAAEC,OAAO;UAAEkD;QAAS,CAAC;MACjF;IACF;EACF,CAAC,CAAC;EACF,OAAO;IAAE2B,eAAe;IAAED,WAAW;IAAE3B;EAAkB,CAAC;AAC5D;AAEO,eAAesF,oBAAoB,CACxCC,WAAmB,EACnBxI,OAAe,EACfC,QAAgB,EAChBJ,UAAsB,EACtBS,WAAsC,GAAG,CAAC,CAAC,EAC3CG,aAA0C,GAAG,CAAC,CAAC,EACd;EACjC,MAAM;IAAEgI;EAAQ,CAAC,GAAG,MAAM9G,0BAA0B,CAAC1B,QAAQ,EAAEJ,UAAU,EAAES,WAAW,EAAEG,aAAa,CAAC;EACtG,MAAMiI,WAAW,GAAG;IAClBC,WAAW,EAAE3I,OAAO;IACpB4I,iBAAiB,EAAE,CAAC,CAAC;IACrBC,UAAU,EAAE7I,OAAO;IACnB8I,QAAQ,EAAE;EACZ,CAAC;EACD,IAAI;IACF,MAAMC,aAAa,GAAG,IAAAC,2BAAgB,EAACR,WAAW,CAAC;IACnD,MAAMhF,aAAa,GAAGC,gBAAgB,CAAC5D,UAAU,CAAC;IAClD,MAAMiJ,QAAQ,GAAG,IAAAG,gDAAsB,EAACzF,aAAa,EAAEuF,aAAa,CAACzF,IAAI,CAAC;IAC1E,MAAM4F,SAA2B,GAAG;MAClCC,KAAK,EAAEJ,aAAa,CAACzF,IAAI;MACzB8F,IAAI,EAAEL,aAAa,CAACxF;IACtB,CAAC;IACD,MAAM8F,YAAY,GAAGN,aAAa,CAACxF,OAAO,GAAG,CAAC,CAAC+F,iBAAM,CAACC,UAAU,CAACR,aAAa,CAACxF,OAAO,CAAC,GAAG,KAAK;IAC/FmF,WAAW,CAACI,QAAQ,GAAGA,QAAQ;IAC/B,MAAMU,GAAG,GAAG,MAAMf,OAAO,CAACS,SAAS,EAAER,WAAW,CAAC;IACjD,IAAI,CAACc,GAAG,CAACtG,QAAQ,EAAE;MACjB,MAAM,KAAIuG,oBAAQ,EAAC,sCAAsC,CAAC;IAC5D;IACA,MAAMlG,OAAO,GAAG8F,YAAY,GAAGN,aAAa,CAACxF,OAAO,GAAGiG,GAAG,CAACtG,QAAQ,CAACK,OAAO;IAE3E,OAAO;MACLiF,WAAW,EAAEgB,GAAG,CAACtG,QAAQ,CAACI,IAAI;MAC9BC,OAAO;MACPmG,QAAQ,EAAE,IAAI;MACdC,WAAW,EAAEH,GAAG,CAACG;IACnB,CAAC;EACH,CAAC,CAAC,OAAOC,CAAM,EAAE;IAAA;IACf,IAAI,gBAACA,CAAC,CAACC,OAAO,uCAAT,WAAWC,QAAQ,CAAC,uBAAuB,CAAC,GAAE;MACjD,MAAM,IAAA7D,0CAAmB,EAAC2D,CAAC,CAAC;IAC9B;IACA;IACA,MAAMV,SAA2B,GAAG;MAClCC,KAAK,EAAEY,SAAS;MAChBX,IAAI,EAAEZ;IACR,CAAC;IACD,MAAMgB,GAAG,GAAG,MAAMf,OAAO,CAACS,SAAS,EAAER,WAAW,CAAC;IACjD,IAAI,CAACc,GAAG,CAACtG,QAAQ,EAAE;MACjB,MAAM,KAAIuG,oBAAQ,EAAC,sCAAsC,CAAC;IAC5D;IACA,IAAI,CAACD,GAAG,CAACQ,cAAc,EAAE;MACvB,MAAM,KAAIP,oBAAQ,EAAC,qCAAqC,CAAC;IAC3D;IACA,OAAO;MACLjB,WAAW,EAAEgB,GAAG,CAACtG,QAAQ,CAACI,IAAI;MAC9BC,OAAO,EAAEiG,GAAG,CAACQ,cAAc;MAC3BN,QAAQ,EAAE,KAAK;MACfC,WAAW,EAAEH,GAAG,CAACG;IACnB,CAAC;EACH;AACF;AAEA,SAASlG,gBAAgB,CAAC5D,UAAsB,EAAiB;EAC/D,MAAM2D,aAAa,GAAG;IACpByG,OAAO,EAAEpK,UAAU,CAACqK,eAAe,CAACC,GAAG,IAAIC;EAC7C,CAAC;EAEDtI,MAAM,CAACqB,OAAO,CAACtD,UAAU,CAACwK,MAAM,CAAC,CAACjC,OAAO,CAAC,CAAC,CAACkC,YAAY,EAAExB,QAAQ,CAAC,KAAK;IACtEtF,aAAa,CAAE,IAAG8G,YAAa,EAAC,CAAC,GAAGxB,QAAQ,CAACqB,GAAG;EAClD,CAAC,CAAC;EACF,OAAO3G,aAAa;AACtB;AAEA,SAAS5D,aAAa,CAACC,UAAsB,EAAuB;EAClE,MAAM0K,GAAQ,GAAG,CAAC,CAAC;EACnBA,GAAG,CAACzB,QAAQ,GAAGjJ,UAAU,CAACqK,eAAe,CAACC,GAAG;EAC7C,IAAItK,UAAU,CAACqK,eAAe,CAACM,UAAU,EAAE;IACzCD,GAAG,CAAC,aAAa,CAAC,GAAG,IAAI;EAC3B;EACA,MAAME,iBAAiB,GAAGC,uBAAuB,CAAC7K,UAAU,CAACqK,eAAe,EAAE,IAAI,CAAC;EACnFO,iBAAiB,CAACrC,OAAO,CAAC,CAAC;IAAEuC,OAAO;IAAEnB;EAAI,CAAC,KAAK;IAC9Ce,GAAG,CAACI,OAAO,CAAC,GAAGnB,GAAG;EACpB,CAAC,CAAC;EAEF1H,MAAM,CAACqB,OAAO,CAACtD,UAAU,CAACwK,MAAM,CAAC,CAACjC,OAAO,CAAC,CAAC,GAAGU,QAAQ,CAAC,KAAK;IAC1D,MAAM8B,UAAU,GAAGF,uBAAuB,CAAC5B,QAAQ,CAAC;IACpD8B,UAAU,CAACxC,OAAO,CAAC,CAAC;MAAEuC,OAAO;MAAEnB;IAAI,CAAC,KAAK;MACvCe,GAAG,CAACI,OAAO,CAAC,GAAGnB,GAAG;IACpB,CAAC,CAAC;IACF,IAAIV,QAAQ,CAAC0B,UAAU,EAAE;MACvB,MAAMK,MAAM,GAAG,IAAAC,mBAAU,EAAChC,QAAQ,CAACqB,GAAG,CAAC;MACvC,MAAMY,iBAAiB,GAAI,GAAEF,MAAO,cAAa;MACjDN,GAAG,CAACQ,iBAAiB,CAAC,GAAG,IAAI;IAC/B;EACF,CAAC,CAAC;EACF,OAAOR,GAAG;AACZ;AAEA,SAASG,uBAAuB,CAAC5B,QAAkB,EAAEkC,SAAS,GAAG,KAAK,EAAsC;EAC1G,MAAMH,MAAM,GAAG,IAAAC,mBAAU,EAAChC,QAAQ,CAACqB,GAAG,CAAC;EACvC,IAAIrB,QAAQ,CAACmC,gBAAgB,KAAK,WAAW,EAAE;IAC7C,OAAO,CACL;MACEN,OAAO,EAAG,GAAEE,MAAO,aAAY;MAC/BrB,GAAG,EAAEV,QAAQ,CAACoC,iBAAiB,IAAI;IACrC,CAAC,CACF;EACH;EACA,IAAIpC,QAAQ,CAACmC,gBAAgB,KAAK,MAAM,EAAE;IACxC,OAAO,CACL;MACEN,OAAO,EAAEK,SAAS,GAAG,OAAO,GAAI,GAAEH,MAAO,QAAO;MAChDrB,GAAG,EAAEV,QAAQ,CAACoC,iBAAiB,IAAI;IACrC,CAAC,CACF;EACH;EACA,IAAIpC,QAAQ,CAACmC,gBAAgB,KAAK,WAAW,EAAE;IAAA;IAC7C,OAAO,CACL;MACEN,OAAO,EAAG,GAAEE,MAAO,WAAU;MAC7BrB,GAAG,EAAE,0BAAAV,QAAQ,CAACoC,iBAAiB,0DAA1B,sBAA4BC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,KAAI;IACpD,CAAC,EACD;MACER,OAAO,EAAG,GAAEE,MAAO,YAAW;MAC9BrB,GAAG,EAAE,2BAAAV,QAAQ,CAACoC,iBAAiB,2DAA1B,uBAA4BC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,KAAI;IACpD,CAAC,CACF;EACH;EACA,OAAO,EAAE;AACX"}