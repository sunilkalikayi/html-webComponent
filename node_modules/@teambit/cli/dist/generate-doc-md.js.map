{"version":3,"names":["GenerateCommandsDoc","constructor","commands","options","generate","getAllPublicCommandsSorted","output","getFrontmatter","map","cmd","generateCommand","join","generateJson","commandsToObjects","command","cmdObject","oneCommandToObject","length","metadata","metadataStr","Object","keys","key","publicCommands","filter","private","sort","a","b","name","localeCompare","commandName","getCommandId","result","alias","skipWorkspace","formatDescription","generateSubCommands","generateOptions","subCommands","ret","forEach","subCommand","subcommandName","usage","opt","flag","description","aliasFormatted","flagFormatted","formatStringToMD","str","split","extendedDescription","pick"],"sources":["generate-doc-md.ts"],"sourcesContent":["import { Command } from '@teambit/legacy/dist/cli/command';\nimport { CommandOptions } from '@teambit/legacy/dist/cli/legacy-command';\nimport { pick } from 'lodash';\nimport { getCommandId } from './get-command-id';\n\nexport type GenerateOpts = {\n  metadata?: Record<string, string>;\n};\n\ntype CommandObject = ReturnType<typeof oneCommandToObject> & { commands?: any };\n\nexport class GenerateCommandsDoc {\n  constructor(private commands: Command[], private options: GenerateOpts) {}\n\n  generate(): string {\n    const commands = this.getAllPublicCommandsSorted();\n    let output = `${this.getFrontmatter()}\n# CLI Reference\n\nCommands that are marked as workspace only must be executed inside a workspace. Commands that are marked as not workspace only, can be executed from anywhere and will run on a remote server.\n`;\n    output += commands.map((cmd) => this.generateCommand(cmd)).join('\\n');\n\n    return output;\n  }\n\n  generateJson() {\n    return this.commandsToObjects();\n  }\n\n  private commandsToObjects(commands: Command[] = this.commands): CommandObject[] {\n    return commands.map((command) => {\n      const cmdObject: CommandObject = oneCommandToObject(command);\n      if (command.commands?.length) {\n        cmdObject.commands = this.commandsToObjects(command.commands);\n      }\n      return cmdObject;\n    });\n  }\n\n  private getFrontmatter() {\n    const metadata = this.options.metadata;\n    if (!metadata) {\n      return '';\n    }\n    const metadataStr = Object.keys(metadata)\n      .map((key) => `${key}: ${metadata[key]}`)\n      .join('\\n');\n\n    return `---\n    ${metadataStr}\n    ---\n`;\n  }\n\n  private getAllPublicCommandsSorted() {\n    const publicCommands = this.commands.filter((cmd) => !cmd.private);\n    return publicCommands.sort((a, b) => a.name.localeCompare(b.name));\n  }\n\n  private generateCommand(cmd: Command) {\n    const commandName = getCommandId(cmd.name);\n    let result = `## ${commandName}  \\n\\n`;\n    if (cmd.alias && cmd.alias.length > 0) {\n      result += `**Alias**: \\`${cmd.alias}\\`  \\n`;\n    }\n    result += `**Workspace only**: ${cmd.skipWorkspace ? 'no' : 'yes'}  \\n`;\n    result += `**Description**: ${this.formatDescription(cmd)}`;\n    result += `\\`bit ${cmd.name}\\`  \\n\\n`;\n\n    if (cmd.commands && cmd.commands.length > 0) {\n      result += this.generateSubCommands(cmd.commands, cmd);\n    }\n    result += this.generateOptions(cmd.options);\n    result += `---  \\n`;\n\n    return result;\n  }\n\n  private generateSubCommands(subCommands: Command[], command: Command) {\n    let ret = '';\n    subCommands.forEach((subCommand) => {\n      const commandName = getCommandId(command.name);\n      const subcommandName = getCommandId(subCommand.name);\n      const usage = `${commandName} ${subCommand.name}`;\n      ret += `### ${commandName} ${subcommandName} \\n`;\n      ret += `**Usage**: \\`${usage}\\`  \\n\\n`;\n      ret += `**Description**: ${this.formatDescription(subCommand)}`;\n\n      ret += '\\n';\n      ret += this.generateOptions(subCommand.options);\n    });\n    return ret;\n  }\n\n  private generateOptions(options: CommandOptions): string {\n    if (!options || options.length <= 0) return '';\n    let output = `| **Option** | **Option alias** | **Description**|  \\n`;\n    output += `|---|:-----:|---|\\n`;\n    options.forEach((opt) => {\n      const [alias, flag, description] = opt;\n      const aliasFormatted = alias ? `\\`-${alias}\\`` : '   ';\n      const flagFormatted = `--${flag}`;\n      output += `|\\`${flagFormatted}\\`|${aliasFormatted}|${description}|\\n`;\n    });\n    output += `\\n`;\n    return output;\n  }\n\n  private formatStringToMD(str: string): string {\n    return str.split('\\n').join('  \\n');\n  }\n\n  private formatDescription(command: Command): string {\n    const extendedDescription = command.extendedDescription\n      ? `  \\n${this.formatStringToMD(command.extendedDescription)}`\n      : '';\n    const description = this.formatStringToMD(command.description as string);\n    return `${description}${extendedDescription}  \\n\\n`;\n  }\n}\n\nfunction oneCommandToObject(command: Command) {\n  return pick(command, [\n    'name',\n    'alias',\n    'options',\n    'description',\n    'extendedDescription',\n    'group',\n    'private',\n    'internal',\n    'remoteOp',\n    'skipWorkspace',\n    'arguments',\n    'examples',\n  ]);\n}\n"],"mappings":"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"}