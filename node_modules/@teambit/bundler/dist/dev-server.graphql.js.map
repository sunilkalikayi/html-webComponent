{"version":3,"names":["devServerSchema","bundler","typeDefs","gql","resolvers","Component","server","component","args","context","requestedId","body","variables","id","includes","componentServer","getComponentServer","env","envRuntime","url"],"sources":["dev-server.graphql.ts"],"sourcesContent":["import { Component } from '@teambit/component';\nimport { Schema } from '@teambit/graphql';\nimport { gql } from '@apollo/client';\n\nimport { BundlerMain } from './bundler.main.runtime';\n\n// TODO: this has to be refactored to the Preview aspect. with the entire preview logic here.\nexport function devServerSchema(bundler: BundlerMain): Schema {\n  return {\n    typeDefs: gql`\n      extend type Component {\n        server: ComponentServer\n      }\n\n      type ComponentServer {\n        env: String\n        url: String\n      }\n    `,\n    resolvers: {\n      Component: {\n        server: (component: Component, args, context) => {\n          // This is a bit of a hack to get the requested id. it assumes the variable name of\n          // the gotHost.get query is \"id\".\n          // see it in scopes/component/component/component.graphql.ts\n          const requestedId = context.body.variables.id;\n          // if we ask for specific id with specific version it means we want to fetch if from scope\n          // so don't return the server url\n          // see https://github.com/teambit/bit/issues/5328\n          if (requestedId && requestedId.includes('@')) {\n            return {};\n          }\n          const componentServer = bundler.getComponentServer(component);\n          if (!componentServer) return {};\n\n          return {\n            env: componentServer.context.envRuntime.id,\n            url: componentServer.url,\n          };\n        },\n      },\n    },\n  };\n}\n"],"mappings":";;;;;;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAIA;AACO,SAASA,eAAe,CAACC,OAAoB,EAAU;EAC5D,OAAO;IACLC,QAAQ,EAAE,IAAAC,aAAG,CAAC;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;IACDC,SAAS,EAAE;MACTC,SAAS,EAAE;QACTC,MAAM,EAAE,CAACC,SAAoB,EAAEC,IAAI,EAAEC,OAAO,KAAK;UAC/C;UACA;UACA;UACA,MAAMC,WAAW,GAAGD,OAAO,CAACE,IAAI,CAACC,SAAS,CAACC,EAAE;UAC7C;UACA;UACA;UACA,IAAIH,WAAW,IAAIA,WAAW,CAACI,QAAQ,CAAC,GAAG,CAAC,EAAE;YAC5C,OAAO,CAAC,CAAC;UACX;UACA,MAAMC,eAAe,GAAGd,OAAO,CAACe,kBAAkB,CAACT,SAAS,CAAC;UAC7D,IAAI,CAACQ,eAAe,EAAE,OAAO,CAAC,CAAC;UAE/B,OAAO;YACLE,GAAG,EAAEF,eAAe,CAACN,OAAO,CAACS,UAAU,CAACL,EAAE;YAC1CM,GAAG,EAAEJ,eAAe,CAACI;UACvB,CAAC;QACH;MACF;IACF;EACF,CAAC;AACH"}