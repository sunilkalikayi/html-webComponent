{"version":3,"names":["FetchCmd","constructor","importer","report","ids","lanes","components","json","fromOriginalScope","importedIds","importDetails","fetch","JSON","stringify","length","title","componentDependencies","map","id","details","find","c","toStringWithoutVersion","Error","toString","formatPlainComponentItemWithVersions","componentDependenciesOutput","chalk","green","concat","join","yellow","bitId","status","versions","usedVersion","version","getConflictMessage","filesStatus","conflictedFiles","Object","keys","filter","file","FileStatus","manual","bold","deprecated","missingDeps","red","d","cyan"],"sources":["fetch-cmd.ts"],"sourcesContent":["import chalk from 'chalk';\nimport { Command, CommandOptions } from '@teambit/cli';\nimport { BitId } from '@teambit/legacy-bit-id';\nimport { FileStatus } from '@teambit/legacy/dist/consumer/versions-ops/merge-version/merge-version';\nimport { ImporterMain } from './importer.main.runtime';\nimport { ImportDetails, ImportStatus } from './import-components';\n\nexport class FetchCmd implements Command {\n  name = 'fetch [ids...]';\n  description = `fetch remote objects and store locally`;\n  extendedDescription = `for lanes, use \"/\" as a separator between the remote and the lane name, e.g. teambit.ui/fix-button`;\n  alias = '';\n  private = true;\n  options = [\n    [\n      'l',\n      'lanes',\n      'EXPERIMENTAL. fetch component objects from lanes. note, it does not save the remote lanes objects locally, only the refs',\n    ],\n    ['c', 'components', 'fetch components'],\n    ['j', 'json', 'return the output as JSON'],\n    [\n      '',\n      'from-original-scopes',\n      'fetch indirect dependencies from their original scope as opposed to from their dependents',\n    ],\n  ] as CommandOptions;\n  loader = true;\n\n  constructor(private importer: ImporterMain) {}\n\n  async report(\n    [ids = []]: [string[]],\n    {\n      lanes = false,\n      components = false,\n      json = false,\n      fromOriginalScope = false,\n    }: {\n      lanes?: boolean;\n      components?: boolean;\n      json?: boolean;\n      fromOriginalScope?: boolean;\n    }\n  ) {\n    const { importedIds, importDetails } = await this.importer.fetch(ids, lanes, components, fromOriginalScope);\n    if (json) {\n      return JSON.stringify({ importDetails }, null, 4);\n    }\n    if (importedIds.length) {\n      const title =\n        importedIds.length === 1\n          ? 'successfully fetched one component'\n          : `successfully fetched ${importedIds.length} components`;\n      const componentDependencies = importedIds.map((id) => {\n        const details = importDetails.find((c) => c.id === id.toStringWithoutVersion());\n        if (!details) throw new Error(`missing details of component ${id.toString()}`);\n        return formatPlainComponentItemWithVersions(id, details);\n      });\n      const componentDependenciesOutput = [chalk.green(title)].concat(componentDependencies).join('\\n');\n\n      return componentDependenciesOutput;\n    }\n    return chalk.yellow('nothing to import');\n  }\n}\n\nfunction formatPlainComponentItemWithVersions(bitId: BitId, importDetails: ImportDetails) {\n  const status: ImportStatus = importDetails.status;\n  const id = bitId.toStringWithoutVersion();\n  const versions = importDetails.versions.length ? `new versions: ${importDetails.versions.join(', ')}` : '';\n  const usedVersion = status === 'added' ? `, currently used version ${bitId.version}` : '';\n  const getConflictMessage = () => {\n    if (!importDetails.filesStatus) return '';\n    const conflictedFiles = Object.keys(importDetails.filesStatus) // $FlowFixMe file is set\n      // @ts-ignore AUTO-ADDED-AFTER-MIGRATION-PLEASE-FIX!\n      .filter((file) => importDetails.filesStatus[file] === FileStatus.manual);\n    if (!conflictedFiles.length) return '';\n    return `(the following files were saved with conflicts ${conflictedFiles\n      .map((file) => chalk.bold(file))\n      .join(', ')}) `;\n  };\n  const deprecated = importDetails.deprecated ? chalk.yellow('deprecated') : '';\n  const missingDeps = importDetails.missingDeps.length\n    ? chalk.red(`missing dependencies: ${importDetails.missingDeps.map((d) => d.toString()).join(', ')}`)\n    : '';\n  return `- ${chalk.green(status)} ${chalk.cyan(\n    id\n  )} ${versions}${usedVersion} ${getConflictMessage()}${deprecated} ${missingDeps}`;\n}\n"],"mappings":"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"}