{"version":3,"names":["ImportComponents","constructor","workspace","graph","options","consumer","scope","laneObjects","lanes","importComponents","loader","start","BEFORE_IMPORT_ACTION","saveDependenciesAsComponents","config","_saveDependenciesAsComponents","ids","length","importObjectsOnLane","importSpecificComponents","importAccordingToBitMap","objectsOnly","Error","lane","undefined","bitIds","getBitIds","logger","debug","id","toString","beforeImportVersions","_getCurrentVersions","versionDependenciesArr","_importComponentsObjects","allHistory","mainIdsLatest","BitIds","fromArray","toBitIds","map","m","changeVersion","ignoreMissingHead","mergeAllLanesResults","pMapSeries","laneObject","sources","mergeLane","mergedLanes","result","Promise","all","mergedLane","saveLane","importDetails","_getImportDetails","importedIds","v","component","flat","importedDeps","allDependenciesIds","join","_throwForPotentialIssues","writtenComponents","componentsWithDependencies","multipleVersionDependenciesToConsumer","objects","_fetchDivergeData","_throwForDivergedHistory","_writeToFileSystem","_saveLaneDataIfNeeded","c","modelComponent","getModelComponent","setDivergeData","divergeData","push","merge","divergedComponents","filter","getDivergeData","isDiverged","snapsLocal","snapsOnLocalOnly","snapsRemote","snapsOnRemoteOnly","ComponentsPendingMerge","fromOriginalScope","scopeComponentsImporter","ScopeComponentsImporter","getInstance","importManyDeltaWithoutDeps","results","importManyFromOriginalScopes","importMany","getBitIdsForLanes","bitIdsFromLane","flatMap","mainIds","bitMap","getAuthoredAndImportedBitIdsOfDefaultLane","mainIdsToImport","hasScope","hasWithoutVersion","idsWithWildcard","hasWildcard","idsWithoutWildcard","idsWithoutWildcardPreferFromLane","idStr","BitId","parse","fromLane","searchWithoutVersion","idsFromRemote","getRemoteBitIdsByWildcards","existingOnLanes","BitError","l","name","toStringWithoutVersion","getBitIdsForNonLanes","importDependenciesDirectly","importDependents","graphs","_getComponentsGraphs","dependenciesIds","_getDependenciesFromGraph","getGraph","targetCompIds","resolveMultipleComponentIds","sourceIds","listIds","findIdsFromSourcesToTargets","_legacy","uniqFromArray","dependencies","bitId","componentGraph","find","scopeName","dependenciesInfo","getDependenciesInfo","d","R","flatten","_getDependentsFromGraph","dependents","dependentsInfo","getDependentsInfo","remotes","getScopeRemotes","scopeGraphs","override","componentsIdsToImport","getIdsToImportFromBitmap","isEmpty","NothingToImport","_throwForModifiedOrNewComponents","componentWithDependencies","authoredExportedComponents","getExportedComponents","versionsP","getModelComponentIfExist","listVersions","versions","fromPairs","currentVersions","components","detailsP","Object","keys","ShowDoctorError","afterImportVersions","versionDifference","difference","getStatus","filesStatus","mergeStatus","deprecated","isDeprecated","removed","isRemoved","latestVersion","latest","includes","status","missingDeps","getMissingDependencies","_throwForDifferentComponentWithSameName","componentsStatuses","getManyComponentsStatuses","modifiedComponents","modified","newlyCreated","GeneralError","chalk","yellow","forEach","existingId","getParsedIdIfExist","_getMergeStatus","componentStatus","getComponentStatusById","mergeResults","componentModel","existingBitMapBitId","getBitId","ignoreVersion","fsComponent","loadComponent","currentlyUsedVersion","version","baseComponent","loadVersion","otherComponent","threeWayMerge","otherLabel","currentComponent","currentLabel","_updateComponentFilesPerMergeStrategy","componentMergeStatus","files","hasConflicts","mergeStrategy","MergeOptions","ours","file","pathNormalizeToLinux","relative","FileStatus","unchanged","updateComponentId","hasChanged","theirs","updated","modifiedFiles","applyModifiedVersion","updateAllComponentsAccordingToMergeStrategy","componentsStatusP","componentsStatus","componentWithConflict","getMergeStrategyInteractive","componentsToWrite","unchangedFiles","removeNulls","reject","isNil","_shouldSaveLaneData","isOnLane","currentLane","getCurrentLaneObject","idsFromRemoteLanes","comp","existOnRemoteLane","has","saveInLane","setComponentProp","ref","getRef","addComponent","head","manyComponentsWriter","ManyComponentsWriter","writeToPath","writeConfig","installNpmPackages","verbose","writeAll"],"sources":["import-components.ts"],"sourcesContent":["import chalk from 'chalk';\nimport R from 'ramda';\nimport { BitError } from '@teambit/bit-error';\nimport { LaneId } from '@teambit/lane-id';\nimport pMapSeries from 'p-map-series';\nimport { getRemoteBitIdsByWildcards } from '@teambit/legacy/dist/api/consumer/lib/list-scope';\nimport { BitId, BitIds } from '@teambit/legacy/dist/bit-id';\nimport { Consumer } from '@teambit/legacy/dist/consumer';\nimport loader from '@teambit/legacy/dist/cli/loader';\nimport { BEFORE_IMPORT_ACTION } from '@teambit/legacy/dist/cli/loader/loader-messages';\nimport GeneralError from '@teambit/legacy/dist/error/general-error';\nimport ShowDoctorError from '@teambit/legacy/dist/error/show-doctor-error';\nimport logger from '@teambit/legacy/dist/logger/logger';\nimport Remotes from '@teambit/legacy/dist/remotes/remotes';\nimport { ComponentWithDependencies, Scope } from '@teambit/legacy/dist/scope';\nimport DependencyGraph from '@teambit/legacy/dist/scope/graph/scope-graph';\nimport { Lane, ModelComponent, Version } from '@teambit/legacy/dist/scope/models';\nimport { getScopeRemotes } from '@teambit/legacy/dist/scope/scope-remotes';\nimport { pathNormalizeToLinux } from '@teambit/legacy/dist/utils';\nimport hasWildcard from '@teambit/legacy/dist/utils/string/has-wildcard';\nimport Component from '@teambit/legacy/dist/consumer/component';\nimport { NothingToImport } from '@teambit/legacy/dist/consumer/exceptions';\nimport { applyModifiedVersion } from '@teambit/legacy/dist/consumer/versions-ops/checkout-version';\nimport {\n  FileStatus,\n  getMergeStrategyInteractive,\n  MergeOptions,\n  threeWayMerge,\n} from '@teambit/legacy/dist/consumer/versions-ops/merge-version';\nimport { FilesStatus, MergeStrategy } from '@teambit/legacy/dist/consumer/versions-ops/merge-version/merge-version';\nimport { MergeResultsThreeWay } from '@teambit/legacy/dist/consumer/versions-ops/merge-version/three-way-merge';\nimport ComponentsPendingMerge from '@teambit/legacy/dist/consumer/component-ops/exceptions/components-pending-merge';\nimport ManyComponentsWriter from '@teambit/legacy/dist/consumer/component-ops/many-components-writer';\nimport ScopeComponentsImporter from '@teambit/legacy/dist/scope/component-ops/scope-components-importer';\nimport VersionDependencies, {\n  multipleVersionDependenciesToConsumer,\n} from '@teambit/legacy/dist/scope/version-dependencies';\nimport { GraphMain } from '@teambit/graph';\nimport { Workspace } from '@teambit/workspace';\n\nexport type ImportOptions = {\n  ids: string[]; // array might be empty\n  verbose?: boolean;\n  merge?: boolean;\n  mergeStrategy?: MergeStrategy;\n  writeToPath?: string;\n  writeConfig?: boolean;\n  override?: boolean;\n  installNpmPackages: boolean; // default: true\n  objectsOnly?: boolean;\n  saveDependenciesAsComponents?: boolean;\n  importDependenciesDirectly?: boolean; // default: false, normally it imports them as packages or nested, not as imported\n  importDependents?: boolean;\n  fromOriginalScope?: boolean; // default: false, otherwise, it fetches flattened dependencies from their dependents\n  saveInLane?: boolean; // save the imported component on the current lane (won't be available on main)\n  lanes?: {\n    laneIds: LaneId[];\n    lanes: Lane[]; // it can be an empty array when a lane is a local lane and doesn't exist on the remote\n  };\n  allHistory?: boolean;\n};\ntype ComponentMergeStatus = {\n  componentWithDependencies: ComponentWithDependencies;\n  mergeResults: MergeResultsThreeWay | null | undefined;\n};\ntype ImportedVersions = { [id: string]: string[] };\nexport type ImportStatus = 'added' | 'updated' | 'up to date';\nexport type ImportDetails = {\n  id: string;\n  versions: string[];\n  latestVersion: string | null;\n  status: ImportStatus;\n  filesStatus: FilesStatus | null | undefined;\n  missingDeps: BitId[];\n  deprecated: boolean;\n  removed?: boolean;\n};\nexport type ImportResult = {\n  importedIds: BitId[];\n  importedDeps: BitId[];\n  writtenComponents?: Component[];\n  importDetails: ImportDetails[];\n  cancellationMessage?: string;\n};\n\nexport default class ImportComponents {\n  consumer: Consumer;\n  scope: Scope;\n  mergeStatus: { [id: string]: FilesStatus };\n  private laneObjects: Lane[];\n  private divergeData: Array<ModelComponent> = [];\n  constructor(private workspace: Workspace, private graph: GraphMain, public options: ImportOptions) {\n    this.consumer = this.workspace.consumer;\n    this.scope = this.consumer.scope;\n    this.laneObjects = this.options.lanes ? (this.options.lanes.lanes as Lane[]) : [];\n  }\n\n  importComponents(): Promise<ImportResult> {\n    loader.start(BEFORE_IMPORT_ACTION);\n    this.options.saveDependenciesAsComponents = this.consumer.config._saveDependenciesAsComponents;\n    if (this.options.lanes && !this.options.ids.length) {\n      return this.importObjectsOnLane();\n    }\n    if (this.options.ids.length) {\n      return this.importSpecificComponents();\n    }\n    return this.importAccordingToBitMap();\n  }\n\n  async importObjectsOnLane(): Promise<ImportResult> {\n    if (!this.options.objectsOnly) {\n      throw new Error(`importObjectsOnLane should have objectsOnly=true`);\n    }\n    if (this.laneObjects.length > 1) {\n      throw new Error(`importObjectsOnLane does not support more than one lane`);\n    }\n    const lane = this.laneObjects.length ? this.laneObjects[0] : undefined;\n    const bitIds: BitIds = await this.getBitIds();\n    lane\n      ? logger.debug(`importObjectsOnLane, Lane: ${lane.id()}, Ids: ${bitIds.toString()}`)\n      : logger.debug(`importObjectsOnLane, the lane does not exist on the remote. importing only the main components`);\n    const beforeImportVersions = await this._getCurrentVersions(bitIds);\n    const versionDependenciesArr = await this._importComponentsObjects(bitIds, {\n      allHistory: this.options.allHistory,\n      lane,\n    });\n\n    // import lane components from their original scope, this way, it's possible to run diff/merge on them.\n    // don't use `scope.getDefaultLaneIdsFromLane()`. we need all components, because it's possible that a component\n    // does't have \"head\" locally although it exits in the origin-scope. it happens when the component was created on\n    // the origin-scope after a component with the same-name was created on the lane\n    if (lane) {\n      // @todo: optimize this maybe. currently, it imports twice.\n      // try to make the previous `importComponentsObjectsHarmony` import the same component once from the original\n      // scope and once from the lane-scope.\n      const mainIdsLatest = BitIds.fromArray(lane.toBitIds().map((m) => m.changeVersion(undefined)));\n      await this._importComponentsObjects(mainIdsLatest, {\n        allHistory: this.options.allHistory,\n        ignoreMissingHead: true,\n      });\n    }\n\n    // merge the lane objects\n    const mergeAllLanesResults = await pMapSeries(this.laneObjects, (laneObject) =>\n      this.scope.sources.mergeLane(laneObject, true)\n    );\n    const mergedLanes = mergeAllLanesResults.map((result) => result.mergeLane);\n    await Promise.all(mergedLanes.map((mergedLane) => this.scope.lanes.saveLane(mergedLane)));\n\n    const importDetails = await this._getImportDetails(beforeImportVersions, versionDependenciesArr);\n    return {\n      importedIds: versionDependenciesArr.map((v) => v.component.id).flat(),\n      importedDeps: versionDependenciesArr.map((v) => v.allDependenciesIds).flat(),\n      importDetails,\n    };\n  }\n\n  async importSpecificComponents(): Promise<ImportResult> {\n    logger.debug(`importSpecificComponents, Ids: ${this.options.ids.join(', ')}`);\n    const bitIds: BitIds = await this.getBitIds();\n    const beforeImportVersions = await this._getCurrentVersions(bitIds);\n    await this._throwForPotentialIssues(bitIds);\n    const versionDependenciesArr = await this._importComponentsObjects(bitIds, {\n      lane: this.laneObjects?.[0],\n    });\n    if (this.laneObjects && this.options.objectsOnly) {\n      // merge the lane objects\n      const mergeAllLanesResults = await pMapSeries(this.laneObjects, (laneObject) =>\n        this.scope.sources.mergeLane(laneObject, true)\n      );\n      const mergedLanes = mergeAllLanesResults.map((result) => result.mergeLane);\n      await Promise.all(mergedLanes.map((mergedLane) => this.scope.lanes.saveLane(mergedLane)));\n    }\n    let writtenComponents: Component[] = [];\n    if (!this.options.objectsOnly) {\n      const componentsWithDependencies = await multipleVersionDependenciesToConsumer(\n        versionDependenciesArr,\n        this.scope.objects\n      );\n      await this._fetchDivergeData(componentsWithDependencies);\n      this._throwForDivergedHistory();\n      await this._writeToFileSystem(componentsWithDependencies);\n      await this._saveLaneDataIfNeeded(componentsWithDependencies);\n      writtenComponents = componentsWithDependencies.map((c) => c.component);\n    }\n\n    const importDetails = await this._getImportDetails(beforeImportVersions, versionDependenciesArr);\n    return {\n      importedIds: versionDependenciesArr.map((v) => v.component.id).flat(),\n      importedDeps: versionDependenciesArr.map((v) => v.allDependenciesIds).flat(),\n      writtenComponents,\n      importDetails,\n    };\n  }\n\n  async _fetchDivergeData(componentsWithDependencies: ComponentWithDependencies[]) {\n    if (this.options.objectsOnly) {\n      // no need for it when importing objects only. if it's enabled, in case when on a lane and a non-lane\n      // component is in bitmap using an older version, it throws \"getDivergeData: unable to find Version X of Y\"\n      return;\n    }\n    await Promise.all(\n      componentsWithDependencies.map(async ({ component }) => {\n        const modelComponent = await this.scope.getModelComponent(component.id);\n        await modelComponent.setDivergeData(this.scope.objects, undefined, false);\n        this.divergeData.push(modelComponent);\n      })\n    );\n  }\n\n  _throwForDivergedHistory() {\n    if (this.options.merge || this.options.objectsOnly) return;\n    const divergedComponents = this.divergeData.filter((modelComponent) =>\n      modelComponent.getDivergeData().isDiverged()\n    );\n    if (divergedComponents.length) {\n      const divergeData = divergedComponents.map((modelComponent) => ({\n        id: modelComponent.id(),\n        snapsLocal: modelComponent.getDivergeData().snapsOnLocalOnly.length,\n        snapsRemote: modelComponent.getDivergeData().snapsOnRemoteOnly.length,\n      }));\n      throw new ComponentsPendingMerge(divergeData);\n    }\n  }\n\n  private async _importComponentsObjects(\n    ids: BitIds,\n    {\n      fromOriginalScope = false,\n      allHistory = false,\n      lane,\n      ignoreMissingHead = false,\n    }: {\n      fromOriginalScope?: boolean;\n      allHistory?: boolean;\n      lane?: Lane;\n      ignoreMissingHead?: boolean;\n    }\n  ): Promise<VersionDependencies[]> {\n    const scopeComponentsImporter = ScopeComponentsImporter.getInstance(this.scope);\n    await scopeComponentsImporter.importManyDeltaWithoutDeps(ids, allHistory, lane, ignoreMissingHead);\n    loader.start(`import ${ids.length} components with their dependencies (if missing)`);\n    const results = fromOriginalScope\n      ? await scopeComponentsImporter.importManyFromOriginalScopes(ids)\n      : await scopeComponentsImporter.importMany({ ids, ignoreMissingHead, lanes: lane ? [lane] : undefined });\n\n    return results;\n  }\n\n  /**\n   * consider the following use cases:\n   * 1) no ids were provided. it should import all the lanes components objects AND main components objects\n   * (otherwise, if main components are not imported and are missing, then bit-status complains about it)\n   * 2) ids are provided with wildcards. we assume the user wants only the ids that are available on the lane.\n   * because a user may entered \"bit import scope/*\" and this scope has many component on the lane and many not on the lane.\n   * we want to bring only the components on the lane.\n   * 3) ids are provided without wildcards. here, the user knows exactly what's needed and it's ok to get the ids from\n   * main if not found on the lane.\n   */\n  private async getBitIdsForLanes(): Promise<BitId[]> {\n    if (!this.options.lanes) {\n      throw new Error(`getBitIdsForLanes: this.options.lanes must be set`);\n    }\n    const bitIdsFromLane = BitIds.fromArray(this.laneObjects.flatMap((lane) => lane.toBitIds()));\n\n    if (!this.options.ids.length) {\n      const mainIds = this.consumer.bitMap.getAuthoredAndImportedBitIdsOfDefaultLane();\n      const mainIdsToImport = mainIds.filter((id) => id.hasScope() && !bitIdsFromLane.hasWithoutVersion(id));\n      bitIdsFromLane.push(...mainIdsToImport);\n      return bitIdsFromLane;\n    }\n\n    const idsWithWildcard = this.options.ids.filter((id) => hasWildcard(id));\n    const idsWithoutWildcard = this.options.ids.filter((id) => !hasWildcard(id));\n    const idsWithoutWildcardPreferFromLane = idsWithoutWildcard.map((idStr) => {\n      const id = BitId.parse(idStr, true);\n      const fromLane = bitIdsFromLane.searchWithoutVersion(id);\n      return fromLane || id;\n    });\n\n    const bitIds: BitId[] = [...idsWithoutWildcardPreferFromLane];\n\n    if (!idsWithWildcard) {\n      return bitIds;\n    }\n\n    await pMapSeries(idsWithWildcard, async (idStr: string) => {\n      const idsFromRemote = await getRemoteBitIdsByWildcards(idStr);\n      const existingOnLanes = idsFromRemote.filter((id) => bitIdsFromLane.hasWithoutVersion(id));\n      if (!existingOnLanes.length) {\n        throw new BitError(`the id with the the wildcard \"${idStr}\" has been parsed to multiple component ids.\nhowever, none of them existing on the lane \"${this.laneObjects.map((l) => l.name).join(', ')}\"\nin case you intend to import these components from main, please run the following:\nbit import ${idsFromRemote.map((id) => id.toStringWithoutVersion()).join(' ')}`);\n      }\n      bitIds.push(...existingOnLanes);\n    });\n\n    return bitIds;\n  }\n\n  private async getBitIdsForNonLanes() {\n    const bitIds: BitId[] = [];\n    await Promise.all(\n      this.options.ids.map(async (idStr: string) => {\n        if (hasWildcard(idStr)) {\n          const ids = await getRemoteBitIdsByWildcards(idStr);\n          loader.start(BEFORE_IMPORT_ACTION); // it stops the previous loader of BEFORE_REMOTE_LIST\n          bitIds.push(...ids);\n        } else {\n          bitIds.push(BitId.parse(idStr, true)); // we don't support importing without a scope name\n        }\n      })\n    );\n\n    return bitIds;\n  }\n\n  private async getBitIds(): Promise<BitIds> {\n    const bitIds: BitId[] = this.options.lanes ? await this.getBitIdsForLanes() : await this.getBitIdsForNonLanes();\n    if (this.options.importDependenciesDirectly || this.options.importDependents) {\n      const graphs = await this._getComponentsGraphs(bitIds);\n      if (this.options.importDependenciesDirectly) {\n        const dependenciesIds = this._getDependenciesFromGraph(bitIds, graphs);\n        bitIds.push(...dependenciesIds);\n      }\n      if (this.options.importDependents) {\n        const graph = await this.graph.getGraph();\n        const targetCompIds = await this.workspace.resolveMultipleComponentIds(bitIds);\n        const sourceIds = await this.workspace.listIds();\n        const ids = graph.findIdsFromSourcesToTargets(sourceIds, targetCompIds);\n        logger.debug(\n          `found ${ids.length} component for --dependents flag`,\n          ids.map((id) => id.toString())\n        );\n        bitIds.push(...ids.map((id) => id._legacy));\n      }\n    }\n    return BitIds.uniqFromArray(bitIds);\n  }\n\n  _getDependenciesFromGraph(bitIds: BitId[], graphs: DependencyGraph[]): BitId[] {\n    const dependencies = bitIds.map((bitId) => {\n      const componentGraph = graphs.find((graph) => graph.scopeName === bitId.scope);\n      if (!componentGraph) {\n        throw new Error(`unable to find a graph for ${bitId.toString()}`);\n      }\n      const dependenciesInfo = componentGraph.getDependenciesInfo(bitId);\n      return dependenciesInfo.map((d) => d.id);\n    });\n    return R.flatten(dependencies);\n  }\n\n  _getDependentsFromGraph(bitIds: BitId[], graphs: DependencyGraph[]): BitId[] {\n    const dependents = bitIds.map((bitId) => {\n      const componentGraph = graphs.find((graph) => graph.scopeName === bitId.scope);\n      if (!componentGraph) {\n        throw new Error(`unable to find a graph for ${bitId.toString()}`);\n      }\n      const dependentsInfo = componentGraph.getDependentsInfo(bitId);\n      return dependentsInfo.map((d) => d.id);\n    });\n    return R.flatten(dependents);\n  }\n\n  async _getComponentsGraphs(bitIds: BitId[]): Promise<DependencyGraph[]> {\n    const remotes: Remotes = await getScopeRemotes(this.consumer.scope);\n    return remotes.scopeGraphs(bitIds, this.consumer.scope);\n  }\n\n  async importAccordingToBitMap(): Promise<ImportResult> {\n    this.options.objectsOnly = !this.options.merge && !this.options.override;\n    const componentsIdsToImport = this.getIdsToImportFromBitmap();\n\n    if (R.isEmpty(componentsIdsToImport)) {\n      throw new NothingToImport();\n    }\n    await this._throwForModifiedOrNewComponents(componentsIdsToImport);\n    const beforeImportVersions = await this._getCurrentVersions(componentsIdsToImport);\n    if (!componentsIdsToImport.length) {\n      return {\n        importedIds: [],\n        importedDeps: [],\n        importDetails: [],\n      };\n    }\n    if (!this.options.objectsOnly) {\n      throw new Error(`bit import with no ids and --merge flag was not implemented yet`);\n    }\n    const versionDependenciesArr = await this._importComponentsObjects(componentsIdsToImport, {\n      fromOriginalScope: this.options.fromOriginalScope,\n      allHistory: this.options.allHistory,\n    });\n    let writtenComponents: Component[] = [];\n    if (!this.options.objectsOnly) {\n      const componentWithDependencies = await multipleVersionDependenciesToConsumer(\n        versionDependenciesArr,\n        this.scope.objects\n      );\n      await this._writeToFileSystem(componentWithDependencies);\n      writtenComponents = componentWithDependencies.map((c) => c.component);\n    }\n\n    const importDetails = await this._getImportDetails(beforeImportVersions, versionDependenciesArr);\n\n    return {\n      importedIds: versionDependenciesArr.map((v) => v.component.id).flat(),\n      importedDeps: versionDependenciesArr.map((v) => v.allDependenciesIds).flat(),\n      writtenComponents,\n      importDetails,\n    };\n  }\n\n  private getIdsToImportFromBitmap() {\n    const authoredExportedComponents = this.consumer.bitMap.getExportedComponents();\n    return BitIds.fromArray(authoredExportedComponents);\n  }\n\n  async _getCurrentVersions(ids: BitIds): Promise<ImportedVersions> {\n    const versionsP = ids.map(async (id) => {\n      const modelComponent = await this.consumer.scope.getModelComponentIfExist(id.changeVersion(undefined));\n      const idStr = id.toStringWithoutVersion();\n      if (!modelComponent) return [idStr, []];\n      return [idStr, modelComponent.listVersions()];\n    });\n    const versions = await Promise.all(versionsP);\n    return R.fromPairs(versions);\n  }\n\n  /**\n   * get import details, includes the diff between the versions array before import and after import\n   */\n  async _getImportDetails(\n    currentVersions: ImportedVersions,\n    components: VersionDependencies[]\n  ): Promise<ImportDetails[]> {\n    const detailsP = components.map(async (component) => {\n      const id = component.component.id;\n      const idStr = id.toStringWithoutVersion();\n      const beforeImportVersions = currentVersions[idStr];\n      if (!beforeImportVersions) {\n        throw new Error(\n          `_getImportDetails failed finding ${idStr} in currentVersions, which has ${Object.keys(currentVersions).join(\n            ', '\n          )}`\n        );\n      }\n      const modelComponent = await this.consumer.scope.getModelComponentIfExist(id);\n      if (!modelComponent) throw new ShowDoctorError(`imported component ${idStr} was not found in the model`);\n      const afterImportVersions = modelComponent.listVersions();\n      const versionDifference: string[] = R.difference(afterImportVersions, beforeImportVersions);\n      const getStatus = (): ImportStatus => {\n        if (!versionDifference.length) return 'up to date';\n        if (!beforeImportVersions.length) return 'added';\n        return 'updated';\n      };\n      const filesStatus = this.mergeStatus && this.mergeStatus[idStr] ? this.mergeStatus[idStr] : null;\n      const deprecated = await modelComponent.isDeprecated(this.scope.objects);\n      const removed = await component.component.component.isRemoved(this.scope.objects);\n      const latestVersion = modelComponent.latest();\n      return {\n        id: idStr,\n        versions: versionDifference,\n        latestVersion: versionDifference.includes(latestVersion) ? latestVersion : null,\n        status: getStatus(),\n        filesStatus,\n        missingDeps: component.getMissingDependencies(),\n        deprecated,\n        removed,\n      };\n    });\n    return Promise.all(detailsP);\n  }\n\n  async _throwForPotentialIssues(ids: BitIds): Promise<void> {\n    await this._throwForModifiedOrNewComponents(ids);\n    this._throwForDifferentComponentWithSameName(ids);\n  }\n\n  async _throwForModifiedOrNewComponents(ids: BitIds): Promise<void> {\n    // the typical objectsOnly option is when a user cloned a project with components tagged to the source code, but\n    // doesn't have the model objects. in that case, calling getComponentStatusById() may return an error as it relies\n    // on the model objects when there are dependencies\n    if (this.options.override || this.options.objectsOnly || this.options.merge) return;\n    const componentsStatuses = await this.consumer.getManyComponentsStatuses(ids);\n    const modifiedComponents = componentsStatuses\n      .filter(({ status }) => status.modified || status.newlyCreated)\n      .map((c) => c.id);\n    if (modifiedComponents.length) {\n      throw new GeneralError(\n        chalk.yellow(\n          `unable to import the following components due to local changes, use --merge flag to merge your local changes or --override to override them\\n${modifiedComponents.join(\n            '\\n'\n          )} `\n        )\n      );\n    }\n  }\n\n  /**\n   * Model Component id() calculation uses id.toString() for the hash.\n   * If an imported component has scopereadonly name equals to a local name, both will have the exact same\n   * hash and they'll override each other.\n   */\n  _throwForDifferentComponentWithSameName(ids: BitIds): void {\n    ids.forEach((id: BitId) => {\n      const existingId = this.consumer.getParsedIdIfExist(id.toStringWithoutVersion());\n      if (existingId && !existingId.hasScope()) {\n        throw new GeneralError(`unable to import ${id.toString()}. the component name conflicted with your local component with the same name.\n        it's fine to have components with the same name as long as their scope names are different.\n        Make sure to export your component first to get a scope and then try importing again`);\n      }\n    });\n  }\n\n  async _getMergeStatus(componentWithDependencies: ComponentWithDependencies): Promise<ComponentMergeStatus> {\n    const component = componentWithDependencies.component;\n    const componentStatus = await this.consumer.getComponentStatusById(component.id);\n    const mergeStatus: ComponentMergeStatus = { componentWithDependencies, mergeResults: null };\n    if (!componentStatus.modified) return mergeStatus;\n    const componentModel = await this.consumer.scope.getModelComponent(component.id);\n    const existingBitMapBitId = this.consumer.bitMap.getBitId(component.id, { ignoreVersion: true });\n    const fsComponent = await this.consumer.loadComponent(existingBitMapBitId);\n    const currentlyUsedVersion = existingBitMapBitId.version;\n    // @ts-ignore AUTO-ADDED-AFTER-MIGRATION-PLEASE-FIX!\n    const baseComponent: Version = await componentModel.loadVersion(currentlyUsedVersion, this.consumer.scope.objects);\n    const otherComponent: Version = await componentModel.loadVersion(\n      // @ts-ignore AUTO-ADDED-AFTER-MIGRATION-PLEASE-FIX!\n      component.id.version,\n      this.consumer.scope.objects\n    );\n    const mergeResults = await threeWayMerge({\n      consumer: this.consumer,\n      otherComponent,\n      otherLabel: component.id.version as string,\n      currentComponent: fsComponent,\n      currentLabel: `${currentlyUsedVersion} modified`,\n      baseComponent,\n    });\n    mergeStatus.mergeResults = mergeResults;\n    return mergeStatus;\n  }\n\n  /**\n   * 1) when there are conflicts and the strategy is \"ours\", don't write the imported component to\n   * the filesystem, only update bitmap.\n   *\n   * 2) when there are conflicts and the strategy is \"theirs\", override the local changes by the\n   * imported component. (similar to --override)\n   *\n   * 3) when there is no conflict or there are conflicts and the strategy is manual, write the files\n   * according to the merge result. (done by applyModifiedVersion())\n   */\n  _updateComponentFilesPerMergeStrategy(componentMergeStatus: ComponentMergeStatus): FilesStatus | null | undefined {\n    const mergeResults = componentMergeStatus.mergeResults;\n    if (!mergeResults) return null;\n    const component = componentMergeStatus.componentWithDependencies.component;\n    const files = component.files;\n\n    if (mergeResults.hasConflicts && this.options.mergeStrategy === MergeOptions.ours) {\n      const filesStatus = {};\n      // don't write the files to the filesystem, only bump the bitmap version.\n      files.forEach((file) => {\n        // @ts-ignore AUTO-ADDED-AFTER-MIGRATION-PLEASE-FIX!\n        filesStatus[pathNormalizeToLinux(file.relative)] = FileStatus.unchanged;\n      });\n      this.consumer.bitMap.updateComponentId(component.id);\n      this.consumer.bitMap.hasChanged = true;\n      return filesStatus;\n    }\n    if (mergeResults.hasConflicts && this.options.mergeStrategy === MergeOptions.theirs) {\n      const filesStatus = {};\n      // the local changes will be overridden (as if the user entered --override flag for this component)\n      files.forEach((file) => {\n        // @ts-ignore AUTO-ADDED-AFTER-MIGRATION-PLEASE-FIX!\n        filesStatus[pathNormalizeToLinux(file.relative)] = FileStatus.updated;\n      });\n      return filesStatus;\n    }\n    const { filesStatus, modifiedFiles } = applyModifiedVersion(\n      component.files,\n      mergeResults,\n      this.options.mergeStrategy\n    );\n    component.files = modifiedFiles;\n\n    return filesStatus;\n  }\n\n  /**\n   * update the component files if they are modified and there is a merge strategy.\n   * returns only the components that need to be written to the filesystem\n   */\n  async updateAllComponentsAccordingToMergeStrategy(\n    componentsWithDependencies: ComponentWithDependencies[]\n  ): Promise<ComponentWithDependencies[]> {\n    if (!this.options.merge) return componentsWithDependencies;\n    const componentsStatusP = componentsWithDependencies.map((componentWithDependencies: ComponentWithDependencies) => {\n      return this._getMergeStatus(componentWithDependencies);\n    });\n    const componentsStatus = await Promise.all(componentsStatusP);\n    const componentWithConflict = componentsStatus.find(\n      (component) => component.mergeResults && component.mergeResults.hasConflicts\n    );\n    if (componentWithConflict && !this.options.mergeStrategy) {\n      this.options.mergeStrategy = await getMergeStrategyInteractive();\n    }\n    this.mergeStatus = {};\n\n    const componentsToWrite = componentsStatus.map((componentStatus) => {\n      const filesStatus: FilesStatus | null | undefined = this._updateComponentFilesPerMergeStrategy(componentStatus);\n      const componentWithDependencies = componentStatus.componentWithDependencies;\n      if (!filesStatus) return componentWithDependencies;\n      this.mergeStatus[componentWithDependencies.component.id.toStringWithoutVersion()] = filesStatus;\n      const unchangedFiles = Object.keys(filesStatus).filter((file) => filesStatus[file] === FileStatus.unchanged);\n      if (unchangedFiles.length === Object.keys(filesStatus).length) {\n        // all files are unchanged\n        return null;\n      }\n      return componentWithDependencies;\n    });\n    const removeNulls = R.reject(R.isNil);\n    return removeNulls(componentsToWrite);\n  }\n\n  _shouldSaveLaneData(): boolean {\n    if (this.options.objectsOnly) {\n      return false;\n    }\n    return this.consumer.isOnLane();\n  }\n\n  async _saveLaneDataIfNeeded(componentsWithDependencies: ComponentWithDependencies[]): Promise<void> {\n    if (!this._shouldSaveLaneData()) {\n      return;\n    }\n    const currentLane = await this.consumer.getCurrentLaneObject();\n    if (!currentLane) {\n      return; // user on main\n    }\n    const idsFromRemoteLanes = BitIds.fromArray(this.laneObjects.flatMap((lane) => lane.toBitIds()));\n    const components = componentsWithDependencies.map((c) => c.component);\n    await Promise.all(\n      components.map(async (comp) => {\n        const existOnRemoteLane = idsFromRemoteLanes.has(comp.id);\n        if (!existOnRemoteLane && !this.options.saveInLane) {\n          this.consumer.bitMap.setComponentProp(comp.id, 'onLanesOnly', false);\n          return;\n        }\n        const modelComponent = await this.scope.getModelComponent(comp.id);\n        const ref = modelComponent.getRef(comp.id.version as string);\n        if (!ref) throw new Error(`_saveLaneDataIfNeeded unable to get ref for ${comp.id.toString()}`);\n        currentLane.addComponent({ id: comp.id, head: ref });\n      })\n    );\n    await this.scope.lanes.saveLane(currentLane);\n  }\n\n  async _writeToFileSystem(componentsWithDependencies: ComponentWithDependencies[]) {\n    if (this.options.objectsOnly) {\n      return;\n    }\n    const componentsToWrite = await this.updateAllComponentsAccordingToMergeStrategy(componentsWithDependencies);\n    const manyComponentsWriter = new ManyComponentsWriter({\n      consumer: this.consumer,\n      componentsWithDependencies: componentsToWrite,\n      writeToPath: this.options.writeToPath,\n      writeConfig: this.options.writeConfig,\n      installNpmPackages: this.options.installNpmPackages,\n      verbose: this.options.verbose,\n      override: this.options.override,\n    });\n    await manyComponentsWriter.writeAll();\n  }\n}\n"],"mappings":"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"}