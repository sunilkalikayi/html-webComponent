{"version":3,"names":["_bvmConfig","getAspectDirFromPath","id","pathsToResolveAspects","aspectName","getCoreAspectName","packageName","getCoreAspectPackageName","moduleDirectory","length","require","resolve","paths","dirPath","join","existsSync","Error","getAspectDir","err","__dirname","getAspectDirFromBvm","bvmDirOptions","Config","load","bvmConfig","version","link","linkName","getDefaultLinkName","links","getLinks","BitError","versionDir","exists","getSpecificVersionDir","getAspectDistDir","name","split","getAspectDef","runtime","files","readdir","runtimeFile","find","file","includes","aspectPath","runtimePath"],"sources":["core-aspects.ts"],"sourcesContent":["import { BitError } from '@teambit/bit-error';\nimport { existsSync, readdir } from 'fs-extra';\nimport { join, resolve } from 'path';\nimport { Config } from '@teambit/bvm.config';\n\nlet _bvmConfig;\n\nfunction getAspectDirFromPath(id: string, pathsToResolveAspects?: string[]): string {\n  const aspectName = getCoreAspectName(id);\n  const packageName = getCoreAspectPackageName(id);\n\n  let moduleDirectory;\n  if (pathsToResolveAspects && pathsToResolveAspects.length) {\n    moduleDirectory = require.resolve(packageName, { paths: pathsToResolveAspects });\n  } else {\n    moduleDirectory = require.resolve(packageName);\n  }\n  const dirPath = join(moduleDirectory, '../..'); // to remove the \"index.js\" at the end\n  if (!existsSync(dirPath)) {\n    throw new Error(`unable to find ${aspectName} in ${dirPath}`);\n  }\n  return dirPath;\n}\n\nexport function getAspectDir(id: string): string {\n  const aspectName = getCoreAspectName(id);\n  let dirPath;\n\n  try {\n    dirPath = getAspectDirFromPath(id);\n  } catch (err: any) {\n    dirPath = resolve(__dirname, '../..', aspectName, 'dist');\n  }\n  if (!existsSync(dirPath)) {\n    throw new Error(`unable to find ${aspectName} in ${dirPath}`);\n  }\n  return dirPath;\n}\n\ntype BvmDirOptions = {\n  version?: string;\n  linkName?: string;\n};\nexport function getAspectDirFromBvm(id: string, bvmDirOptions?: BvmDirOptions): string {\n  if (!_bvmConfig) {\n    _bvmConfig = Config.load(false, ['env', 'file']);\n  }\n  const bvmConfig = _bvmConfig;\n  let version;\n  if (bvmDirOptions?.version) {\n    version = bvmDirOptions?.version;\n  } else {\n    const link = bvmDirOptions?.linkName || bvmConfig.getDefaultLinkName();\n    const links = bvmConfig.getLinks();\n    version = links[link];\n    if (!version) {\n      throw new BitError(`can't find link named ${bvmDirOptions?.linkName} in bvm config`);\n    }\n  }\n  const { versionDir, exists } = bvmConfig.getSpecificVersionDir(version, true);\n  if (!exists) {\n    throw new BitError(`can't find version ${version} in bvm folder`);\n  }\n  return getAspectDirFromPath(id, [versionDir]);\n}\n\nexport function getAspectDistDir(id: string) {\n  return resolve(`${getAspectDir(id)}/dist`);\n}\n\nexport function getCoreAspectName(id: string): string {\n  const [, ...name] = id.split('/');\n  const aspectName = name.join('.');\n  return aspectName;\n}\n\nexport function getCoreAspectPackageName(id: string): string {\n  const aspectName = getCoreAspectName(id);\n  return `@teambit/${aspectName}`;\n}\n\nexport async function getAspectDef(aspectName: string, runtime?: string) {\n  const dirPath = getAspectDistDir(aspectName);\n\n  const files = await readdir(dirPath);\n  let runtimeFile;\n  if (runtime) {\n    runtimeFile = files.find((file) => file.includes(`.${runtime}.runtime.js`)) || null;\n  }\n\n  return {\n    id: aspectName,\n    aspectPath: join(dirPath, '..'),\n    runtimePath: runtimeFile ? resolve(`${dirPath}/${runtimeFile}`) : null,\n  };\n}\n"],"mappings":"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"}