{"version":3,"names":["jsDocToDocSchema","node","context","canHaveJsDoc","undefined","jsDocs","getJsDoc","length","jsDoc","location","getLocation","comment","getTextOfJSDocComment","tags","pMapSeries","tag","tagParser","DocSchema","getText","kind","SyntaxKind","JSDocReturnTag","returnTag","JSDocPropertyTag","propertyLikeTag","JSDocParameterTag","JSDocAugmentsTag","simpleTag","TagName","augments","JSDocAuthorTag","author","JSDocClassTag","class","JSDocCallbackTag","callback","JSDocPublicTag","public","JSDocPrivateTag","private","JSDocProtectedTag","protected","JSDocReadonlyTag","readonly","JSDocOverrideTag","override","JSDocDeprecatedTag","deprecated","JSDocSeeTag","see","JSDocEnumTag","enum","JSDocThisTag","this","JSDocTypeTag","type","JSDocTemplateTag","template","JSDocTypedefTag","typedef","JSDocImplementsTag","implements","tagName","getSourceFile","TagSchema","typeExpression","typeNodeToSchema","ReturnTagSchema","PropertyLikeTagSchema","name"],"sources":["jsdoc-to-doc-schema.ts"],"sourcesContent":["/* eslint-disable no-fallthrough */\nimport {\n  getTextOfJSDocComment,\n  JSDocParameterTag,\n  JSDocPropertyLikeTag,\n  JSDocPropertyTag,\n  JSDocReturnTag,\n  JSDocTag,\n  Node,\n  SyntaxKind,\n} from 'typescript';\nimport { getJsDoc, canHaveJsDoc } from 'tsutils';\nimport pMapSeries from 'p-map-series';\nimport {\n  DocSchema,\n  PropertyLikeTagSchema,\n  ReturnTagSchema,\n  TagName,\n  TagSchema,\n} from '@teambit/semantics.entities.semantic-schema';\nimport { SchemaExtractorContext } from '../../schema-extractor-context';\nimport { typeNodeToSchema } from './type-node-to-schema';\n\nexport async function jsDocToDocSchema(node: Node, context: SchemaExtractorContext): Promise<DocSchema | undefined> {\n  if (!canHaveJsDoc(node)) {\n    return undefined;\n  }\n  const jsDocs = getJsDoc(node);\n  if (!jsDocs.length) {\n    return undefined;\n  }\n  // not sure how common it is to have multiple JSDocs. never seen it before.\n  // regardless, in typescript implementation of methods like `getJSDocDeprecatedTag()`, they use the first one. (`getFirstJSDocTag()`)\n  const jsDoc = jsDocs[0];\n  const location = context.getLocation(jsDoc);\n  const comment = getTextOfJSDocComment(jsDoc.comment);\n  const tags = jsDoc.tags ? await pMapSeries(jsDoc.tags, (tag) => tagParser(tag, context)) : undefined;\n  return new DocSchema(location, jsDoc.getText(), comment, tags);\n}\n\nasync function tagParser(tag: JSDocTag, context: SchemaExtractorContext): Promise<TagSchema> {\n  // for some reason, in some cases, if `tag.getSourceFile()` is not provided to the `getText()`, it throws \"Cannot read property 'text' of undefined\"\n\n  switch (tag.kind) {\n    case SyntaxKind.JSDocReturnTag:\n      return returnTag(tag as JSDocReturnTag, context);\n    case SyntaxKind.JSDocPropertyTag:\n      return propertyLikeTag(tag as JSDocPropertyTag, context);\n    case SyntaxKind.JSDocParameterTag:\n      return propertyLikeTag(tag as JSDocParameterTag, context);\n    case SyntaxKind.JSDocAugmentsTag:\n      return simpleTag(tag, TagName.augments, context);\n    case SyntaxKind.JSDocAuthorTag:\n      return simpleTag(tag, TagName.author, context);\n    case SyntaxKind.JSDocClassTag:\n      return simpleTag(tag, TagName.class, context);\n    case SyntaxKind.JSDocCallbackTag:\n      return simpleTag(tag, TagName.callback, context);\n    case SyntaxKind.JSDocPublicTag:\n      return simpleTag(tag, TagName.public, context);\n    case SyntaxKind.JSDocPrivateTag:\n      return simpleTag(tag, TagName.private, context);\n    case SyntaxKind.JSDocProtectedTag:\n      return simpleTag(tag, TagName.protected, context);\n    case SyntaxKind.JSDocReadonlyTag:\n      return simpleTag(tag, TagName.readonly, context);\n    case SyntaxKind.JSDocOverrideTag:\n      return simpleTag(tag, TagName.override, context);\n    case SyntaxKind.JSDocDeprecatedTag:\n      return simpleTag(tag, TagName.deprecated, context);\n    case SyntaxKind.JSDocSeeTag:\n      return simpleTag(tag, TagName.see, context);\n    case SyntaxKind.JSDocEnumTag:\n      return simpleTag(tag, TagName.enum, context);\n    case SyntaxKind.JSDocThisTag:\n      return simpleTag(tag, TagName.this, context);\n    case SyntaxKind.JSDocTypeTag:\n      return simpleTag(tag, TagName.type, context);\n    case SyntaxKind.JSDocTemplateTag:\n      return simpleTag(tag, TagName.template, context);\n    case SyntaxKind.JSDocTypedefTag:\n      return simpleTag(tag, TagName.typedef, context);\n    case SyntaxKind.JSDocImplementsTag:\n      return simpleTag(tag, TagName.implements, context);\n    default: {\n      const tagName: TagName | string = tag.tagName.getText(tag.getSourceFile());\n      return simpleTag(tag, tagName, context);\n    }\n  }\n}\n\nfunction simpleTag(tag: JSDocTag, tagName: TagName | string, context: SchemaExtractorContext): TagSchema {\n  return new TagSchema(context.getLocation(tag), tagName, getTextOfJSDocComment(tag.comment));\n}\n\nasync function returnTag(tag: JSDocReturnTag, context: SchemaExtractorContext) {\n  const type = tag.typeExpression?.type ? await typeNodeToSchema(tag.typeExpression?.type, context) : undefined;\n  return new ReturnTagSchema(context.getLocation(tag), getTextOfJSDocComment(tag.comment), type);\n}\n\nasync function propertyLikeTag(tag: JSDocPropertyLikeTag, context: SchemaExtractorContext) {\n  const type = tag.typeExpression?.type ? await typeNodeToSchema(tag.typeExpression?.type, context) : undefined;\n  return new PropertyLikeTagSchema(\n    context.getLocation(tag),\n    tag.name.getText(),\n    getTextOfJSDocComment(tag.comment),\n    type\n  );\n}\n"],"mappings":";;;;;;;;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAUA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAQA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AArBA;;AAuBO,eAAeA,gBAAgB,CAACC,IAAU,EAAEC,OAA+B,EAAkC;EAClH,IAAI,CAAC,IAAAC,uBAAY,EAACF,IAAI,CAAC,EAAE;IACvB,OAAOG,SAAS;EAClB;EACA,MAAMC,MAAM,GAAG,IAAAC,mBAAQ,EAACL,IAAI,CAAC;EAC7B,IAAI,CAACI,MAAM,CAACE,MAAM,EAAE;IAClB,OAAOH,SAAS;EAClB;EACA;EACA;EACA,MAAMI,KAAK,GAAGH,MAAM,CAAC,CAAC,CAAC;EACvB,MAAMI,QAAQ,GAAGP,OAAO,CAACQ,WAAW,CAACF,KAAK,CAAC;EAC3C,MAAMG,OAAO,GAAG,IAAAC,mCAAqB,EAACJ,KAAK,CAACG,OAAO,CAAC;EACpD,MAAME,IAAI,GAAGL,KAAK,CAACK,IAAI,GAAG,MAAM,IAAAC,qBAAU,EAACN,KAAK,CAACK,IAAI,EAAGE,GAAG,IAAKC,SAAS,CAACD,GAAG,EAAEb,OAAO,CAAC,CAAC,GAAGE,SAAS;EACpG,OAAO,KAAIa,8BAAS,EAACR,QAAQ,EAAED,KAAK,CAACU,OAAO,EAAE,EAAEP,OAAO,EAAEE,IAAI,CAAC;AAChE;AAEA,eAAeG,SAAS,CAACD,GAAa,EAAEb,OAA+B,EAAsB;EAC3F;;EAEA,QAAQa,GAAG,CAACI,IAAI;IACd,KAAKC,wBAAU,CAACC,cAAc;MAC5B,OAAOC,SAAS,CAACP,GAAG,EAAoBb,OAAO,CAAC;IAClD,KAAKkB,wBAAU,CAACG,gBAAgB;MAC9B,OAAOC,eAAe,CAACT,GAAG,EAAsBb,OAAO,CAAC;IAC1D,KAAKkB,wBAAU,CAACK,iBAAiB;MAC/B,OAAOD,eAAe,CAACT,GAAG,EAAuBb,OAAO,CAAC;IAC3D,KAAKkB,wBAAU,CAACM,gBAAgB;MAC9B,OAAOC,SAAS,CAACZ,GAAG,EAAEa,4BAAO,CAACC,QAAQ,EAAE3B,OAAO,CAAC;IAClD,KAAKkB,wBAAU,CAACU,cAAc;MAC5B,OAAOH,SAAS,CAACZ,GAAG,EAAEa,4BAAO,CAACG,MAAM,EAAE7B,OAAO,CAAC;IAChD,KAAKkB,wBAAU,CAACY,aAAa;MAC3B,OAAOL,SAAS,CAACZ,GAAG,EAAEa,4BAAO,CAACK,KAAK,EAAE/B,OAAO,CAAC;IAC/C,KAAKkB,wBAAU,CAACc,gBAAgB;MAC9B,OAAOP,SAAS,CAACZ,GAAG,EAAEa,4BAAO,CAACO,QAAQ,EAAEjC,OAAO,CAAC;IAClD,KAAKkB,wBAAU,CAACgB,cAAc;MAC5B,OAAOT,SAAS,CAACZ,GAAG,EAAEa,4BAAO,CAACS,MAAM,EAAEnC,OAAO,CAAC;IAChD,KAAKkB,wBAAU,CAACkB,eAAe;MAC7B,OAAOX,SAAS,CAACZ,GAAG,EAAEa,4BAAO,CAACW,OAAO,EAAErC,OAAO,CAAC;IACjD,KAAKkB,wBAAU,CAACoB,iBAAiB;MAC/B,OAAOb,SAAS,CAACZ,GAAG,EAAEa,4BAAO,CAACa,SAAS,EAAEvC,OAAO,CAAC;IACnD,KAAKkB,wBAAU,CAACsB,gBAAgB;MAC9B,OAAOf,SAAS,CAACZ,GAAG,EAAEa,4BAAO,CAACe,QAAQ,EAAEzC,OAAO,CAAC;IAClD,KAAKkB,wBAAU,CAACwB,gBAAgB;MAC9B,OAAOjB,SAAS,CAACZ,GAAG,EAAEa,4BAAO,CAACiB,QAAQ,EAAE3C,OAAO,CAAC;IAClD,KAAKkB,wBAAU,CAAC0B,kBAAkB;MAChC,OAAOnB,SAAS,CAACZ,GAAG,EAAEa,4BAAO,CAACmB,UAAU,EAAE7C,OAAO,CAAC;IACpD,KAAKkB,wBAAU,CAAC4B,WAAW;MACzB,OAAOrB,SAAS,CAACZ,GAAG,EAAEa,4BAAO,CAACqB,GAAG,EAAE/C,OAAO,CAAC;IAC7C,KAAKkB,wBAAU,CAAC8B,YAAY;MAC1B,OAAOvB,SAAS,CAACZ,GAAG,EAAEa,4BAAO,CAACuB,IAAI,EAAEjD,OAAO,CAAC;IAC9C,KAAKkB,wBAAU,CAACgC,YAAY;MAC1B,OAAOzB,SAAS,CAACZ,GAAG,EAAEa,4BAAO,CAACyB,IAAI,EAAEnD,OAAO,CAAC;IAC9C,KAAKkB,wBAAU,CAACkC,YAAY;MAC1B,OAAO3B,SAAS,CAACZ,GAAG,EAAEa,4BAAO,CAAC2B,IAAI,EAAErD,OAAO,CAAC;IAC9C,KAAKkB,wBAAU,CAACoC,gBAAgB;MAC9B,OAAO7B,SAAS,CAACZ,GAAG,EAAEa,4BAAO,CAAC6B,QAAQ,EAAEvD,OAAO,CAAC;IAClD,KAAKkB,wBAAU,CAACsC,eAAe;MAC7B,OAAO/B,SAAS,CAACZ,GAAG,EAAEa,4BAAO,CAAC+B,OAAO,EAAEzD,OAAO,CAAC;IACjD,KAAKkB,wBAAU,CAACwC,kBAAkB;MAChC,OAAOjC,SAAS,CAACZ,GAAG,EAAEa,4BAAO,CAACiC,UAAU,EAAE3D,OAAO,CAAC;IACpD;MAAS;QACP,MAAM4D,OAAyB,GAAG/C,GAAG,CAAC+C,OAAO,CAAC5C,OAAO,CAACH,GAAG,CAACgD,aAAa,EAAE,CAAC;QAC1E,OAAOpC,SAAS,CAACZ,GAAG,EAAE+C,OAAO,EAAE5D,OAAO,CAAC;MACzC;EAAC;AAEL;AAEA,SAASyB,SAAS,CAACZ,GAAa,EAAE+C,OAAyB,EAAE5D,OAA+B,EAAa;EACvG,OAAO,KAAI8D,8BAAS,EAAC9D,OAAO,CAACQ,WAAW,CAACK,GAAG,CAAC,EAAE+C,OAAO,EAAE,IAAAlD,mCAAqB,EAACG,GAAG,CAACJ,OAAO,CAAC,CAAC;AAC7F;AAEA,eAAeW,SAAS,CAACP,GAAmB,EAAEb,OAA+B,EAAE;EAAA;EAC7E,MAAMqD,IAAI,GAAG,uBAAAxC,GAAG,CAACkD,cAAc,gDAAlB,oBAAoBV,IAAI,GAAG,MAAM,IAAAW,oCAAgB,0BAACnD,GAAG,CAACkD,cAAc,yDAAlB,qBAAoBV,IAAI,EAAErD,OAAO,CAAC,GAAGE,SAAS;EAC7G,OAAO,KAAI+D,oCAAe,EAACjE,OAAO,CAACQ,WAAW,CAACK,GAAG,CAAC,EAAE,IAAAH,mCAAqB,EAACG,GAAG,CAACJ,OAAO,CAAC,EAAE4C,IAAI,CAAC;AAChG;AAEA,eAAe/B,eAAe,CAACT,GAAyB,EAAEb,OAA+B,EAAE;EAAA;EACzF,MAAMqD,IAAI,GAAG,wBAAAxC,GAAG,CAACkD,cAAc,iDAAlB,qBAAoBV,IAAI,GAAG,MAAM,IAAAW,oCAAgB,0BAACnD,GAAG,CAACkD,cAAc,yDAAlB,qBAAoBV,IAAI,EAAErD,OAAO,CAAC,GAAGE,SAAS;EAC7G,OAAO,KAAIgE,0CAAqB,EAC9BlE,OAAO,CAACQ,WAAW,CAACK,GAAG,CAAC,EACxBA,GAAG,CAACsD,IAAI,CAACnD,OAAO,EAAE,EAClB,IAAAN,mCAAqB,EAACG,GAAG,CAACJ,OAAO,CAAC,EAClC4C,IAAI,CACL;AACH"}