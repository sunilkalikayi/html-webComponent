{"version":3,"names":["Scope","routeSlot","menuSlot","sidebar","scopeUi","badgeSlot","overviewLineSlot","cornerSlot","PaneWrapper","context","paneClassName","TargetScopeOverview","TargetCorner","onSidebarTogglerChange","userUseScopeQuery","scopeClassName","scope","useScopeQuery","isMobile","useIsMobile","isSidebarOpen","handleSidebarToggle","useReducer","x","sidebarOpenness","Layout","row","right","CornerOverride","values","setComponents","components","Context","map","ctx","classNames","styles","topbar","name","whiteCorner","main","splitter","e","stopPropagation","pane","PaneContainer","children","Wrapper"],"sources":["scope.tsx"],"sourcesContent":["import React, { useReducer, ComponentType, ReactNode } from 'react';\nimport 'reset-css';\nimport classNames from 'classnames';\nimport { SplitPane, Pane, Layout } from '@teambit/base-ui.surfaces.split-pane.split-pane';\nimport { RouteSlot, SlotRouter } from '@teambit/ui-foundation.ui.react-router.slot-router';\nimport { Corner } from '@teambit/ui-foundation.ui.corner';\nimport { Collapser } from '@teambit/ui-foundation.ui.buttons.collapser';\nimport { HoverSplitter } from '@teambit/base-ui.surfaces.split-pane.hover-splitter';\nimport { TopBar } from '@teambit/ui-foundation.ui.top-bar';\nimport { Composer, ComponentTuple } from '@teambit/base-ui.utils.composer';\nimport { FullLoader } from '@teambit/ui-foundation.ui.full-loader';\nimport { Route } from 'react-router-dom';\nimport { useIsMobile } from '@teambit/ui-foundation.ui.hooks.use-is-mobile';\nimport { ScopeProvider } from '@teambit/scope.ui.hooks.scope-context';\nimport { useScopeQuery } from '@teambit/scope.ui.hooks.use-scope';\nimport { ScopeOverview } from './scope-overview';\nimport styles from './scope.module.scss';\nimport ScopeUI, { ScopeBadgeSlot, ScopeContextType, CornerSlot, OverviewLineSlot } from '../scope.ui.runtime';\nimport { ScopeModel } from '..';\n\nexport type ScopeProps = {\n  routeSlot: RouteSlot;\n  menuSlot: RouteSlot;\n  sidebar: JSX.Element;\n  scopeUi: ScopeUI;\n  badgeSlot: ScopeBadgeSlot;\n  overviewLineSlot: OverviewLineSlot;\n  cornerSlot: CornerSlot;\n  context: ScopeContextType[];\n  TargetScopeOverview?: ComponentType;\n  userUseScopeQuery?: () => { scope: ScopeModel | undefined };\n  onSidebarTogglerChange: (callback: () => void) => void;\n  TargetCorner?: ComponentType;\n  paneClassName?: string;\n  scopeClassName?: string;\n  PaneWrapper?: ComponentType<{ children: ReactNode }>;\n};\n\n/**\n * root component of the scope\n */\nexport function Scope({\n  routeSlot,\n  menuSlot,\n  sidebar,\n  scopeUi,\n  badgeSlot,\n  overviewLineSlot,\n  cornerSlot,\n  PaneWrapper,\n  context = [],\n  paneClassName,\n  TargetScopeOverview,\n  TargetCorner,\n  onSidebarTogglerChange,\n  userUseScopeQuery,\n  scopeClassName,\n}: ScopeProps) {\n  const { scope } = userUseScopeQuery ? userUseScopeQuery() : useScopeQuery();\n  const isMobile = useIsMobile();\n  const [isSidebarOpen, handleSidebarToggle] = useReducer((x) => !x, !isMobile);\n  const sidebarOpenness = isSidebarOpen ? Layout.row : Layout.right;\n  if (!scope) {\n    return <FullLoader />;\n  }\n  const CornerOverride = TargetCorner || cornerSlot?.values()[0];\n  scopeUi.setComponents(scope.components);\n  const Context = context.map((ctx) => [ctx, { scope }] as ComponentTuple);\n\n  onSidebarTogglerChange(handleSidebarToggle);\n\n  return (\n    <ScopeProvider scope={scope}>\n      <Composer components={Context}>\n        <div className={classNames(styles.scope, scopeClassName)}>\n          <TopBar\n            className={styles.topbar}\n            Corner={() => {\n              if (CornerOverride) return <CornerOverride />;\n              return <Corner name={scope.name} className={styles.whiteCorner} />;\n            }}\n            menu={menuSlot}\n          />\n\n          <SplitPane className={styles.main} size={264} layout={sidebarOpenness}>\n            <Pane className={styles.sidebar}>{sidebar}</Pane>\n            <HoverSplitter className={styles.splitter}>\n              <Collapser\n                isOpen={isSidebarOpen}\n                onMouseDown={(e) => e.stopPropagation()} // avoid split-pane drag\n                onClick={handleSidebarToggle}\n                tooltipContent={`${isSidebarOpen ? 'Hide' : 'Show'} side panel`}\n              />\n            </HoverSplitter>\n\n            {\n              /**\n               * @hack - discuss with Ran why we need a PaneWrapper as a parent of the Pane\n               * conditionally rendering it makes sure that it doesn't break the code tab layout\n               */\n              (PaneWrapper && (\n                <PaneContainer Wrapper={PaneWrapper}>\n                  <Pane className={classNames(paneClassName, styles.pane)}>\n                    <SlotRouter slot={routeSlot}>\n                      <Route\n                        index\n                        element={\n                          <ScopeOverview\n                            badgeSlot={badgeSlot}\n                            overviewSlot={overviewLineSlot}\n                            TargetOverview={TargetScopeOverview}\n                          />\n                        }\n                      />\n                    </SlotRouter>\n                  </Pane>\n                </PaneContainer>\n              )) || (\n                <Pane className={classNames(paneClassName, styles.pane)}>\n                  <SlotRouter slot={routeSlot}>\n                    <Route\n                      index\n                      element={\n                        <ScopeOverview\n                          badgeSlot={badgeSlot}\n                          overviewSlot={overviewLineSlot}\n                          TargetOverview={TargetScopeOverview}\n                        />\n                      }\n                    />\n                  </SlotRouter>\n                </Pane>\n              )\n            }\n          </SplitPane>\n        </div>\n      </Composer>\n    </ScopeProvider>\n  );\n}\n\nfunction PaneContainer({\n  children,\n  Wrapper,\n}: {\n  children: ReactNode;\n  Wrapper: ComponentType<{ children: ReactNode }>;\n}) {\n  return <Wrapper>{children}</Wrapper>;\n}\n"],"mappings":"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"}