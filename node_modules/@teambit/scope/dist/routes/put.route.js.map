{"version":3,"names":["PutRoute","constructor","scope","postPutSlot","Verb","WRITE","req","res","setTimeout","config","httpTimeOut","pushOptionsStr","headers","Error","pushOptions","JSON","parse","objectList","ObjectList","fromTar","ids","put","path","Promise","all","map","id","resolveComponentId","json"],"sources":["put.route.ts"],"sourcesContent":["import { Route, Verb, Request, Response } from '@teambit/express';\nimport { ObjectList } from '@teambit/legacy/dist/scope/objects/object-list';\nimport { put } from '@teambit/legacy/dist/api/scope';\nimport { OnPostPutSlot, ScopeMain } from '../scope.main.runtime';\n\nexport class PutRoute implements Route {\n  constructor(private scope: ScopeMain, private postPutSlot: OnPostPutSlot) {}\n\n  method = 'post';\n  route = '/scope/put';\n  verb = Verb.WRITE;\n\n  middlewares = [\n    async (req: Request, res: Response) => {\n      req.setTimeout(this.scope.config.httpTimeOut);\n      const pushOptionsStr = req.headers['push-options'];\n      if (!pushOptionsStr) throw new Error('http is missing the push-options header');\n      const pushOptions = JSON.parse(pushOptionsStr as string);\n      const objectList = await ObjectList.fromTar(req);\n      const ids = await put(\n        {\n          path: this.scope.path,\n          objectList,\n        },\n        pushOptions\n      );\n\n      await Promise.all(\n        ids.map((id) => {\n          return this.scope.resolveComponentId(id);\n        })\n      );\n\n      res.json(ids);\n    },\n  ];\n}\n"],"mappings":";;;;;;;;;;;;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAGO,MAAMA,QAAQ,CAAkB;EACrCC,WAAW,CAASC,KAAgB,EAAUC,WAA0B,EAAE;IAAA,KAAtDD,KAAgB,GAAhBA,KAAgB;IAAA,KAAUC,WAA0B,GAA1BA,WAA0B;IAAA,gDAE/D,MAAM;IAAA,+CACP,YAAY;IAAA,8CACbC,eAAI,CAACC,KAAK;IAAA,qDAEH,CACZ,OAAOC,GAAY,EAAEC,GAAa,KAAK;MACrCD,GAAG,CAACE,UAAU,CAAC,IAAI,CAACN,KAAK,CAACO,MAAM,CAACC,WAAW,CAAC;MAC7C,MAAMC,cAAc,GAAGL,GAAG,CAACM,OAAO,CAAC,cAAc,CAAC;MAClD,IAAI,CAACD,cAAc,EAAE,MAAM,IAAIE,KAAK,CAAC,yCAAyC,CAAC;MAC/E,MAAMC,WAAW,GAAGC,IAAI,CAACC,KAAK,CAACL,cAAc,CAAW;MACxD,MAAMM,UAAU,GAAG,MAAMC,wBAAU,CAACC,OAAO,CAACb,GAAG,CAAC;MAChD,MAAMc,GAAG,GAAG,MAAM,IAAAC,YAAG,EACnB;QACEC,IAAI,EAAE,IAAI,CAACpB,KAAK,CAACoB,IAAI;QACrBL;MACF,CAAC,EACDH,WAAW,CACZ;MAED,MAAMS,OAAO,CAACC,GAAG,CACfJ,GAAG,CAACK,GAAG,CAAEC,EAAE,IAAK;QACd,OAAO,IAAI,CAACxB,KAAK,CAACyB,kBAAkB,CAACD,EAAE,CAAC;MAC1C,CAAC,CAAC,CACH;MAEDnB,GAAG,CAACqB,IAAI,CAACR,GAAG,CAAC;IACf,CAAC,CACF;EA7B0E;AA8B7E;AAAC"}