{"version":3,"names":["scopeDrawer","treeWidgets","filtersSlot","drawerWidgetSlot","assumeScopeInUrl","overrideUseComponents","customScopeTreeNodeRenderer","treeNodeSlot","host","TreeNode","props","children","node","payload","ScopePayload","scopeNameFromNode","id","slice","scope","name","map","childNode","ComponentsDrawer","order","plugins","tree","widgets","customRenderer","filters","drawerWidgets","useHost","useScope","emptyMessage","transformTree","rootNode","thisScopeIndex","findIndex","undefined","thisScope","concat","useComponents","lanesModel","loading","lanesLoading","useLanes","viewedLaneId","viewedLane","components","laneComponents","laneCompsLoading","useLaneComponents","isDefault","mainComponents","useContext","ScopeContext","mergeComponents","mainComponentsThatAreNotOnLane","filter","mainComponent","find","laneComponent","toStringWithoutVersion"],"sources":["scope.ui.drawer.tsx"],"sourcesContent":["import React, { useContext } from 'react';\nimport { ComponentsDrawer, ComponentFiltersSlot, DrawerWidgetSlot } from '@teambit/component.ui.component-drawer';\nimport {\n  ComponentView,\n  NamespaceTreeNode,\n  PayloadType,\n  ScopePayload,\n  ScopeTreeNode,\n} from '@teambit/ui-foundation.ui.side-bar';\nimport { TreeNode as TreeNodeType, TreeNodeProps } from '@teambit/design.ui.tree';\nimport { useLanes } from '@teambit/lanes.hooks.use-lanes';\nimport { useLaneComponents } from '@teambit/lanes.hooks.use-lane-components';\nimport { ComponentModel } from '@teambit/component';\nimport { useScope, ScopeContext } from '@teambit/scope.ui.hooks.scope-context';\n// import { WorkspaceModel } from '@teambit/workspace';\nimport { SidebarSlot } from './scope.ui.runtime';\n\nexport type ScopeDrawerProps = {\n  treeWidgets: SidebarSlot;\n  filtersSlot: ComponentFiltersSlot;\n  drawerWidgetSlot: DrawerWidgetSlot;\n  assumeScopeInUrl?: boolean;\n  overrideUseComponents?: () => { components: ComponentModel[] };\n};\n\nexport const scopeDrawer = ({\n  treeWidgets,\n  filtersSlot,\n  drawerWidgetSlot,\n  assumeScopeInUrl = false,\n  overrideUseComponents,\n}: ScopeDrawerProps) => {\n  const customScopeTreeNodeRenderer = (treeNodeSlot, host?: any) =>\n    function TreeNode(props: TreeNodeProps<PayloadType>) {\n      const children = props.node.children;\n\n      if (!children) return <ComponentView {...props} treeNodeSlot={treeNodeSlot} />;\n\n      // skip over scope node and render only children\n      if (props.node.payload instanceof ScopePayload) {\n        const scopeNameFromNode = props.node.id.slice(0, -1);\n        const scope = host?.name;\n\n        /**\n         * this is only valid when viewing component from a lane\n         * if the lane component is from a different scope than the current scope\n         * show the scope node\n         */\n        if (scopeNameFromNode !== scope) {\n          return <ScopeTreeNode {...props} />;\n        }\n\n        return (\n          <>\n            {children.map((childNode) => (\n              <TreeNode key={childNode.id} {...props} node={childNode}></TreeNode>\n            ))}\n          </>\n        );\n      }\n\n      return <NamespaceTreeNode {...props} />;\n    };\n\n  return new ComponentsDrawer({\n    assumeScopeInUrl,\n    order: 0,\n    id: 'scope-components-drawer',\n    name: 'COMPONENTS',\n    plugins: {\n      tree: {\n        widgets: treeWidgets,\n        customRenderer: customScopeTreeNodeRenderer,\n      },\n      filters: filtersSlot,\n      drawerWidgets: drawerWidgetSlot,\n    },\n    useHost: () => useScope(),\n    emptyMessage: 'Scope is empty',\n    // TODO: create an interface for Component host.\n    transformTree: (host?: any) => {\n      return (rootNode: TreeNodeType) => {\n        const thisScopeIndex = rootNode.children?.findIndex((node) => {\n          if (!(node.payload instanceof ScopePayload)) return undefined;\n          const scopeNameFromNode = node.id.slice(0, -1);\n          return scopeNameFromNode === host?.name;\n        });\n\n        const thisScope =\n          rootNode.children && thisScopeIndex !== undefined ? rootNode.children[thisScopeIndex] : undefined;\n\n        if (thisScope && thisScope.children && rootNode.children) {\n          delete rootNode.children[thisScopeIndex as number];\n          const children = rootNode.children.concat(thisScope.children);\n          rootNode.children = children;\n        }\n\n        return rootNode;\n      };\n    },\n    useComponents:\n      overrideUseComponents ||\n      (() => {\n        const { lanesModel, loading: lanesLoading } = useLanes();\n        const viewedLaneId = lanesModel?.viewedLane?.id;\n\n        const { components: laneComponents = [], loading: laneCompsLoading } = useLaneComponents(\n          viewedLaneId?.isDefault() ? undefined : viewedLaneId\n        );\n        const { components: mainComponents } = useContext(ScopeContext);\n        // lane components + main components\n        const components = mergeComponents(mainComponents, laneComponents);\n\n        return {\n          loading: lanesLoading || laneCompsLoading,\n          components,\n        };\n      }),\n  });\n};\n\nfunction mergeComponents(mainComponents: ComponentModel[], laneComponents: ComponentModel[]): ComponentModel[] {\n  const mainComponentsThatAreNotOnLane = mainComponents.filter((mainComponent) => {\n    return !laneComponents.find(\n      (laneComponent) => laneComponent.id.toStringWithoutVersion() === mainComponent.id.toStringWithoutVersion()\n    );\n  });\n  return laneComponents.concat(mainComponentsThatAreNotOnLane);\n}\n"],"mappings":"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"}