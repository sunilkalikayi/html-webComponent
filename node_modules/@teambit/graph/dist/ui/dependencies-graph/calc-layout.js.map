{"version":3,"names":["NODE_WIDTH","NODE_HEIGHT","BOTTOM_TO_TOP","calcLayout","graph","g","graphlib","Graph","setGraph","rankdir","setDefaultEdgeLabel","nodes","forEach","n","setNode","id","width","height","edges","e","setEdge","v","sourceId","w","targetId","dagre","layout","positionsArr","map","nodeId","node","pos","x","y","Map"],"sources":["calc-layout.tsx"],"sourcesContent":["import dagre, { graphlib } from 'dagre';\nimport { EdgeModel, GraphModel, NodeModel } from '../query';\n\nconst NODE_WIDTH = 260;\nconst NODE_HEIGHT = 90;\n\nconst BOTTOM_TO_TOP = 'BT';\n\n/**\n * calculate the specific location of each node in the graph\n */\nexport function calcLayout(graph: GraphModel<NodeModel, EdgeModel>) {\n  const g = new graphlib.Graph();\n  g.setGraph({ rankdir: BOTTOM_TO_TOP });\n  g.setDefaultEdgeLabel(() => ({}));\n\n  // make a new instance of { width, height } per node, or dagre will get confused and place all nodes in the same spot\n  graph.nodes.forEach((n) => g.setNode(n.id, { width: NODE_WIDTH, height: NODE_HEIGHT }));\n  graph.edges.forEach((e) => g.setEdge({ v: e.sourceId, w: e.targetId }));\n\n  // position items in graph\n  dagre.layout(g);\n\n  const positionsArr: [string, { x: number; y: number }][] = g.nodes().map((nodeId) => {\n    const node = g.node(nodeId);\n\n    const pos = {\n      x: node.x - node.width / 2,\n      y: node.y - node.height / 2,\n    };\n\n    return [nodeId, pos];\n  });\n\n  return new Map(positionsArr);\n}\n"],"mappings":";;;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAAwC;AAAA;AAGxC,MAAMA,UAAU,GAAG,GAAG;AACtB,MAAMC,WAAW,GAAG,EAAE;AAEtB,MAAMC,aAAa,GAAG,IAAI;;AAE1B;AACA;AACA;AACO,SAASC,UAAU,CAACC,KAAuC,EAAE;EAClE,MAAMC,CAAC,GAAG,KAAIC,iBAAQ,CAACC,KAAK,GAAE;EAC9BF,CAAC,CAACG,QAAQ,CAAC;IAAEC,OAAO,EAAEP;EAAc,CAAC,CAAC;EACtCG,CAAC,CAACK,mBAAmB,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;;EAEjC;EACAN,KAAK,CAACO,KAAK,CAACC,OAAO,CAAEC,CAAC,IAAKR,CAAC,CAACS,OAAO,CAACD,CAAC,CAACE,EAAE,EAAE;IAAEC,KAAK,EAAEhB,UAAU;IAAEiB,MAAM,EAAEhB;EAAY,CAAC,CAAC,CAAC;EACvFG,KAAK,CAACc,KAAK,CAACN,OAAO,CAAEO,CAAC,IAAKd,CAAC,CAACe,OAAO,CAAC;IAAEC,CAAC,EAAEF,CAAC,CAACG,QAAQ;IAAEC,CAAC,EAAEJ,CAAC,CAACK;EAAS,CAAC,CAAC,CAAC;;EAEvE;EACAC,gBAAK,CAACC,MAAM,CAACrB,CAAC,CAAC;EAEf,MAAMsB,YAAkD,GAAGtB,CAAC,CAACM,KAAK,EAAE,CAACiB,GAAG,CAAEC,MAAM,IAAK;IACnF,MAAMC,IAAI,GAAGzB,CAAC,CAACyB,IAAI,CAACD,MAAM,CAAC;IAE3B,MAAME,GAAG,GAAG;MACVC,CAAC,EAAEF,IAAI,CAACE,CAAC,GAAGF,IAAI,CAACd,KAAK,GAAG,CAAC;MAC1BiB,CAAC,EAAEH,IAAI,CAACG,CAAC,GAAGH,IAAI,CAACb,MAAM,GAAG;IAC5B,CAAC;IAED,OAAO,CAACY,MAAM,EAAEE,GAAG,CAAC;EACtB,CAAC,CAAC;EAEF,OAAO,IAAIG,GAAG,CAACP,YAAY,CAAC;AAC9B"}