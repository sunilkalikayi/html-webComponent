{"version":3,"names":["ComponentNodeContainer","props","sourcePosition","Position","Top","targetPosition","Bottom","data","id","node","type","NodeTypes","ComponentNode","DependenciesCompare","graphRef","useRef","componentCompare","useComponentCompare","baseId","base","model","compareId","compare","filter","setFilter","useState","isFiltered","loading","baseLoading","graph","baseGraph","useGraphQuery","toString","compareLoading","compareGraph","diffGraph","undefined","elements","calcElements","rootNode","useEffect","current","fitView","handleLoad","instance","onCheckFilter","_isFiltered","classNames","styles","page","graphPageStyles","loader","dependenciesGraphStyles","controls","calcMinimapColors","minimap","filters"],"sources":["dependencies-compare.tsx"],"sourcesContent":["import classNames from 'classnames';\nimport { useComponentCompare } from '@teambit/component.ui.compare';\nimport { RoundLoader } from '@teambit/design.ui.round-loader';\nimport {\n  calcElements,\n  calcMinimapColors,\n  dependenciesGraphStyles,\n  GraphFilter,\n  GraphFilters,\n  graphPageStyles,\n  useGraphQuery,\n} from '@teambit/graph';\nimport React, { useEffect, useRef, useState } from 'react';\nimport ReactFlow, {\n  Background,\n  Controls,\n  Handle,\n  MiniMap,\n  NodeProps,\n  NodeTypesType,\n  OnLoadParams,\n  Position,\n  ReactFlowProvider,\n} from 'react-flow-renderer';\nimport styles from './dependencies-compare.module.scss';\nimport { DependencyCompareNode } from './dependency-compare-node';\nimport { diffGraph } from './diff-graph';\n\nfunction ComponentNodeContainer(props: NodeProps) {\n  const { sourcePosition = Position.Top, targetPosition = Position.Bottom, data, id } = props;\n\n  return (\n    <div key={id}>\n      <Handle type=\"target\" position={targetPosition} isConnectable={false} />\n      <Handle type=\"source\" position={sourcePosition} isConnectable={false} />\n      <DependencyCompareNode node={data.node} type={data.type} />\n    </div>\n  );\n}\n\nconst NodeTypes: NodeTypesType = { ComponentNode: ComponentNodeContainer };\n\nexport function DependenciesCompare() {\n  const graphRef = useRef<OnLoadParams>();\n  const componentCompare = useComponentCompare();\n\n  const baseId = componentCompare?.base?.model.id;\n  const compareId = componentCompare?.compare?.model.id;\n\n  const [filter, setFilter] = useState<GraphFilter>('runtimeOnly');\n  const isFiltered = filter === 'runtimeOnly';\n  const { loading: baseLoading, graph: baseGraph } = useGraphQuery(baseId && [baseId.toString()], filter);\n  const { loading: compareLoading, graph: compareGraph } = useGraphQuery(compareId && [compareId.toString()], filter);\n  const loading = baseLoading || compareLoading;\n  const graph = diffGraph(baseGraph, compareGraph, baseId) ?? undefined;\n  const elements = calcElements(graph, { rootNode: baseId });\n\n  useEffect(() => {\n    graphRef.current?.fitView();\n  }, [elements]);\n\n  function handleLoad(instance: OnLoadParams) {\n    graphRef.current = instance;\n    graphRef.current?.fitView();\n  }\n\n  const onCheckFilter = (_isFiltered: boolean) => {\n    setFilter(_isFiltered ? 'runtimeOnly' : undefined);\n  };\n\n  if (!loading && (!baseGraph || !compareGraph)) {\n    return <></>;\n  }\n\n  return (\n    <div className={classNames([styles.page, graphPageStyles.graph])}>\n      {loading && (\n        <div className={styles.loader}>\n          <RoundLoader />\n        </div>\n      )}\n      <ReactFlowProvider>\n        <ReactFlow\n          draggable={false}\n          nodesDraggable={true}\n          selectNodesOnDrag={false}\n          nodesConnectable={false}\n          zoomOnDoubleClick={false}\n          elementsSelectable={false}\n          maxZoom={1}\n          className={dependenciesGraphStyles.graph}\n          elements={elements}\n          nodeTypes={NodeTypes}\n          onLoad={handleLoad}\n        >\n          <Background />\n          <Controls className={dependenciesGraphStyles.controls} />\n          <MiniMap nodeColor={calcMinimapColors} className={dependenciesGraphStyles.minimap} />\n          <GraphFilters\n            className={graphPageStyles.filters}\n            disable={loading}\n            isFiltered={isFiltered}\n            onChangeFilter={onCheckFilter}\n          />\n        </ReactFlow>\n      </ReactFlowProvider>\n    </div>\n  );\n}\n"],"mappings":"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"}