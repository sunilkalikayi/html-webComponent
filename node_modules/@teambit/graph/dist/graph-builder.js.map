{"version":3,"names":["GraphBuilder","constructor","componentAspect","getGraph","ids","opts","componentHost","host","getHost","legacyGraph","getLegacyGraph","graph","buildFromLegacy","seederIds","listIds","newGraph","ComponentGraph","setNodeP","nodes","map","nodeId","componentId","resolveComponentId","component","get","setNode","Node","toString","Promise","all","setEdgePromise","edges","edgeId","source","v","target","w","edgeObj","edge","Dependency","setEdge","Edge"],"sources":["graph-builder.ts"],"sourcesContent":["import { ComponentFactory, ComponentID, ComponentMain } from '@teambit/component';\nimport { Node, Edge } from '@teambit/graph.cleargraph';\nimport type LegacyGraph from '@teambit/legacy/dist/scope/graph/graph';\nimport { ComponentGraph } from './component-graph';\nimport { Dependency } from './model/dependency';\n\nexport type GetGraphOpts = {\n  host?: ComponentFactory;\n};\n\ntype BuildFromLegacyGraphOpts = {\n  host?: ComponentFactory;\n};\n\nexport class GraphBuilder {\n  constructor(private componentAspect: ComponentMain) {}\n\n  async getGraph(ids?: ComponentID[], opts: GetGraphOpts = {}): Promise<ComponentGraph> {\n    const componentHost = opts.host || this.componentAspect.getHost();\n\n    const legacyGraph = await componentHost.getLegacyGraph(ids, false);\n    const graph = await this.buildFromLegacy(legacyGraph, { host: opts.host });\n    graph.seederIds = ids || (await componentHost.listIds());\n    return graph;\n  }\n\n  private async buildFromLegacy(\n    legacyGraph: LegacyGraph,\n    opts: BuildFromLegacyGraphOpts = {}\n  ): Promise<ComponentGraph> {\n    const newGraph = new ComponentGraph();\n    const componentHost = opts.host || this.componentAspect.getHost();\n\n    const setNodeP = legacyGraph.nodes().map(async (nodeId) => {\n      const componentId = await componentHost.resolveComponentId(nodeId);\n      const component = await componentHost.get(componentId);\n      if (component) {\n        newGraph.setNode(new Node(componentId.toString(), component));\n      }\n    });\n    await Promise.all(setNodeP);\n\n    const setEdgePromise = legacyGraph.edges().map(async (edgeId) => {\n      const source = await componentHost.resolveComponentId(edgeId.v);\n      const target = await componentHost.resolveComponentId(edgeId.w);\n      const edgeObj =\n        legacyGraph.edge(edgeId.v, edgeId.w) === 'dependencies' ? new Dependency('runtime') : new Dependency('dev');\n      newGraph.setEdge(new Edge(source.toString(), target.toString(), edgeObj));\n    });\n    await Promise.all(setEdgePromise);\n\n    return newGraph;\n  }\n}\n"],"mappings":";;;;;;;;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAUO,MAAMA,YAAY,CAAC;EACxBC,WAAW,CAASC,eAA8B,EAAE;IAAA,KAAhCA,eAA8B,GAA9BA,eAA8B;EAAG;EAErD,MAAMC,QAAQ,CAACC,GAAmB,EAAEC,IAAkB,GAAG,CAAC,CAAC,EAA2B;IACpF,MAAMC,aAAa,GAAGD,IAAI,CAACE,IAAI,IAAI,IAAI,CAACL,eAAe,CAACM,OAAO,EAAE;IAEjE,MAAMC,WAAW,GAAG,MAAMH,aAAa,CAACI,cAAc,CAACN,GAAG,EAAE,KAAK,CAAC;IAClE,MAAMO,KAAK,GAAG,MAAM,IAAI,CAACC,eAAe,CAACH,WAAW,EAAE;MAAEF,IAAI,EAAEF,IAAI,CAACE;IAAK,CAAC,CAAC;IAC1EI,KAAK,CAACE,SAAS,GAAGT,GAAG,KAAK,MAAME,aAAa,CAACQ,OAAO,EAAE,CAAC;IACxD,OAAOH,KAAK;EACd;EAEA,MAAcC,eAAe,CAC3BH,WAAwB,EACxBJ,IAA8B,GAAG,CAAC,CAAC,EACV;IACzB,MAAMU,QAAQ,GAAG,KAAIC,gCAAc,GAAE;IACrC,MAAMV,aAAa,GAAGD,IAAI,CAACE,IAAI,IAAI,IAAI,CAACL,eAAe,CAACM,OAAO,EAAE;IAEjE,MAAMS,QAAQ,GAAGR,WAAW,CAACS,KAAK,EAAE,CAACC,GAAG,CAAC,MAAOC,MAAM,IAAK;MACzD,MAAMC,WAAW,GAAG,MAAMf,aAAa,CAACgB,kBAAkB,CAACF,MAAM,CAAC;MAClE,MAAMG,SAAS,GAAG,MAAMjB,aAAa,CAACkB,GAAG,CAACH,WAAW,CAAC;MACtD,IAAIE,SAAS,EAAE;QACbR,QAAQ,CAACU,OAAO,CAAC,KAAIC,aAAI,EAACL,WAAW,CAACM,QAAQ,EAAE,EAAEJ,SAAS,CAAC,CAAC;MAC/D;IACF,CAAC,CAAC;IACF,MAAMK,OAAO,CAACC,GAAG,CAACZ,QAAQ,CAAC;IAE3B,MAAMa,cAAc,GAAGrB,WAAW,CAACsB,KAAK,EAAE,CAACZ,GAAG,CAAC,MAAOa,MAAM,IAAK;MAC/D,MAAMC,MAAM,GAAG,MAAM3B,aAAa,CAACgB,kBAAkB,CAACU,MAAM,CAACE,CAAC,CAAC;MAC/D,MAAMC,MAAM,GAAG,MAAM7B,aAAa,CAACgB,kBAAkB,CAACU,MAAM,CAACI,CAAC,CAAC;MAC/D,MAAMC,OAAO,GACX5B,WAAW,CAAC6B,IAAI,CAACN,MAAM,CAACE,CAAC,EAAEF,MAAM,CAACI,CAAC,CAAC,KAAK,cAAc,GAAG,KAAIG,wBAAU,EAAC,SAAS,CAAC,GAAG,KAAIA,wBAAU,EAAC,KAAK,CAAC;MAC7GxB,QAAQ,CAACyB,OAAO,CAAC,KAAIC,aAAI,EAACR,MAAM,CAACN,QAAQ,EAAE,EAAEQ,MAAM,CAACR,QAAQ,EAAE,EAAEU,OAAO,CAAC,CAAC;IAC3E,CAAC,CAAC;IACF,MAAMT,OAAO,CAACC,GAAG,CAACC,cAAc,CAAC;IAEjC,OAAOf,QAAQ;EACjB;AACF;AAAC"}