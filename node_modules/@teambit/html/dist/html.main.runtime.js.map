{"version":3,"names":["HtmlMain","constructor","react","htmlEnv","envs","overrideTsConfig","bind","overrideJestConfig","overrideBuildPipe","overrideCompiler","overrideCompilerTasks","overrideBuildTsConfig","overridePackageJsonProps","useTypescript","useWebpack","usePrettier","useEslint","overrideDependencies","dependencyPolicy","override","getDependencies","mergeDeepLeft","compose","transformers","targetEnv","merge","provider","generator","HtmlEnv","reactEnv","registerEnv","registerComponentTemplate","htmlEnvTemplate","htmlComponentTemplate","deprecatedHtmlComponentTemplate","EnvsAspect","ReactAspect","GeneratorAspect","MainRuntime","HtmlAspect","addRuntime"],"sources":["html.main.runtime.ts"],"sourcesContent":["import mergeDeepLeft from 'ramda/src/mergeDeepLeft';\nimport { TsConfigSourceFile } from 'typescript';\nimport type { TsCompilerOptionsWithoutTsConfig } from '@teambit/typescript';\nimport { BuildTask } from '@teambit/builder';\nimport { Compiler } from '@teambit/compiler';\nimport { PackageJsonProps } from '@teambit/pkg';\nimport { EnvPolicyConfigObject } from '@teambit/dependency-resolver';\nimport { MainRuntime } from '@teambit/cli';\nimport { EnvsAspect, EnvsMain, EnvTransformer, Environment } from '@teambit/envs';\nimport { ReactAspect, ReactEnv, ReactMain } from '@teambit/react';\nimport { GeneratorAspect, GeneratorMain } from '@teambit/generator';\nimport { htmlEnvTemplate } from './templates/html-env';\nimport { htmlComponentTemplate, deprecatedHtmlComponentTemplate } from './templates/html-component';\nimport { HtmlAspect } from './html.aspect';\nimport { HtmlEnv } from './html.env';\n\nexport class HtmlMain {\n  constructor(\n    private react: ReactMain,\n\n    readonly htmlEnv: HtmlEnv,\n\n    private envs: EnvsMain\n  ) {}\n  static slots = [];\n  static dependencies = [EnvsAspect, ReactAspect, GeneratorAspect];\n  static runtime = MainRuntime;\n\n  /**\n   * @deprecated use useTypescript()\n   * override the TS config of the environment.\n   */\n  overrideTsConfig: (\n    tsconfig: TsConfigSourceFile,\n    compilerOptions?: Partial<TsCompilerOptionsWithoutTsConfig>,\n    tsModule?: any\n  ) => EnvTransformer = this.react.overrideTsConfig.bind(this.react);\n\n  /**\n   * override the jest config of the environment.\n   */\n  overrideJestConfig = this.react.overrideJestConfig.bind(this.react);\n\n  /**\n   * override the env build pipeline.\n   */\n  overrideBuildPipe: (tasks: BuildTask[]) => EnvTransformer = this.react.overrideBuildPipe.bind(this.react);\n\n  /**\n   * override the env compilers list.\n   */\n  overrideCompiler: (compiler: Compiler) => EnvTransformer = this.react.overrideCompiler.bind(this.react);\n\n  /**\n   * override the env compilers tasks in the build pipe.\n   */\n  overrideCompilerTasks: (tasks: BuildTask[]) => EnvTransformer = this.react.overrideCompilerTasks.bind(this.react);\n\n  /**\n   * @deprecated use useTypescript()\n   * override the build ts config.\n   */\n  overrideBuildTsConfig: (\n    tsconfig: any,\n    compilerOptions?: Partial<TsCompilerOptionsWithoutTsConfig>\n  ) => EnvTransformer = this.react.overrideBuildTsConfig.bind(this.react);\n\n  /**\n   * override package json properties.\n   */\n  overridePackageJsonProps: (props: PackageJsonProps) => EnvTransformer = this.react.overridePackageJsonProps.bind(\n    this.react\n  );\n\n  /**\n   * override the env's typescript config for both dev and build time.\n   * Replaces both overrideTsConfig (devConfig) and overrideBuildTsConfig (buildConfig)\n   */\n  useTypescript = this.react.useTypescript.bind(this.react);\n\n  /**\n   * override the env's dev server and preview webpack configurations.\n   * Replaces both overrideDevServerConfig and overridePreviewConfig\n   */\n  useWebpack = this.react.useWebpack.bind(this.react);\n\n  /**\n   * An API to mutate the prettier config\n   */\n  usePrettier = this.react.usePrettier.bind(this.react);\n\n  /**\n   * An API to mutate the eslint config\n   */\n  useEslint = this.react.useEslint.bind(this.react);\n\n  /**\n   * override the dependency configuration of the component environment.\n   */\n  overrideDependencies(dependencyPolicy: EnvPolicyConfigObject) {\n    return this.envs.override({\n      getDependencies: () => mergeDeepLeft(dependencyPolicy, this.htmlEnv.getDependencies()),\n    });\n  }\n\n  /**\n   * create a new composition of the html environment.\n   */\n  compose(transformers: EnvTransformer[], targetEnv: Environment = {}) {\n    return this.envs.compose(this.envs.merge(targetEnv, this.htmlEnv), transformers);\n  }\n\n  static async provider([envs, react, generator]: [EnvsMain, ReactMain, GeneratorMain]) {\n    const htmlEnv: HtmlEnv = envs.merge<HtmlEnv, ReactEnv>(new HtmlEnv(), react.reactEnv);\n    envs.registerEnv(htmlEnv);\n    generator.registerComponentTemplate([htmlEnvTemplate, htmlComponentTemplate, deprecatedHtmlComponentTemplate]);\n    return new HtmlMain(react, htmlEnv, envs);\n  }\n}\n\nHtmlAspect.addRuntime(HtmlMain);\n"],"mappings":"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"}