{"version":3,"names":["publicUrlOrPath","getPublicUrlOrPath","process","env","NODE_ENV","configFactory","devServerID","workspaceDir","entryFiles","publicRoot","publicPath","pubsub","title","favicon","resolveWorkspacePath","relativePath","path","resolve","publicDirectory","mode","devtool","entry","map","filePath","output","filename","pathinfo","chunkFilename","devtoolModuleFilenameTemplate","info","pathNormalizeToLinux","absoluteResourcePath","infrastructureLogging","level","stats","errorDetails","devServer","allowedHosts","static","directory","staticOptions","serveIndex","watch","compress","hot","historyApiFallback","disableDotRule","index","client","overlay","onBeforeSetupMiddleware","wds","app","use","evalSourceMapMiddleware","errorOverlayMiddleware","onAfterSetupMiddleware","redirectServedPath","noopServiceWorkerMiddleware","devMiddleware","join","alias","fallbacksAliases","fallback","fallbacks","plugins","HtmlWebpackPlugin","templateContent","html","webpack","ProvidePlugin","fallbacksProvidePluginConfig","WebpackBitReporterPlugin","options"],"sources":["webpack.dev.config.ts"],"sourcesContent":["import path from 'path';\nimport webpack from 'webpack';\nimport HtmlWebpackPlugin from 'html-webpack-plugin';\nimport errorOverlayMiddleware from 'react-dev-utils/errorOverlayMiddleware';\nimport evalSourceMapMiddleware from 'react-dev-utils/evalSourceMapMiddleware';\nimport noopServiceWorkerMiddleware from 'react-dev-utils/noopServiceWorkerMiddleware';\nimport redirectServedPath from 'react-dev-utils/redirectServedPathMiddleware';\nimport getPublicUrlOrPath from 'react-dev-utils/getPublicUrlOrPath';\nimport { PubsubMain } from '@teambit/pubsub';\nimport { pathNormalizeToLinux } from '@teambit/legacy/dist/utils';\nimport { WebpackConfigWithDevServer } from '../webpack.dev-server';\nimport { fallbacks } from './webpack-fallbacks';\n\nimport { html } from './html';\n\nimport { WebpackBitReporterPlugin } from '../plugins/webpack-bit-reporter-plugin';\nimport { fallbacksProvidePluginConfig } from './webpack-fallbacks-provide-plugin-config';\nimport { fallbacksAliases } from './webpack-fallbacks-aliases';\n\nconst publicUrlOrPath = getPublicUrlOrPath(process.env.NODE_ENV === 'development', '/', '/public');\n\nexport function configFactory(\n  devServerID: string,\n  workspaceDir: string,\n  entryFiles: string[],\n  publicRoot: string,\n  publicPath: string,\n  pubsub: PubsubMain,\n  title?: string,\n  favicon?: string\n): WebpackConfigWithDevServer {\n  const resolveWorkspacePath = (relativePath) => path.resolve(workspaceDir, relativePath);\n\n  // Required for babel-preset-react-app\n  process.env.NODE_ENV = 'development';\n\n  const publicDirectory = `${publicRoot}/${publicPath}`;\n\n  return {\n    // Environment mode\n    mode: 'development',\n\n    devtool: 'inline-source-map',\n\n    // Entry point of app\n    entry: entryFiles.map((filePath) => resolveWorkspacePath(filePath)),\n\n    output: {\n      // Development filename output\n      filename: 'static/js/[name].bundle.js',\n\n      pathinfo: true,\n\n      path: resolveWorkspacePath(publicDirectory),\n\n      // publicPath: resolveWorkspacePath(publicDirectory),\n\n      chunkFilename: 'static/js/[name].chunk.js',\n\n      // point sourcemap entries to original disk locations (format as URL on windows)\n      devtoolModuleFilenameTemplate: (info) => pathNormalizeToLinux(path.resolve(info.absoluteResourcePath)),\n\n      // this defaults to 'window', but by setting it to 'this' then\n      // module chunks which are built will work in web workers as well.\n      // Commented out to use the default (self) as according to tobias with webpack5 self is working with workers as well\n      // globalObject: 'this',\n    },\n\n    infrastructureLogging: {\n      level: 'error',\n    },\n\n    stats: {\n      errorDetails: true,\n    },\n\n    devServer: {\n      allowedHosts: 'all',\n\n      static: [\n        {\n          directory: resolveWorkspacePath(publicDirectory),\n          staticOptions: {},\n          // Don't be confused with `dev.publicPath`, it is `publicPath` for static directory\n          // Can be:\n          // publicPath: ['/static-public-path-one/', '/static-public-path-two/'],\n          publicPath: publicDirectory,\n          // Can be:\n          // serveIndex: {} (options for the `serveIndex` option you can find https://github.com/expressjs/serve-index)\n          serveIndex: true,\n          // Can be:\n          // watch: {} (options for the `watch` option you can find https://github.com/paulmillr/chokidar)\n          watch: true,\n        },\n      ],\n\n      // Enable compression\n      compress: true,\n\n      // Enable hot reloading\n      hot: true,\n\n      historyApiFallback: {\n        disableDotRule: true,\n        index: resolveWorkspacePath(publicDirectory),\n      },\n\n      client: {\n        overlay: false,\n      },\n\n      onBeforeSetupMiddleware(wds) {\n        const { app } = wds;\n        // Keep `evalSourceMapMiddleware` and `errorOverlayMiddleware`\n        // middlewares before `redirectServedPath` otherwise will not have any effect\n        // This lets us fetch source contents from webpack for the error overlay\n        // @ts-ignore - @types/WDS mismatch - 3.11.6 vs 4.0.3\n        app.use(evalSourceMapMiddleware(wds));\n        // This lets us open files from the runtime error overlay.\n        app.use(errorOverlayMiddleware());\n      },\n\n      onAfterSetupMiddleware({ app }) {\n        // Redirect to `PUBLIC_URL` or `homepage` from `package.json` if url not match\n        app.use(redirectServedPath(publicUrlOrPath));\n\n        // This service worker file is effectively a 'no-op' that will reset any\n        // previous service worker registered for the same host:port combination.\n        // We do this in development to avoid hitting the production cache if\n        // it used the same host and port.\n        // https://github.com/facebook/create-react-app/issues/2272#issuecomment-302832432\n        app.use(noopServiceWorkerMiddleware(publicUrlOrPath));\n      },\n\n      devMiddleware: {\n        // forward static files\n        publicPath: path.join('/', publicRoot),\n      },\n    },\n\n    resolve: {\n      // TODO - check - we shoult not need both fallbacks and alias and provider plugin\n      alias: fallbacksAliases,\n\n      fallback: fallbacks as any,\n    },\n\n    plugins: [\n      new HtmlWebpackPlugin({\n        templateContent: html(title || 'Component preview'),\n        filename: 'index.html',\n        favicon,\n      }),\n      new webpack.ProvidePlugin(fallbacksProvidePluginConfig),\n\n      new WebpackBitReporterPlugin({\n        options: { pubsub, devServerID },\n      }),\n    ],\n  };\n}\n"],"mappings":"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"}