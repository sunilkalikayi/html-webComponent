{"version":3,"names":["generateAddAliasesFromPeersTransformer","peers","logger","config","context","hostRootDir","target","peerAliases","reduce","acc","peerName","resolved","resolvePeerToDirOrFile","addAliases","generateExposePeersTransformer","exposedRules","getExposedRules","addModuleRules","generateExternalsTransformer","depes","externals","getExternals","addExternals"],"sources":["transformers.ts"],"sourcesContent":["import { WebpackConfigTransformContext } from '@teambit/webpack';\nimport { WebpackConfigMutator } from '@teambit/webpack.modules.config-mutator';\nimport { Logger } from '@teambit/logger';\nimport { getExposedRules } from './get-exposed-rules';\nimport { resolvePeerToDirOrFile } from './resolve-peer';\nimport { getExternals } from './get-externals';\n\nexport function generateAddAliasesFromPeersTransformer(peers: string[], logger: Logger) {\n  return (config: WebpackConfigMutator, context: WebpackConfigTransformContext): WebpackConfigMutator => {\n    const hostRootDir = context.target?.hostRootDir || context.hostRootDir;\n    const peerAliases = peers.reduce((acc, peerName) => {\n      // gets the correct module folder of the package.\n      // this allows us to resolve internal files, for example:\n      // node_modules/react-dom/test-utils\n      //\n      // we can't use require.resolve() because it resolves to a specific file.\n      // for example, if we used \"react-dom\": require.resolve(\"react-dom\"),\n      // it would try to resolve \"react-dom/test-utils\" as:\n      // node_modules/react-dom/index.js/test-utils\n      const resolved = resolvePeerToDirOrFile(peerName, logger, hostRootDir);\n      // Sometime there are packages that only hold icons for example, so there is no main property in their package.json\n      // so they can't be resolved.\n      // in such cases do not add them to the aliases.\n      // We already log that cases in the resolvePeerToDirOrFile function.\n      if (resolved) {\n        acc[peerName] = resolved;\n      }\n      return acc;\n    }, {});\n\n    config.addAliases(peerAliases);\n    return config;\n  };\n}\n\n// [dead code] - no longer used\n/**\n * Generate a transformer that expose all the peers as global via the expose loader\n * @param peers\n * @returns\n */\nexport function generateExposePeersTransformer(peers: string[], logger: Logger) {\n  return (config: WebpackConfigMutator, context: WebpackConfigTransformContext): WebpackConfigMutator => {\n    const hostRootDir = context.target?.hostRootDir || context.hostRootDir;\n    const exposedRules = getExposedRules(peers, logger, hostRootDir);\n    config.addModuleRules(exposedRules);\n    return config;\n  };\n}\n\n/**\n * Generate a transformer that expose all the peers as global via the expose loader\n * @param peers\n * @returns\n */\nexport function generateExternalsTransformer(depes: string[]) {\n  return (config: WebpackConfigMutator): WebpackConfigMutator => {\n    const externals = getExternals(depes);\n    config.addExternals(externals);\n    return config;\n  };\n}\n"],"mappings":";;;;;;;;AAGA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEO,SAASA,sCAAsC,CAACC,KAAe,EAAEC,MAAc,EAAE;EACtF,OAAO,CAACC,MAA4B,EAAEC,OAAsC,KAA2B;IAAA;IACrG,MAAMC,WAAW,GAAG,oBAAAD,OAAO,CAACE,MAAM,oDAAd,gBAAgBD,WAAW,KAAID,OAAO,CAACC,WAAW;IACtE,MAAME,WAAW,GAAGN,KAAK,CAACO,MAAM,CAAC,CAACC,GAAG,EAAEC,QAAQ,KAAK;MAClD;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA,MAAMC,QAAQ,GAAG,IAAAC,qCAAsB,EAACF,QAAQ,EAAER,MAAM,EAAEG,WAAW,CAAC;MACtE;MACA;MACA;MACA;MACA,IAAIM,QAAQ,EAAE;QACZF,GAAG,CAACC,QAAQ,CAAC,GAAGC,QAAQ;MAC1B;MACA,OAAOF,GAAG;IACZ,CAAC,EAAE,CAAC,CAAC,CAAC;IAENN,MAAM,CAACU,UAAU,CAACN,WAAW,CAAC;IAC9B,OAAOJ,MAAM;EACf,CAAC;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACO,SAASW,8BAA8B,CAACb,KAAe,EAAEC,MAAc,EAAE;EAC9E,OAAO,CAACC,MAA4B,EAAEC,OAAsC,KAA2B;IAAA;IACrG,MAAMC,WAAW,GAAG,qBAAAD,OAAO,CAACE,MAAM,qDAAd,iBAAgBD,WAAW,KAAID,OAAO,CAACC,WAAW;IACtE,MAAMU,YAAY,GAAG,IAAAC,kCAAe,EAACf,KAAK,EAAEC,MAAM,EAAEG,WAAW,CAAC;IAChEF,MAAM,CAACc,cAAc,CAACF,YAAY,CAAC;IACnC,OAAOZ,MAAM;EACf,CAAC;AACH;;AAEA;AACA;AACA;AACA;AACA;AACO,SAASe,4BAA4B,CAACC,KAAe,EAAE;EAC5D,OAAQhB,MAA4B,IAA2B;IAC7D,MAAMiB,SAAS,GAAG,IAAAC,4BAAY,EAACF,KAAK,CAAC;IACrChB,MAAM,CAACmB,YAAY,CAACF,SAAS,CAAC;IAC9B,OAAOjB,MAAM;EACf,CAAC;AACH"}