{"version":3,"names":["writePeerLink","peers","workdir","content","generatePeerLink","fullpath","join","hash","writeFile","links","map","p","packageName","varName","toVarName","x","localName","camelcase","replace","pascalCase"],"sources":["create-peers-link.ts"],"sourcesContent":["import { join } from 'path';\nimport { writeFile } from 'fs-extra';\nimport camelcase from 'camelcase';\nimport hash from 'object-hash';\n\nexport async function writePeerLink(peers: string[], workdir: string) {\n  const content = generatePeerLink(peers);\n  const fullpath = join(workdir, `peers-link.${hash(content)}.js`);\n\n  await writeFile(fullpath, content);\n\n  return fullpath;\n}\n\n// TODO - this exposes the packages in the \"window\" strategy,\n// should use a better strategy like umd, systemjs, or jsonp\n\nexport function generatePeerLink(peers: string[]) {\n  if (!peers) return '';\n\n  const links = peers.map((p) => ({\n    packageName: p,\n    varName: toVarName(p),\n  }));\n\n  return `// @ts-nocheck\n${links.map((x) => `import * as ${x.varName} from \"${x.packageName}\"`).join(';\\n')};\n\nconst globalObj = window;\n\n${links.map(({ varName: localName }) => `guard(\"${localName}\", ${localName})`).join(';\\n')};\n\n${links.map((x) => `globalObj[\"${x.varName}\"] = ${x.varName}`).join(';\\n')};\n\nfunction guard(property, expected) {\n  var existing = globalObj[property];\n\n  if (existing === expected && expected !== undefined)\n    console.warn('[expose-peers] \"' + property + '\" already exists in global scope, but with correct value');\n  else if (existing !== undefined)\n    throw new Error('[expose-peers] \"' + property + '\" already exists in the global scope, cannot overwrite');\n}\n`;\n}\n\nfunction toVarName(packageName: string) {\n  return camelcase(packageName.replace('@', '__').replace('/', '_'), { pascalCase: true });\n}\n"],"mappings":";;;;;;;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEO,eAAeA,aAAa,CAACC,KAAe,EAAEC,OAAe,EAAE;EACpE,MAAMC,OAAO,GAAGC,gBAAgB,CAACH,KAAK,CAAC;EACvC,MAAMI,QAAQ,GAAG,IAAAC,YAAI,EAACJ,OAAO,EAAG,cAAa,IAAAK,qBAAI,EAACJ,OAAO,CAAE,KAAI,CAAC;EAEhE,MAAM,IAAAK,oBAAS,EAACH,QAAQ,EAAEF,OAAO,CAAC;EAElC,OAAOE,QAAQ;AACjB;;AAEA;AACA;;AAEO,SAASD,gBAAgB,CAACH,KAAe,EAAE;EAChD,IAAI,CAACA,KAAK,EAAE,OAAO,EAAE;EAErB,MAAMQ,KAAK,GAAGR,KAAK,CAACS,GAAG,CAAEC,CAAC,KAAM;IAC9BC,WAAW,EAAED,CAAC;IACdE,OAAO,EAAEC,SAAS,CAACH,CAAC;EACtB,CAAC,CAAC,CAAC;EAEH,OAAQ;AACV,EAAEF,KAAK,CAACC,GAAG,CAAEK,CAAC,IAAM,eAAcA,CAAC,CAACF,OAAQ,UAASE,CAAC,CAACH,WAAY,GAAE,CAAC,CAACN,IAAI,CAAC,KAAK,CAAE;AACnF;AACA;AACA;AACA,EAAEG,KAAK,CAACC,GAAG,CAAC,CAAC;IAAEG,OAAO,EAAEG;EAAU,CAAC,KAAM,UAASA,SAAU,MAAKA,SAAU,GAAE,CAAC,CAACV,IAAI,CAAC,KAAK,CAAE;AAC3F;AACA,EAAEG,KAAK,CAACC,GAAG,CAAEK,CAAC,IAAM,cAAaA,CAAC,CAACF,OAAQ,QAAOE,CAAC,CAACF,OAAQ,EAAC,CAAC,CAACP,IAAI,CAAC,KAAK,CAAE;AAC3E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AAEA,SAASQ,SAAS,CAACF,WAAmB,EAAE;EACtC,OAAO,IAAAK,oBAAS,EAACL,WAAW,CAACM,OAAO,CAAC,GAAG,EAAE,IAAI,CAAC,CAACA,OAAO,CAAC,GAAG,EAAE,GAAG,CAAC,EAAE;IAAEC,UAAU,EAAE;EAAK,CAAC,CAAC;AAC1F"}