{"version":3,"names":["extendWithComponentsFromDir","rootDir","manifestsByPaths","files","fs","readdir","withFileTypes","newManifestsByPaths","Promise","all","filter","file","isDirectory","name","map","dir","path","join","dirPath","readJson","err","code"],"sources":["extend-with-components-from-dir.ts"],"sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\n\n/**\n * Currently, the same capsule directory is used multiple times during installation.\n * The issue is that the state between installations is not preserved,\n * so the node_modules directory gets broken on each sunseqent install.\n * This function is for finding all components in the root of the capsule and reading their manifests.\n * This way the package manager will have all the necessary information to keep the node_modules directory\n * in the correct state.\n */\nexport async function extendWithComponentsFromDir(rootDir: string, manifestsByPaths) {\n  const files = await fs.readdir(rootDir, { withFileTypes: true });\n  const newManifestsByPaths = { ...manifestsByPaths };\n  await Promise.all(\n    files\n      .filter((file) => file.isDirectory() && file.name !== 'node_modules')\n      .map((dir) => path.join(rootDir, dir.name))\n      .filter((dirPath) => !manifestsByPaths[dirPath])\n      .map(async (dirPath) => {\n        try {\n          newManifestsByPaths[dirPath] = await fs.readJson(path.join(dirPath, 'package.json'));\n        } catch (err: any) {\n          if (err.code !== 'ENOENT') throw err;\n        }\n      })\n  );\n  return newManifestsByPaths;\n}\n"],"mappings":";;;;;;;;;;;;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAAwB;AAAA;AAExB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,eAAeA,2BAA2B,CAACC,OAAe,EAAEC,gBAAgB,EAAE;EACnF,MAAMC,KAAK,GAAG,MAAMC,kBAAE,CAACC,OAAO,CAACJ,OAAO,EAAE;IAAEK,aAAa,EAAE;EAAK,CAAC,CAAC;EAChE,MAAMC,mBAAmB,qBAAQL,gBAAgB,CAAE;EACnD,MAAMM,OAAO,CAACC,GAAG,CACfN,KAAK,CACFO,MAAM,CAAEC,IAAI,IAAKA,IAAI,CAACC,WAAW,EAAE,IAAID,IAAI,CAACE,IAAI,KAAK,cAAc,CAAC,CACpEC,GAAG,CAAEC,GAAG,IAAKC,eAAI,CAACC,IAAI,CAAChB,OAAO,EAAEc,GAAG,CAACF,IAAI,CAAC,CAAC,CAC1CH,MAAM,CAAEQ,OAAO,IAAK,CAAChB,gBAAgB,CAACgB,OAAO,CAAC,CAAC,CAC/CJ,GAAG,CAAC,MAAOI,OAAO,IAAK;IACtB,IAAI;MACFX,mBAAmB,CAACW,OAAO,CAAC,GAAG,MAAMd,kBAAE,CAACe,QAAQ,CAACH,eAAI,CAACC,IAAI,CAACC,OAAO,EAAE,cAAc,CAAC,CAAC;IACtF,CAAC,CAAC,OAAOE,GAAQ,EAAE;MACjB,IAAIA,GAAG,CAACC,IAAI,KAAK,QAAQ,EAAE,MAAMD,GAAG;IACtC;EACF,CAAC,CAAC,CACL;EACD,OAAOb,mBAAmB;AAC5B"}