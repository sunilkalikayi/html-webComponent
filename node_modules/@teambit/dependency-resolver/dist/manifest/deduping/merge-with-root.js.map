{"version":3,"names":["mergeWithRootDeps","rootDependencies","dedupedDependencies","forEachObjIndexed","mergeSpecificLifeCycleRootDepsToDedupedDependencies","deps","depKeyName","mergeRootDepToDedupedDependencies","range","depId","isDepExistInAnyOfTheRootDedupedDependencies","existingRootDeps","toString","rootDedupedDeps","isDepExistInDepObject","dependencies","devDependencies","peerDependencies","depObjectValue"],"sources":["merge-with-root.ts"],"sourcesContent":["import forEachObjIndexed from 'ramda/src/forEachObjIndexed';\nimport { SemVer } from 'semver';\n\nimport { PackageName } from '../../dependencies';\nimport { ManifestDependenciesObject, ManifestDependenciesKeysNames, DepObjectValue } from '../manifest';\nimport { DedupedDependencies } from './dedupe-dependencies';\n\n/**\n * This is the third phase of the deduping process\n * It's not exactly part of the dedupe process but its required for the bit install to work properly\n * it will take the deduped dependencies and will add them missing deps from the provided root deps\n * it used for installing deps in the root level before any component use it\n * otherwise they won't be install, and you will need to re-run install after writing the require statement in the code\n *\n * @returns {DedupedDependencies}\n */\nexport function mergeWithRootDeps(\n  rootDependencies: ManifestDependenciesObject,\n  dedupedDependencies: DedupedDependencies\n): DedupedDependencies {\n  forEachObjIndexed(mergeSpecificLifeCycleRootDepsToDedupedDependencies(dedupedDependencies), rootDependencies);\n  return dedupedDependencies;\n}\n\nfunction mergeSpecificLifeCycleRootDepsToDedupedDependencies(dedupedDependencies: DedupedDependencies) {\n  return (deps: DepObjectValue, depKeyName: ManifestDependenciesKeysNames) => {\n    forEachObjIndexed(mergeRootDepToDedupedDependencies(dedupedDependencies, depKeyName), deps);\n  };\n}\n\nfunction mergeRootDepToDedupedDependencies(\n  dedupedDependencies: DedupedDependencies,\n  depKeyName: ManifestDependenciesKeysNames\n) {\n  return (range: SemVer, depId: PackageName) => {\n    // Do not add it if it's already exist from the components calculation\n    if (isDepExistInAnyOfTheRootDedupedDependencies(depId, dedupedDependencies)) return;\n    const existingRootDeps = dedupedDependencies.rootDependencies;\n    if (existingRootDeps[depKeyName]) {\n      // @ts-ignore - for some reason ts thinks it might be undefined\n      existingRootDeps[depKeyName][depId] = range.toString();\n    } else {\n      existingRootDeps[depKeyName] = {\n        [depId]: range.toString(),\n      };\n    }\n  };\n}\n\nfunction isDepExistInAnyOfTheRootDedupedDependencies(depId: string, dedupedDependencies: DedupedDependencies) {\n  const rootDedupedDeps = dedupedDependencies.rootDependencies;\n  return (\n    isDepExistInDepObject(depId, rootDedupedDeps.dependencies) ||\n    isDepExistInDepObject(depId, rootDedupedDeps.devDependencies) ||\n    isDepExistInDepObject(depId, rootDedupedDeps.peerDependencies)\n  );\n}\n\nfunction isDepExistInDepObject(depId: string, depObjectValue: DepObjectValue = {}) {\n  return !!depObjectValue[depId];\n}\n"],"mappings":";;;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASA,iBAAiB,CAC/BC,gBAA4C,EAC5CC,mBAAwC,EACnB;EACrB,IAAAC,4BAAiB,EAACC,mDAAmD,CAACF,mBAAmB,CAAC,EAAED,gBAAgB,CAAC;EAC7G,OAAOC,mBAAmB;AAC5B;AAEA,SAASE,mDAAmD,CAACF,mBAAwC,EAAE;EACrG,OAAO,CAACG,IAAoB,EAAEC,UAAyC,KAAK;IAC1E,IAAAH,4BAAiB,EAACI,iCAAiC,CAACL,mBAAmB,EAAEI,UAAU,CAAC,EAAED,IAAI,CAAC;EAC7F,CAAC;AACH;AAEA,SAASE,iCAAiC,CACxCL,mBAAwC,EACxCI,UAAyC,EACzC;EACA,OAAO,CAACE,KAAa,EAAEC,KAAkB,KAAK;IAC5C;IACA,IAAIC,2CAA2C,CAACD,KAAK,EAAEP,mBAAmB,CAAC,EAAE;IAC7E,MAAMS,gBAAgB,GAAGT,mBAAmB,CAACD,gBAAgB;IAC7D,IAAIU,gBAAgB,CAACL,UAAU,CAAC,EAAE;MAChC;MACAK,gBAAgB,CAACL,UAAU,CAAC,CAACG,KAAK,CAAC,GAAGD,KAAK,CAACI,QAAQ,EAAE;IACxD,CAAC,MAAM;MACLD,gBAAgB,CAACL,UAAU,CAAC,GAAG;QAC7B,CAACG,KAAK,GAAGD,KAAK,CAACI,QAAQ;MACzB,CAAC;IACH;EACF,CAAC;AACH;AAEA,SAASF,2CAA2C,CAACD,KAAa,EAAEP,mBAAwC,EAAE;EAC5G,MAAMW,eAAe,GAAGX,mBAAmB,CAACD,gBAAgB;EAC5D,OACEa,qBAAqB,CAACL,KAAK,EAAEI,eAAe,CAACE,YAAY,CAAC,IAC1DD,qBAAqB,CAACL,KAAK,EAAEI,eAAe,CAACG,eAAe,CAAC,IAC7DF,qBAAqB,CAACL,KAAK,EAAEI,eAAe,CAACI,gBAAgB,CAAC;AAElE;AAEA,SAASH,qBAAqB,CAACL,KAAa,EAAES,cAA8B,GAAG,CAAC,CAAC,EAAE;EACjF,OAAO,CAAC,CAACA,cAAc,CAACT,KAAK,CAAC;AAChC"}