{"version":3,"names":["describe","it","updatedWorkspacePolicyEntries","applyUpdates","name","latestRange","source","targetField","variantPoliciesByPatterns","componentPoliciesById","expect","toStrictEqual","dependencyId","value","version","lifecycleType","updateExisting","variant1","dependencies","resolveFromEnv","devDependencies","peerDependencies","variant2","variant3","variantPattern","component1","componentId"],"sources":["apply-updates.spec.ts"],"sourcesContent":["import { applyUpdates } from './apply-updates';\n\ndescribe('applyUpdates()', () => {\n  it('should apply updates on root dependencies', () => {\n    const { updatedWorkspacePolicyEntries } = applyUpdates(\n      [\n        {\n          name: 'lodash',\n          latestRange: '2.0.0',\n          source: 'rootPolicy',\n          targetField: 'dependencies' as const,\n        },\n        {\n          name: 'react-dom',\n          latestRange: '2.0.0',\n          source: 'rootPolicy',\n          targetField: 'peerDependencies' as const,\n        },\n      ],\n      {\n        variantPoliciesByPatterns: {},\n        componentPoliciesById: {},\n      }\n    );\n    // @ts-ignore\n    expect(updatedWorkspacePolicyEntries).toStrictEqual(\n      [\n        {\n          dependencyId: 'lodash',\n          value: {\n            version: '2.0.0',\n          },\n          lifecycleType: 'runtime',\n        },\n        {\n          dependencyId: 'react-dom',\n          value: {\n            version: '2.0.0',\n          },\n          lifecycleType: 'peer',\n        },\n      ],\n      { updateExisting: true }\n    );\n  });\n  it('should apply updates on variant dependencies', () => {\n    const variantPoliciesByPatterns = {\n      variant1: {\n        dependencies: {\n          'variant1-runtime-dep1': { version: '1.0.0', resolveFromEnv: true },\n          'variant1-runtime-dep2': '1.0.0',\n        },\n        devDependencies: {\n          'variant1-dev-dep1': '1.0.0',\n          'variant1-dev-dep2': '1.0.0',\n        },\n        peerDependencies: {\n          'variant1-peer-dep1': '1.0.0',\n          'variant1-peer-dep2': '1.0.0',\n        },\n      },\n      variant2: {\n        dependencies: {\n          'variant2-runtime-dep1': '1.0.0',\n          'variant2-runtime-dep2': '1.0.0',\n        },\n        devDependencies: {\n          'variant2-dev-dep1': '1.0.0',\n          'variant2-dev-dep2': '1.0.0',\n        },\n        peerDependencies: {\n          'variant2-peer-dep1': '1.0.0',\n          'variant2-peer-dep2': '1.0.0',\n        },\n      },\n      variant3: {\n        dependencies: {\n          'variant3-runtime-dep1': '1.0.0',\n          'variant3-runtime-dep2': '1.0.0',\n        },\n        devDependencies: {\n          'variant3-dev-dep1': '1.0.0',\n          'variant3-dev-dep2': '1.0.0',\n        },\n        peerDependencies: {\n          'variant3-peer-dep1': '1.0.0',\n          'variant3-peer-dep2': '1.0.0',\n        },\n      },\n    };\n    applyUpdates(\n      [\n        {\n          name: 'variant1-runtime-dep1',\n          latestRange: '2.0.0',\n          source: 'variants',\n          variantPattern: 'variant1',\n          targetField: 'dependencies',\n        },\n        {\n          name: 'variant2-dev-dep1',\n          latestRange: '2.0.0',\n          source: 'variants',\n          variantPattern: 'variant2',\n          targetField: 'devDependencies',\n        },\n        {\n          name: 'variant3-peer-dep1',\n          latestRange: '2.0.0',\n          source: 'variants',\n          variantPattern: 'variant3',\n          targetField: 'peerDependencies',\n        },\n      ],\n      {\n        variantPoliciesByPatterns,\n        componentPoliciesById: {},\n      }\n    );\n    // @ts-ignore\n    expect(variantPoliciesByPatterns.variant1).toStrictEqual({\n      dependencies: {\n        'variant1-runtime-dep1': { version: '2.0.0', resolveFromEnv: true },\n        'variant1-runtime-dep2': '1.0.0',\n      },\n      devDependencies: {\n        'variant1-dev-dep1': '1.0.0',\n        'variant1-dev-dep2': '1.0.0',\n      },\n      peerDependencies: {\n        'variant1-peer-dep1': '1.0.0',\n        'variant1-peer-dep2': '1.0.0',\n      },\n    });\n    // @ts-ignore\n    expect(variantPoliciesByPatterns.variant2).toStrictEqual({\n      dependencies: {\n        'variant2-runtime-dep1': '1.0.0',\n        'variant2-runtime-dep2': '1.0.0',\n      },\n      devDependencies: {\n        'variant2-dev-dep1': '2.0.0',\n        'variant2-dev-dep2': '1.0.0',\n      },\n      peerDependencies: {\n        'variant2-peer-dep1': '1.0.0',\n        'variant2-peer-dep2': '1.0.0',\n      },\n    });\n    // @ts-ignore\n    expect(variantPoliciesByPatterns.variant3).toStrictEqual({\n      dependencies: {\n        'variant3-runtime-dep1': '1.0.0',\n        'variant3-runtime-dep2': '1.0.0',\n      },\n      devDependencies: {\n        'variant3-dev-dep1': '1.0.0',\n        'variant3-dev-dep2': '1.0.0',\n      },\n      peerDependencies: {\n        'variant3-peer-dep1': '2.0.0',\n        'variant3-peer-dep2': '1.0.0',\n      },\n    });\n  });\n  it('should apply updates on component dependencies', () => {\n    const componentPoliciesById = {\n      component1: {\n        dependencies: {\n          'component1-runtime-dep1': { version: '1.0.0', resolveFromEnv: true },\n          'component1-runtime-dep2': '1.0.0',\n        },\n        devDependencies: {\n          'component1-dev-dep1': '1.0.0',\n          'component1-dev-dep2': '1.0.0',\n        },\n        peerDependencies: {\n          'component1-peer-dep1': '1.0.0',\n          'component1-peer-dep2': '1.0.0',\n        },\n      },\n    };\n    applyUpdates(\n      [\n        {\n          name: 'component1-runtime-dep1',\n          latestRange: '2.0.0',\n          source: 'component',\n          componentId: 'component1',\n          targetField: 'dependencies',\n        },\n        {\n          name: 'component1-dev-dep1',\n          latestRange: '2.0.0',\n          source: 'component',\n          componentId: 'component1',\n          targetField: 'devDependencies',\n        },\n        {\n          name: 'component1-peer-dep1',\n          latestRange: '2.0.0',\n          source: 'component',\n          componentId: 'component1',\n          targetField: 'peerDependencies',\n        },\n      ],\n      {\n        variantPoliciesByPatterns: {},\n        componentPoliciesById,\n      }\n    );\n    // @ts-ignore\n    expect(componentPoliciesById).toStrictEqual({\n      component1: {\n        dependencies: {\n          'component1-runtime-dep1': { version: '2.0.0', resolveFromEnv: true },\n          'component1-runtime-dep2': '1.0.0',\n        },\n        devDependencies: {\n          'component1-dev-dep1': '2.0.0',\n          'component1-dev-dep2': '1.0.0',\n        },\n        peerDependencies: {\n          'component1-peer-dep1': '2.0.0',\n          'component1-peer-dep2': '1.0.0',\n        },\n      },\n    });\n  });\n});\n"],"mappings":"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"}