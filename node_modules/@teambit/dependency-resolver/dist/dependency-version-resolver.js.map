{"version":3,"names":["DEFAULT_REMOTE_RESOLVE_VERSIONS","fetchToCache","update","DependencyVersionResolver","constructor","packageManager","cacheRootDir","networkConcurrency","limitRequests","pLimit","resolveRemoteVersion","packageName","options","calculatedOpts","Object","assign","resolved"],"sources":["dependency-version-resolver.ts"],"sourcesContent":["import { PathAbsolute } from '@teambit/legacy/dist/utils/path';\nimport pLimit from 'p-limit';\n\nimport { PackageManager, PackageManagerResolveRemoteVersionOptions, ResolvedPackageVersion } from './package-manager';\n\nconst DEFAULT_REMOTE_RESOLVE_VERSIONS = {\n  fetchToCache: true,\n  update: true,\n};\n\nexport class DependencyVersionResolver {\n  private limitRequests: pLimit.Limit;\n\n  constructor(\n    /**\n     * package manager instance.\n     */\n    private packageManager: PackageManager,\n\n    private cacheRootDir?: string | PathAbsolute,\n\n    networkConcurrency?: number\n  ) {\n    this.limitRequests = pLimit(networkConcurrency ?? 16);\n  }\n\n  async resolveRemoteVersion(\n    packageName: string,\n    options: PackageManagerResolveRemoteVersionOptions\n  ): Promise<ResolvedPackageVersion> {\n    // Make sure to take other default if passed options with only one option\n    const calculatedOpts = Object.assign(\n      {},\n      DEFAULT_REMOTE_RESOLVE_VERSIONS,\n      { cacheRootDir: this.cacheRootDir },\n      options\n    );\n    // TODO: the cache should be probably passed to the package manager constructor not to the install function\n    const resolved = this.limitRequests(() => this.packageManager.resolveRemoteVersion(packageName, calculatedOpts));\n    return resolved;\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAIA,MAAMA,+BAA+B,GAAG;EACtCC,YAAY,EAAE,IAAI;EAClBC,MAAM,EAAE;AACV,CAAC;AAEM,MAAMC,yBAAyB,CAAC;EAGrCC,WAAW;EACT;AACJ;AACA;EACYC,cAA8B,EAE9BC,YAAoC,EAE5CC,kBAA2B,EAC3B;IAAA,KALQF,cAA8B,GAA9BA,cAA8B;IAAA,KAE9BC,YAAoC,GAApCA,YAAoC;IAAA;IAI5C,IAAI,CAACE,aAAa,GAAG,IAAAC,iBAAM,EAACF,kBAAkB,aAAlBA,kBAAkB,cAAlBA,kBAAkB,GAAI,EAAE,CAAC;EACvD;EAEA,MAAMG,oBAAoB,CACxBC,WAAmB,EACnBC,OAAkD,EACjB;IACjC;IACA,MAAMC,cAAc,GAAGC,MAAM,CAACC,MAAM,CAClC,CAAC,CAAC,EACFf,+BAA+B,EAC/B;MAAEM,YAAY,EAAE,IAAI,CAACA;IAAa,CAAC,EACnCM,OAAO,CACR;IACD;IACA,MAAMI,QAAQ,GAAG,IAAI,CAACR,aAAa,CAAC,MAAM,IAAI,CAACH,cAAc,CAACK,oBAAoB,CAACC,WAAW,EAAEE,cAAc,CAAC,CAAC;IAChH,OAAOG,QAAQ;EACjB;AACF;AAAC"}