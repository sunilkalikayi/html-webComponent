{"version":3,"names":["WorkspacePolicyFactory","fromConfigObject","configObject","WorkspacePolicy","runtimeEntries","entriesFromKey","peerEntries","entries","concat","fromPackageJson","packageJson","obj","dependencies","devDependencies","peerDependencies","keyName","lifecycleType","LIFECYCLE_TYPE_BY_KEY_NAME","Object","map","depId","value","createEntry","version","preserve","entryValue","entry","dependencyId"],"sources":["workspace-policy-factory.ts"],"sourcesContent":["import {\n  WorkspacePolicy,\n  WorkspacePolicyConfigObject,\n  WorkspacePolicyConfigKeysNames,\n  WorkspacePolicyEntry,\n  WorkspacePolicyConfigEntryValue,\n  WorkspacePolicyEntryValue,\n} from './workspace-policy';\nimport { LIFECYCLE_TYPE_BY_KEY_NAME, WorkspaceDependencyLifecycleType } from '../../dependencies';\n\nexport class WorkspacePolicyFactory {\n  fromConfigObject(configObject: WorkspacePolicyConfigObject): WorkspacePolicy {\n    if (!configObject) {\n      return new WorkspacePolicy([]);\n    }\n    const runtimeEntries = entriesFromKey(configObject, 'dependencies');\n    const peerEntries = entriesFromKey(configObject, 'peerDependencies');\n    const entries = runtimeEntries.concat(peerEntries);\n    return new WorkspacePolicy(entries);\n  }\n\n  fromPackageJson(packageJson: Record<string, any>) {\n    const obj = {\n      dependencies: {\n        ...(packageJson.devDependencies || {}),\n        ...(packageJson.dependencies || {}),\n      },\n      peerDependencies: {\n        ...(packageJson.peerDependencies || {}),\n      },\n    };\n    return this.fromConfigObject(obj);\n  }\n}\n\nfunction entriesFromKey(\n  configObject: WorkspacePolicyConfigObject,\n  keyName: WorkspacePolicyConfigKeysNames\n): WorkspacePolicyEntry[] {\n  const obj = configObject[keyName];\n  if (!obj) {\n    return [];\n  }\n  const lifecycleType = LIFECYCLE_TYPE_BY_KEY_NAME[keyName];\n  const entries = Object.entries(obj).map(([depId, value]: [string, WorkspacePolicyConfigEntryValue]) => {\n    return createEntry(depId, value, lifecycleType);\n  });\n  return entries;\n}\n\nfunction createEntry(\n  depId: string,\n  value: WorkspacePolicyConfigEntryValue,\n  lifecycleType: WorkspaceDependencyLifecycleType\n): WorkspacePolicyEntry {\n  const version = typeof value === 'string' ? value : value.version;\n  const preserve = typeof value === 'string' ? false : value.preserve;\n  const entryValue: WorkspacePolicyEntryValue = {\n    version,\n    preserve,\n  };\n  const entry: WorkspacePolicyEntry = {\n    dependencyId: depId,\n    value: entryValue,\n    lifecycleType,\n  };\n  return entry;\n}\n"],"mappings":";;;;;;;;;;;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAQA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAAkG;AAAA;AAE3F,MAAMA,sBAAsB,CAAC;EAClCC,gBAAgB,CAACC,YAAyC,EAAmB;IAC3E,IAAI,CAACA,YAAY,EAAE;MACjB,OAAO,KAAIC,kCAAe,EAAC,EAAE,CAAC;IAChC;IACA,MAAMC,cAAc,GAAGC,cAAc,CAACH,YAAY,EAAE,cAAc,CAAC;IACnE,MAAMI,WAAW,GAAGD,cAAc,CAACH,YAAY,EAAE,kBAAkB,CAAC;IACpE,MAAMK,OAAO,GAAGH,cAAc,CAACI,MAAM,CAACF,WAAW,CAAC;IAClD,OAAO,KAAIH,kCAAe,EAACI,OAAO,CAAC;EACrC;EAEAE,eAAe,CAACC,WAAgC,EAAE;IAChD,MAAMC,GAAG,GAAG;MACVC,YAAY,kCACNF,WAAW,CAACG,eAAe,IAAI,CAAC,CAAC,GACjCH,WAAW,CAACE,YAAY,IAAI,CAAC,CAAC,CACnC;MACDE,gBAAgB,oBACVJ,WAAW,CAACI,gBAAgB,IAAI,CAAC,CAAC;IAE1C,CAAC;IACD,OAAO,IAAI,CAACb,gBAAgB,CAACU,GAAG,CAAC;EACnC;AACF;AAAC;AAED,SAASN,cAAc,CACrBH,YAAyC,EACzCa,OAAuC,EACf;EACxB,MAAMJ,GAAG,GAAGT,YAAY,CAACa,OAAO,CAAC;EACjC,IAAI,CAACJ,GAAG,EAAE;IACR,OAAO,EAAE;EACX;EACA,MAAMK,aAAa,GAAGC,0CAA0B,CAACF,OAAO,CAAC;EACzD,MAAMR,OAAO,GAAGW,MAAM,CAACX,OAAO,CAACI,GAAG,CAAC,CAACQ,GAAG,CAAC,CAAC,CAACC,KAAK,EAAEC,KAAK,CAA4C,KAAK;IACrG,OAAOC,WAAW,CAACF,KAAK,EAAEC,KAAK,EAAEL,aAAa,CAAC;EACjD,CAAC,CAAC;EACF,OAAOT,OAAO;AAChB;AAEA,SAASe,WAAW,CAClBF,KAAa,EACbC,KAAsC,EACtCL,aAA+C,EACzB;EACtB,MAAMO,OAAO,GAAG,OAAOF,KAAK,KAAK,QAAQ,GAAGA,KAAK,GAAGA,KAAK,CAACE,OAAO;EACjE,MAAMC,QAAQ,GAAG,OAAOH,KAAK,KAAK,QAAQ,GAAG,KAAK,GAAGA,KAAK,CAACG,QAAQ;EACnE,MAAMC,UAAqC,GAAG;IAC5CF,OAAO;IACPC;EACF,CAAC;EACD,MAAME,KAA2B,GAAG;IAClCC,YAAY,EAAEP,KAAK;IACnBC,KAAK,EAAEI,UAAU;IACjBT;EACF,CAAC;EACD,OAAOU,KAAK;AACd"}