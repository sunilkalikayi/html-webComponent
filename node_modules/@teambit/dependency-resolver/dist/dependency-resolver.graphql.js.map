{"version":3,"names":["DependencyTypes","dependencyResolverSchema","dependencyResolver","typeDefs","gql","resolvers","Component","componentPolicy","component","variantPolicy","getPolicy","serialize","dependencies","dependenciesList","getDependencies","serialized","map","type","__type","__typename","Dependency","__resolveType","dependency"],"sources":["dependency-resolver.graphql.ts"],"sourcesContent":["import { Component } from '@teambit/component';\nimport { Schema } from '@teambit/graphql';\nimport gql from 'graphql-tag';\n\nimport { DependencyResolverMain } from './dependency-resolver.main.runtime';\nimport { Dependency } from './dependencies';\n\nenum DependencyTypes {\n  component = 'ComponentDependency',\n  package = 'PackageDependency',\n}\n\nexport function dependencyResolverSchema(dependencyResolver: DependencyResolverMain): Schema {\n  return {\n    typeDefs: gql`\n      interface Dependency {\n        id: String!\n        version: String!\n        lifecycle: String!\n        type: String!\n        packageName: String # TODO - remove this after resolving the issue with apollo client when packages dont get packageName\n      }\n      # union Dependency = PackageDependency | ComponentDependency\n\n      type ComponentIdObject {\n        scope: String!\n        name: String!\n        version: String!\n      }\n\n      type PackageDependency implements Dependency {\n        id: String!\n        version: String!\n        lifecycle: String!\n        type: String!\n        packageName: String # TODO - remove this after resolving the issue with apollo client when packages dont get packageName\n      }\n\n      type ComponentDependency implements Dependency {\n        id: String!\n        version: String!\n        lifecycle: String!\n        isExtension: Boolean!\n        packageName: String!\n        type: String!\n      }\n\n      type PolicyValue {\n        version: String!\n        resolveFromEnv: Boolean\n      }\n\n      type Policy {\n        dependencyId: String!\n        lifecycleType: String!\n        value: PolicyValue!\n      }\n\n      extend type Component {\n        dependencies: [Dependency]\n        componentPolicy: [Policy]\n      }\n    `,\n    resolvers: {\n      Component: {\n        componentPolicy: async (component: Component) => {\n          const variantPolicy = await dependencyResolver.getPolicy(component);\n          return variantPolicy.serialize();\n        },\n        dependencies: async (component: Component) => {\n          const dependenciesList = await dependencyResolver.getDependencies(component);\n          const serialized = dependenciesList.serialize();\n          return serialized.map((serialize) => {\n            const type = DependencyTypes[serialize.__type];\n            // @ts-ignore\n            serialize.type = serialize.__type;\n            // @ts-ignore\n            delete serialize.__type;\n            return {\n              __typename: type,\n              ...serialize,\n            };\n          });\n        },\n        Dependency: {\n          __resolveType: (dependency: Dependency) => {\n            return DependencyTypes[dependency.type];\n          },\n        },\n      },\n    },\n  };\n}\n"],"mappings":";;;;;;;;;;;;;;;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAA8B;AAAA;AAAA,IAKzBA,eAAe;AAAA,WAAfA,eAAe;EAAfA,eAAe;EAAfA,eAAe;AAAA,GAAfA,eAAe,KAAfA,eAAe;AAKb,SAASC,wBAAwB,CAACC,kBAA0C,EAAU;EAC3F,OAAO;IACLC,QAAQ,EAAE,IAAAC,qBAAG,CAAC;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;IACDC,SAAS,EAAE;MACTC,SAAS,EAAE;QACTC,eAAe,EAAE,MAAOC,SAAoB,IAAK;UAC/C,MAAMC,aAAa,GAAG,MAAMP,kBAAkB,CAACQ,SAAS,CAACF,SAAS,CAAC;UACnE,OAAOC,aAAa,CAACE,SAAS,EAAE;QAClC,CAAC;QACDC,YAAY,EAAE,MAAOJ,SAAoB,IAAK;UAC5C,MAAMK,gBAAgB,GAAG,MAAMX,kBAAkB,CAACY,eAAe,CAACN,SAAS,CAAC;UAC5E,MAAMO,UAAU,GAAGF,gBAAgB,CAACF,SAAS,EAAE;UAC/C,OAAOI,UAAU,CAACC,GAAG,CAAEL,SAAS,IAAK;YACnC,MAAMM,IAAI,GAAGjB,eAAe,CAACW,SAAS,CAACO,MAAM,CAAC;YAC9C;YACAP,SAAS,CAACM,IAAI,GAAGN,SAAS,CAACO,MAAM;YACjC;YACA,OAAOP,SAAS,CAACO,MAAM;YACvB;cACEC,UAAU,EAAEF;YAAI,GACbN,SAAS;UAEhB,CAAC,CAAC;QACJ,CAAC;QACDS,UAAU,EAAE;UACVC,aAAa,EAAGC,UAAsB,IAAK;YACzC,OAAOtB,eAAe,CAACsB,UAAU,CAACL,IAAI,CAAC;UACzC;QACF;MACF;IACF;EACF,CAAC;AACH"}