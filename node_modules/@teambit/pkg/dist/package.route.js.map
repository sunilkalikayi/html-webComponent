{"version":3,"names":["routePath","PackageRoute","constructor","pkg","req","res","component","file","getPackageTarFile","status","jsonp","error","contents","contentType","mime","getType","set","basename","send"],"sources":["package.route.ts"],"sourcesContent":["import { Request, Response, Route } from '@teambit/express';\nimport mime from 'mime';\n\nimport { PkgMain } from './pkg.main.runtime';\n\nexport const routePath = `package`;\nexport class PackageRoute implements Route {\n  constructor(\n    /**\n     * pkg extension.\n     */\n    private pkg: PkgMain\n  ) {}\n\n  route = `/${routePath}`;\n  method = 'get';\n\n  middlewares = [\n    async (req: Request, res: Response) => {\n      // @ts-ignore TODO: @guy please fix.\n      const component: any = req.component as any;\n      const file = await this.pkg.getPackageTarFile(component);\n      // TODO: 404 again how to handle.\n      if (!file) return res.status(404).jsonp({ error: 'not found' });\n      const contents = file.contents;\n      const contentType = mime.getType('.tgz');\n      res.set('Content-disposition', `attachment; filename=${file.basename}`);\n      if (contentType) res.set('Content-Type', contentType);\n      return res.send(contents);\n    },\n  ];\n}\n"],"mappings":";;;;;;;;;;;;;;;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAIO,MAAMA,SAAS,GAAI,SAAQ;AAAC;AAC5B,MAAMC,YAAY,CAAkB;EACzCC,WAAW;EACT;AACJ;AACA;EACYC,GAAY,EACpB;IAAA,KADQA,GAAY,GAAZA,GAAY;IAAA,+CAGb,IAAGH,SAAU,EAAC;IAAA,gDACd,KAAK;IAAA,qDAEA,CACZ,OAAOI,GAAY,EAAEC,GAAa,KAAK;MACrC;MACA,MAAMC,SAAc,GAAGF,GAAG,CAACE,SAAgB;MAC3C,MAAMC,IAAI,GAAG,MAAM,IAAI,CAACJ,GAAG,CAACK,iBAAiB,CAACF,SAAS,CAAC;MACxD;MACA,IAAI,CAACC,IAAI,EAAE,OAAOF,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAACC,KAAK,CAAC;QAAEC,KAAK,EAAE;MAAY,CAAC,CAAC;MAC/D,MAAMC,QAAQ,GAAGL,IAAI,CAACK,QAAQ;MAC9B,MAAMC,WAAW,GAAGC,eAAI,CAACC,OAAO,CAAC,MAAM,CAAC;MACxCV,GAAG,CAACW,GAAG,CAAC,qBAAqB,EAAG,wBAAuBT,IAAI,CAACU,QAAS,EAAC,CAAC;MACvE,IAAIJ,WAAW,EAAER,GAAG,CAACW,GAAG,CAAC,cAAc,EAAEH,WAAW,CAAC;MACrD,OAAOR,GAAG,CAACa,IAAI,CAACN,QAAQ,CAAC;IAC3B,CAAC,CACF;EAlBE;AAmBL;AAAC"}