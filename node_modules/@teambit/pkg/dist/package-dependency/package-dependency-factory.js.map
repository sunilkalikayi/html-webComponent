{"version":3,"names":["TYPE","PackageDependencyFactory","constructor","type","parse","serialized","PackageDependency","id","version","lifecycle","source","fromLegacyComponent","legacyComponent","runtimePackageDeps","transformLegacyComponentPackageDepsToSerializedDependency","packageDependencies","devPackageDeps","devPackageDependencies","peerPackageDeps","peerPackageDependencies","serializedPackageDeps","concat","packageDepsP","map","dep","packageDeps","Promise","all","dependencyList","DependencyList","packageDepObj","res","Object","entries","packageName","__type"],"sources":["package-dependency-factory.ts"],"sourcesContent":["import {\n  DependencyLifecycleType,\n  SerializedDependency,\n  DependencyFactory,\n  DependencyList,\n} from '@teambit/dependency-resolver';\nimport LegacyComponent from '@teambit/legacy/dist/consumer/component';\nimport { PackageDependency, SerializedPackageDependency } from './package-dependency';\n\nconst TYPE = 'package';\n// TODO: think about where is the right place to put this\nexport class PackageDependencyFactory implements DependencyFactory {\n  // parse<PackageDependency, SerializedDependency>(serialized: SerializedDependency): PackageDependency {\n  //   return new PackageDependency(serialized.id, serialized.version, serialized.type, serialized.lifecycle as DependencyLifecycleType);\n  // }\n  type: string;\n\n  constructor() {\n    this.type = TYPE;\n  }\n\n  async parse<PackageDependency, S extends SerializedDependency>(serialized: S): Promise<PackageDependency> {\n    // return new PackageDependency(serialized.id, serialized.version, serialized.type, serialized.lifecycle as DependencyLifecycleType) as unknown as PackageDependency;\n    return new PackageDependency(\n      serialized.id,\n      serialized.version,\n      serialized.lifecycle as DependencyLifecycleType,\n      serialized.source\n    ) as unknown as PackageDependency;\n  }\n\n  async fromLegacyComponent(legacyComponent: LegacyComponent): Promise<DependencyList> {\n    const runtimePackageDeps = transformLegacyComponentPackageDepsToSerializedDependency(\n      legacyComponent.packageDependencies,\n      'runtime'\n    );\n    const devPackageDeps = transformLegacyComponentPackageDepsToSerializedDependency(\n      legacyComponent.devPackageDependencies,\n      'dev'\n    );\n    const peerPackageDeps = transformLegacyComponentPackageDepsToSerializedDependency(\n      legacyComponent.peerPackageDependencies,\n      'peer'\n    );\n\n    const serializedPackageDeps = runtimePackageDeps.concat(devPackageDeps).concat(peerPackageDeps);\n    const packageDepsP: Promise<PackageDependency>[] = serializedPackageDeps.map((dep) => this.parse(dep));\n    const packageDeps: PackageDependency[] = await Promise.all(packageDepsP);\n    const dependencyList = new DependencyList(packageDeps);\n    return dependencyList;\n  }\n\n  // parse: <PackageDependency, SerializedDependency>(serialized: SerializedDependency) =>  {\n  //   return new PackageDependency(serialized.id, serialized.version, serialized.type, serialized.lifecycle as DependencyLifecycleType);\n  // }\n}\n\nfunction transformLegacyComponentPackageDepsToSerializedDependency(\n  packageDepObj: Record<string, string>,\n  lifecycle: DependencyLifecycleType\n): SerializedPackageDependency[] {\n  const res = Object.entries(packageDepObj).map(([packageName, version]) => {\n    return {\n      id: packageName,\n      version,\n      __type: TYPE,\n      lifecycle,\n    };\n  });\n  return res;\n}\n"],"mappings":";;;;;;;;;;;;;;;;AAAA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAOA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAEA,MAAMA,IAAI,GAAG,SAAS;AACtB;AACO,MAAMC,wBAAwB,CAA8B;EACjE;EACA;EACA;;EAGAC,WAAW,GAAG;IAAA;IACZ,IAAI,CAACC,IAAI,GAAGH,IAAI;EAClB;EAEA,MAAMI,KAAK,CAAoDC,UAAa,EAA8B;IACxG;IACA,OAAO,KAAIC,sCAAiB,EAC1BD,UAAU,CAACE,EAAE,EACbF,UAAU,CAACG,OAAO,EAClBH,UAAU,CAACI,SAAS,EACpBJ,UAAU,CAACK,MAAM,CAClB;EACH;EAEA,MAAMC,mBAAmB,CAACC,eAAgC,EAA2B;IACnF,MAAMC,kBAAkB,GAAGC,yDAAyD,CAClFF,eAAe,CAACG,mBAAmB,EACnC,SAAS,CACV;IACD,MAAMC,cAAc,GAAGF,yDAAyD,CAC9EF,eAAe,CAACK,sBAAsB,EACtC,KAAK,CACN;IACD,MAAMC,eAAe,GAAGJ,yDAAyD,CAC/EF,eAAe,CAACO,uBAAuB,EACvC,MAAM,CACP;IAED,MAAMC,qBAAqB,GAAGP,kBAAkB,CAACQ,MAAM,CAACL,cAAc,CAAC,CAACK,MAAM,CAACH,eAAe,CAAC;IAC/F,MAAMI,YAA0C,GAAGF,qBAAqB,CAACG,GAAG,CAAEC,GAAG,IAAK,IAAI,CAACpB,KAAK,CAACoB,GAAG,CAAC,CAAC;IACtG,MAAMC,WAAgC,GAAG,MAAMC,OAAO,CAACC,GAAG,CAACL,YAAY,CAAC;IACxE,MAAMM,cAAc,GAAG,KAAIC,oCAAc,EAACJ,WAAW,CAAC;IACtD,OAAOG,cAAc;EACvB;;EAEA;EACA;EACA;AACF;AAAC;AAED,SAASd,yDAAyD,CAChEgB,aAAqC,EACrCrB,SAAkC,EACH;EAC/B,MAAMsB,GAAG,GAAGC,MAAM,CAACC,OAAO,CAACH,aAAa,CAAC,CAACP,GAAG,CAAC,CAAC,CAACW,WAAW,EAAE1B,OAAO,CAAC,KAAK;IACxE,OAAO;MACLD,EAAE,EAAE2B,WAAW;MACf1B,OAAO;MACP2B,MAAM,EAAEnC,IAAI;MACZS;IACF,CAAC;EACH,CAAC,CAAC;EACF,OAAOsB,GAAG;AACZ"}