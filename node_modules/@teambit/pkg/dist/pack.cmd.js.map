{"version":3,"names":["PackCmd","constructor","packer","report","args","options","packResult","json","warnings","data","warningsOutput","map","warning","chalk","yellow","join","errors","errorsOutput","error","tarPathOutput","metadata","tarPath","green","id","componentId","scopePath","compId","scopePathStr","concreteOpts","writeOptions","outDir","override","prefix","keep","packComponent","code"],"sources":["pack.cmd.tsx"],"sourcesContent":["// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Command, CommandOptions } from '@teambit/cli';\nimport chalk from 'chalk';\n\nimport { Packer, PackOptions } from './packer';\n\ntype PackArgs = [string, string];\ntype PackCmdOptions = {\n  outDir?: string;\n  override?: boolean;\n  prefix?: boolean;\n  keep?: boolean;\n  // useCapsule?: boolean;\n};\n\nexport class PackCmd implements Command {\n  name = 'pack <componentId> [scopePath]';\n  description = 'create tar for npm publish';\n  options = [\n    ['d', 'out-dir <out-dir>', 'directory to put the result tar file'],\n    ['o', 'override', 'override existing pack file'],\n    ['k', 'keep', 'should keep isolated environment [default = false]'],\n    ['p', 'prefix', 'keep custom (binding) prefix'],\n    // ['c', 'use-capsule', 'isolate using the capsule and pack on the capsule'],\n    ['j', 'json', 'return the output as JSON'],\n  ] as CommandOptions;\n  alias = '';\n  group = 'collaborate';\n\n  constructor(private packer: Packer) {}\n\n  async report(args: PackArgs, options: PackCmdOptions) {\n    const packResult = await this.json(args, options);\n    const warnings: any = packResult.data?.warnings || [];\n    const warningsOutput: any = warnings.map((warning) => chalk.yellow(warning)).join('\\n');\n    const errors: any = packResult.data?.errors || [];\n    const errorsOutput: any = errors.map((error) => chalk.yellow(error)).join('\\n');\n    const tarPathOutput = packResult.data.metadata?.tarPath\n      ? chalk.green(`tar path for component ${packResult.data.id}: ${packResult.data.metadata?.tarPath}`)\n      : '';\n    return `${warningsOutput}\\n${errorsOutput}\\n${tarPathOutput}`;\n  }\n\n  async json([componentId, scopePath]: PackArgs, options: PackCmdOptions) {\n    const compId = typeof componentId === 'string' ? componentId : componentId[0];\n    let scopePathStr: string | undefined;\n    if (scopePath) {\n      scopePathStr = typeof scopePath !== 'string' ? scopePath[0] : scopePath;\n    }\n\n    const concreteOpts: PackOptions = {\n      writeOptions: {\n        outDir: options.outDir,\n        override: options.override,\n      },\n      prefix: options.prefix,\n      keep: options.keep,\n      // useCapsule: options.useCapsule,\n    };\n\n    const packResult = await this.packer.packComponent(compId, scopePathStr, concreteOpts);\n    return {\n      data: packResult,\n      code: 0,\n    };\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;AAEA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAFA;;AAeO,MAAMA,OAAO,CAAoB;EActCC,WAAW,CAASC,MAAc,EAAE;IAAA,KAAhBA,MAAc,GAAdA,MAAc;IAAA,8CAb3B,gCAAgC;IAAA,qDACzB,4BAA4B;IAAA,iDAChC,CACR,CAAC,GAAG,EAAE,mBAAmB,EAAE,sCAAsC,CAAC,EAClE,CAAC,GAAG,EAAE,UAAU,EAAE,6BAA6B,CAAC,EAChD,CAAC,GAAG,EAAE,MAAM,EAAE,oDAAoD,CAAC,EACnE,CAAC,GAAG,EAAE,QAAQ,EAAE,8BAA8B,CAAC;IAC/C;IACA,CAAC,GAAG,EAAE,MAAM,EAAE,2BAA2B,CAAC,CAC3C;IAAA,+CACO,EAAE;IAAA,+CACF,aAAa;EAEgB;EAErC,MAAMC,MAAM,CAACC,IAAc,EAAEC,OAAuB,EAAE;IAAA;IACpD,MAAMC,UAAU,GAAG,MAAM,IAAI,CAACC,IAAI,CAACH,IAAI,EAAEC,OAAO,CAAC;IACjD,MAAMG,QAAa,GAAG,qBAAAF,UAAU,CAACG,IAAI,qDAAf,iBAAiBD,QAAQ,KAAI,EAAE;IACrD,MAAME,cAAmB,GAAGF,QAAQ,CAACG,GAAG,CAAEC,OAAO,IAAKC,gBAAK,CAACC,MAAM,CAACF,OAAO,CAAC,CAAC,CAACG,IAAI,CAAC,IAAI,CAAC;IACvF,MAAMC,MAAW,GAAG,sBAAAV,UAAU,CAACG,IAAI,sDAAf,kBAAiBO,MAAM,KAAI,EAAE;IACjD,MAAMC,YAAiB,GAAGD,MAAM,CAACL,GAAG,CAAEO,KAAK,IAAKL,gBAAK,CAACC,MAAM,CAACI,KAAK,CAAC,CAAC,CAACH,IAAI,CAAC,IAAI,CAAC;IAC/E,MAAMI,aAAa,GAAG,yBAAAb,UAAU,CAACG,IAAI,CAACW,QAAQ,kDAAxB,sBAA0BC,OAAO,GACnDR,gBAAK,CAACS,KAAK,CAAE,0BAAyBhB,UAAU,CAACG,IAAI,CAACc,EAAG,KAAE,0BAAEjB,UAAU,CAACG,IAAI,CAACW,QAAQ,2DAAxB,uBAA0BC,OAAQ,EAAC,CAAC,GACjG,EAAE;IACN,OAAQ,GAAEX,cAAe,KAAIO,YAAa,KAAIE,aAAc,EAAC;EAC/D;EAEA,MAAMZ,IAAI,CAAC,CAACiB,WAAW,EAAEC,SAAS,CAAW,EAAEpB,OAAuB,EAAE;IACtE,MAAMqB,MAAM,GAAG,OAAOF,WAAW,KAAK,QAAQ,GAAGA,WAAW,GAAGA,WAAW,CAAC,CAAC,CAAC;IAC7E,IAAIG,YAAgC;IACpC,IAAIF,SAAS,EAAE;MACbE,YAAY,GAAG,OAAOF,SAAS,KAAK,QAAQ,GAAGA,SAAS,CAAC,CAAC,CAAC,GAAGA,SAAS;IACzE;IAEA,MAAMG,YAAyB,GAAG;MAChCC,YAAY,EAAE;QACZC,MAAM,EAAEzB,OAAO,CAACyB,MAAM;QACtBC,QAAQ,EAAE1B,OAAO,CAAC0B;MACpB,CAAC;MACDC,MAAM,EAAE3B,OAAO,CAAC2B,MAAM;MACtBC,IAAI,EAAE5B,OAAO,CAAC4B;MACd;IACF,CAAC;;IAED,MAAM3B,UAAU,GAAG,MAAM,IAAI,CAACJ,MAAM,CAACgC,aAAa,CAACR,MAAM,EAAEC,YAAY,EAAEC,YAAY,CAAC;IACtF,OAAO;MACLnB,IAAI,EAAEH,UAAU;MAChB6B,IAAI,EAAE;IACR,CAAC;EACH;AACF;AAAC"}