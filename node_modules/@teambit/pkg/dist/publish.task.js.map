{"version":3,"names":["PublishTask","constructor","aspectId","publisher","logger","execute","context","options","dryRun","capsules","capsuleNetwork","seedersCapsules","capsulesToPublish","forEach","c","shouldPublish","component","config","extensions","push","info","length","publishResults","publishMultipleCapsules","componentsResults","artifacts"],"sources":["publish.task.ts"],"sourcesContent":["import { BuildContext, BuiltTaskResult, BuildTask, TaskLocation } from '@teambit/builder';\nimport { Logger } from '@teambit/logger';\nimport { Capsule } from '@teambit/isolator';\nimport { Publisher } from './publisher';\n\n/**\n * publish components by running \"npm publish\"\n */\nexport class PublishTask implements BuildTask {\n  readonly name = 'PublishComponents';\n  readonly location: TaskLocation = 'end';\n  constructor(readonly aspectId: string, private publisher: Publisher, private logger: Logger) {}\n\n  async execute(context: BuildContext): Promise<BuiltTaskResult> {\n    this.publisher.options.dryRun = false;\n    const capsules = context.capsuleNetwork.seedersCapsules;\n    // const capsulesToPublish = capsules.filter((c) => this.publisher.shouldPublish(c.component.config.extensions));\n    const capsulesToPublish: Capsule[] = [];\n    capsules.forEach((c) => {\n      const shouldPublish = this.publisher.shouldPublish(c.component.config.extensions);\n      if (shouldPublish) {\n        capsulesToPublish.push(c);\n      }\n    });\n    this.logger.info(`going to run publish on ${capsulesToPublish.length} out of ${capsules.length}`);\n    const publishResults = await this.publisher.publishMultipleCapsules(capsulesToPublish);\n\n    return {\n      componentsResults: publishResults,\n      artifacts: [],\n    };\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;AAKA;AACA;AACA;AACO,MAAMA,WAAW,CAAsB;EAG5CC,WAAW,CAAUC,QAAgB,EAAUC,SAAoB,EAAUC,MAAc,EAAE;IAAA,KAAxEF,QAAgB,GAAhBA,QAAgB;IAAA,KAAUC,SAAoB,GAApBA,SAAoB;IAAA,KAAUC,MAAc,GAAdA,MAAc;IAAA,8CAF3E,mBAAmB;IAAA,kDACD,KAAK;EACuD;EAE9F,MAAMC,OAAO,CAACC,OAAqB,EAA4B;IAC7D,IAAI,CAACH,SAAS,CAACI,OAAO,CAACC,MAAM,GAAG,KAAK;IACrC,MAAMC,QAAQ,GAAGH,OAAO,CAACI,cAAc,CAACC,eAAe;IACvD;IACA,MAAMC,iBAA4B,GAAG,EAAE;IACvCH,QAAQ,CAACI,OAAO,CAAEC,CAAC,IAAK;MACtB,MAAMC,aAAa,GAAG,IAAI,CAACZ,SAAS,CAACY,aAAa,CAACD,CAAC,CAACE,SAAS,CAACC,MAAM,CAACC,UAAU,CAAC;MACjF,IAAIH,aAAa,EAAE;QACjBH,iBAAiB,CAACO,IAAI,CAACL,CAAC,CAAC;MAC3B;IACF,CAAC,CAAC;IACF,IAAI,CAACV,MAAM,CAACgB,IAAI,CAAE,2BAA0BR,iBAAiB,CAACS,MAAO,WAAUZ,QAAQ,CAACY,MAAO,EAAC,CAAC;IACjG,MAAMC,cAAc,GAAG,MAAM,IAAI,CAACnB,SAAS,CAACoB,uBAAuB,CAACX,iBAAiB,CAAC;IAEtF,OAAO;MACLY,iBAAiB,EAAEF,cAAc;MACjCG,SAAS,EAAE;IACb,CAAC;EACH;AACF;AAAC"}