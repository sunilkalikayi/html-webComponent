{"version":3,"names":["setFunctionHandlers","transferHandlers","set","canHandle","obj","proxyMarker","serialize","port1","port2","MessageChannel","comlinkExpose","nodeEndpoint","deserialize","port","start","wrap","expose","object","parentPort"],"sources":["expose.ts"],"sourcesContent":["// eslint-disable-next-line import/no-unresolved\nimport { parentPort, MessageChannel } from 'worker_threads';\nimport { expose as comlinkExpose, proxyMarker, wrap, transferHandlers } from 'comlink';\nimport nodeEndpoint from './node-endpoint';\n\nexport function setFunctionHandlers() {\n  // Override comlink's default proxy handler to use Node endpoints\n  transferHandlers.set('proxy', {\n    canHandle: (obj) => obj && obj[proxyMarker],\n    serialize: (obj) => {\n      const { port1, port2 } = new MessageChannel();\n      comlinkExpose(obj, nodeEndpoint(port1));\n      return [port2, [port2]];\n    },\n    deserialize: (port: any) => {\n      port = nodeEndpoint(port);\n      port.start();\n      return wrap(port);\n    },\n  } as any);\n}\n\nsetFunctionHandlers();\n\nexport function expose(object: any) {\n  return comlinkExpose(object, nodeEndpoint(parentPort));\n}\n"],"mappings":";;;;;;;;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAHA;;AAKO,SAASA,mBAAmB,GAAG;EACpC;EACAC,2BAAgB,CAACC,GAAG,CAAC,OAAO,EAAE;IAC5BC,SAAS,EAAGC,GAAG,IAAKA,GAAG,IAAIA,GAAG,CAACC,sBAAW,CAAC;IAC3CC,SAAS,EAAGF,GAAG,IAAK;MAClB,MAAM;QAAEG,KAAK;QAAEC;MAAM,CAAC,GAAG,KAAIC,gCAAc,GAAE;MAC7C,IAAAC,iBAAa,EAACN,GAAG,EAAE,IAAAO,uBAAY,EAACJ,KAAK,CAAC,CAAC;MACvC,OAAO,CAACC,KAAK,EAAE,CAACA,KAAK,CAAC,CAAC;IACzB,CAAC;IACDI,WAAW,EAAGC,IAAS,IAAK;MAC1BA,IAAI,GAAG,IAAAF,uBAAY,EAACE,IAAI,CAAC;MACzBA,IAAI,CAACC,KAAK,EAAE;MACZ,OAAO,IAAAC,eAAI,EAACF,IAAI,CAAC;IACnB;EACF,CAAC,CAAQ;AACX;AAEAb,mBAAmB,EAAE;AAEd,SAASgB,MAAM,CAACC,MAAW,EAAE;EAClC,OAAO,IAAAP,iBAAa,EAACO,MAAM,EAAE,IAAAN,uBAAY,EAACO,4BAAU,CAAC,CAAC;AACxD"}