{"version":3,"names":["InstallCmd","constructor","install","workspace","logger","name","description","report","packages","options","startTime","Date","now","ConsumerNotFound","console","chalk","cyan","installOpts","variants","lifecycleType","addMissingPeers","type","dedupe","skipDedupe","import","skipImport","updateExisting","savePrefix","components","endTime","executionTime","calculateTime","toArray","length","toString","diff"],"sources":["install.cmd.tsx"],"sourcesContent":["import { Command, CommandOptions } from '@teambit/cli';\nimport { ConsumerNotFound } from '@teambit/legacy/dist/consumer/exceptions';\nimport { WorkspaceDependencyLifecycleType } from '@teambit/dependency-resolver';\nimport { Logger } from '@teambit/logger';\nimport chalk from 'chalk';\n\nimport { Workspace } from '@teambit/workspace';\nimport { InstallMain, WorkspaceInstallOptions } from './install.main.runtime';\n\ntype InstallCmdOptions = {\n  variants: string;\n  type: WorkspaceDependencyLifecycleType;\n  skipDedupe: boolean;\n  skipImport: boolean;\n  updateExisting: boolean;\n  savePrefix: string;\n  addMissingPeers: boolean;\n};\n\nexport default class InstallCmd implements Command {\n  name = 'install [packages...]';\n  description = 'installs workspace dependencies';\n  extendedDescription =\n    'when no package is specified, all workspace dependencies are installed and all workspace components are imported.';\n  arguments = [{ name: 'packages...', description: 'a list of packages to install (separated by spaces)' }];\n  alias = 'in';\n  group = 'development';\n  options = [\n    ['v', 'variants <variants>', 'add packages to specific variants'],\n    ['t', 'type [lifecycleType]', '\"runtime\" (default) or \"peer\" (dev is not a valid option)'],\n    ['u', 'update-existing [updateExisting]', 'update existing dependencies version and types'],\n    ['', 'save-prefix [savePrefix]', 'set the prefix to use when adding dependency to workspace.jsonc'],\n    ['', 'skip-dedupe [skipDedupe]', 'do not dedupe dependencies on installation'],\n    ['', 'skip-import [skipImport]', 'do not import bit objects post installation'],\n    ['', 'add-missing-peers [addMissingPeers]', 'install all missing peer dependencies'],\n  ] as CommandOptions;\n\n  constructor(\n    private install: InstallMain,\n    /**\n     * workspace extension.\n     */\n    private workspace: Workspace,\n\n    /**\n     * logger extension.\n     */\n    private logger: Logger\n  ) {}\n\n  async report([packages = []]: [string[]], options: InstallCmdOptions) {\n    const startTime = Date.now();\n    if (!this.workspace) throw new ConsumerNotFound();\n    this.logger.console(`Resolving component dependencies for workspace: '${chalk.cyan(this.workspace.name)}'`);\n    const installOpts: WorkspaceInstallOptions = {\n      variants: options.variants,\n      lifecycleType: options.addMissingPeers ? 'peer' : options.type,\n      dedupe: !options.skipDedupe,\n      import: !options.skipImport,\n      updateExisting: options.updateExisting,\n      savePrefix: options.savePrefix,\n      addMissingPeers: options.addMissingPeers,\n    };\n    const components = await this.install.install(packages, installOpts);\n    const endTime = Date.now();\n    const executionTime = calculateTime(startTime, endTime);\n    return `Successfully resolved dependencies for ${chalk.cyan(\n      components.toArray().length.toString()\n    )} component(s) in ${chalk.cyan(executionTime.toString())} seconds`;\n  }\n}\n\nfunction calculateTime(startTime: number, endTime: number) {\n  const diff = endTime - startTime;\n  return diff / 1000;\n}\n"],"mappings":";;;;;;;;;;;;;;;;AACA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAGA;EAAA;EAAA;IAAA;EAAA;EAAA;AAAA;AAee,MAAMA,UAAU,CAAoB;EAkBjDC,WAAW,CACDC,OAAoB;EAC5B;AACJ;AACA;EACYC,SAAoB;EAE5B;AACJ;AACA;EACYC,MAAc,EACtB;IAAA,KAVQF,OAAoB,GAApBA,OAAoB;IAAA,KAIpBC,SAAoB,GAApBA,SAAoB;IAAA,KAKpBC,MAAc,GAAdA,MAAc;IAAA,8CA3BjB,uBAAuB;IAAA,qDAChB,iCAAiC;IAAA,6DAE7C,mHAAmH;IAAA,mDACzG,CAAC;MAAEC,IAAI,EAAE,aAAa;MAAEC,WAAW,EAAE;IAAsD,CAAC,CAAC;IAAA,+CACjG,IAAI;IAAA,+CACJ,aAAa;IAAA,iDACX,CACR,CAAC,GAAG,EAAE,qBAAqB,EAAE,mCAAmC,CAAC,EACjE,CAAC,GAAG,EAAE,sBAAsB,EAAE,2DAA2D,CAAC,EAC1F,CAAC,GAAG,EAAE,kCAAkC,EAAE,gDAAgD,CAAC,EAC3F,CAAC,EAAE,EAAE,0BAA0B,EAAE,iEAAiE,CAAC,EACnG,CAAC,EAAE,EAAE,0BAA0B,EAAE,4CAA4C,CAAC,EAC9E,CAAC,EAAE,EAAE,0BAA0B,EAAE,6CAA6C,CAAC,EAC/E,CAAC,EAAE,EAAE,qCAAqC,EAAE,uCAAuC,CAAC,CACrF;EAaE;EAEH,MAAMC,MAAM,CAAC,CAACC,QAAQ,GAAG,EAAE,CAAa,EAAEC,OAA0B,EAAE;IACpE,MAAMC,SAAS,GAAGC,IAAI,CAACC,GAAG,EAAE;IAC5B,IAAI,CAAC,IAAI,CAACT,SAAS,EAAE,MAAM,KAAIU,8BAAgB,GAAE;IACjD,IAAI,CAACT,MAAM,CAACU,OAAO,CAAE,oDAAmDC,gBAAK,CAACC,IAAI,CAAC,IAAI,CAACb,SAAS,CAACE,IAAI,CAAE,GAAE,CAAC;IAC3G,MAAMY,WAAoC,GAAG;MAC3CC,QAAQ,EAAET,OAAO,CAACS,QAAQ;MAC1BC,aAAa,EAAEV,OAAO,CAACW,eAAe,GAAG,MAAM,GAAGX,OAAO,CAACY,IAAI;MAC9DC,MAAM,EAAE,CAACb,OAAO,CAACc,UAAU;MAC3BC,MAAM,EAAE,CAACf,OAAO,CAACgB,UAAU;MAC3BC,cAAc,EAAEjB,OAAO,CAACiB,cAAc;MACtCC,UAAU,EAAElB,OAAO,CAACkB,UAAU;MAC9BP,eAAe,EAAEX,OAAO,CAACW;IAC3B,CAAC;IACD,MAAMQ,UAAU,GAAG,MAAM,IAAI,CAAC1B,OAAO,CAACA,OAAO,CAACM,QAAQ,EAAES,WAAW,CAAC;IACpE,MAAMY,OAAO,GAAGlB,IAAI,CAACC,GAAG,EAAE;IAC1B,MAAMkB,aAAa,GAAGC,aAAa,CAACrB,SAAS,EAAEmB,OAAO,CAAC;IACvD,OAAQ,0CAAyCd,gBAAK,CAACC,IAAI,CACzDY,UAAU,CAACI,OAAO,EAAE,CAACC,MAAM,CAACC,QAAQ,EAAE,CACtC,oBAAmBnB,gBAAK,CAACC,IAAI,CAACc,aAAa,CAACI,QAAQ,EAAE,CAAE,UAAS;EACrE;AACF;AAAC;AAED,SAASH,aAAa,CAACrB,SAAiB,EAAEmB,OAAe,EAAE;EACzD,MAAMM,IAAI,GAAGN,OAAO,GAAGnB,SAAS;EAChC,OAAOyB,IAAI,GAAG,IAAI;AACpB"}