{"version":3,"names":["LinkCommand","constructor","install","workspace","logger","docsDomain","name","description","extendedDescription","report","ids","opts","startTime","Date","now","linkResults","json","endTime","numOfComponents","legacyLinkResults","length","timeDiff","timeFormat","coreAspectsLinksWithMainAspect","coreAspectsLinks","teambitBitLink","unshift","numOfCoreAspects","title","coreLinks","CoreAspectsLinks","verbose","compsLinks","ComponentListLinks","componentListLinks","rewireRow","RewireRow","legacyCodemodResults","legacyLinkCodemodResults","nestedLinks","NestedComponentLinksLinks","nestedDepsInNmLinks","targetLinks","linkToDir","linkToDirResults","footer","console","chalk","cyan","linkOpts","legacyLink","rewire","linkCoreAspects","linkTeambitBit","target","fetchObject","skipFetchingObjects","link"],"sources":["link.cmd.ts"],"sourcesContent":["import { Command, CommandOptions } from '@teambit/cli';\nimport { LinkResults } from '@teambit/dependency-resolver';\nimport { Logger } from '@teambit/logger';\nimport { timeFormat } from '@teambit/toolbox.time.time-format';\nimport chalk from 'chalk';\nimport { Workspace } from '@teambit/workspace';\nimport { InstallMain, WorkspaceLinkOptions } from '../install.main.runtime';\nimport { ComponentListLinks } from './component-list-links';\nimport { CoreAspectsLinks } from './core-aspects-links';\nimport { NestedComponentLinksLinks } from './nested-deps-in-nm-links';\nimport { RewireRow } from './rewire-row';\nimport { linkToDir } from './link-to-dir';\n\ntype LinkCommandOpts = {\n  rewire: boolean;\n  verbose: boolean;\n  target: string;\n  skipFetchingObjects?: boolean;\n};\nexport class LinkCommand implements Command {\n  name = 'link [component-names...]';\n  alias = '';\n  description = 'create links in the node_modules directory, to core aspects and to components in the workspace';\n  extendedDescription: string;\n  group = 'development';\n  private = false;\n  arguments = [{ name: 'component-names...', description: 'names or IDs of the components to link' }];\n  options = [\n    ['j', 'json', 'return the output as JSON'],\n    ['', 'verbose', 'verbose output'],\n    ['r', 'rewire', 'Replace relative paths with module paths in code (e.g. \"../foo\" => \"@bit/foo\")'],\n    [\n      '',\n      'target <dir>',\n      'EXPERIMENTAL. link to an external directory (similar to npm-link) so other projects could use these components',\n    ],\n    ['', 'skip-fetching-objects', 'skip fetch missing objects from remotes before linking'],\n  ] as CommandOptions;\n\n  constructor(\n    private install: InstallMain,\n    /**\n     * workspace extension.\n     */\n    private workspace: Workspace,\n\n    /**\n     * logger extension.\n     */\n    private logger: Logger,\n\n    private docsDomain: string\n  ) {\n    this.extendedDescription = `https://${this.docsDomain}/workspace/component-links`;\n  }\n\n  async report([ids]: [string[]], opts: LinkCommandOpts) {\n    const startTime = Date.now();\n    const linkResults = await this.json([ids], opts);\n    const endTime = Date.now();\n    const numOfComponents = linkResults.legacyLinkResults?.length;\n    const timeDiff = timeFormat(endTime - startTime);\n    const coreAspectsLinksWithMainAspect = linkResults.coreAspectsLinks || [];\n    if (linkResults.teambitBitLink) {\n      coreAspectsLinksWithMainAspect.unshift(linkResults.teambitBitLink);\n    }\n    const numOfCoreAspects = coreAspectsLinksWithMainAspect.length;\n\n    const title = `Linked ${numOfComponents} components and ${numOfCoreAspects} core aspects to node_modules for workspace: ${this.workspace.name}`;\n    const coreLinks = CoreAspectsLinks({\n      coreAspectsLinks: coreAspectsLinksWithMainAspect,\n      verbose: opts.verbose,\n    });\n    const compsLinks = ComponentListLinks({ componentListLinks: linkResults.legacyLinkResults, verbose: opts.verbose });\n    const rewireRow = RewireRow({ legacyCodemodResults: linkResults.legacyLinkCodemodResults });\n    const nestedLinks = NestedComponentLinksLinks({\n      nestedDepsInNmLinks: linkResults.nestedDepsInNmLinks,\n      verbose: opts.verbose,\n    });\n    const targetLinks = linkToDir(linkResults.linkToDirResults);\n    const footer = `Finished. ${timeDiff}`;\n    return `${title}\\n${coreLinks}\\n${compsLinks}\\n${rewireRow}${nestedLinks}${targetLinks}${footer}`;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  async json([ids]: [string[]], opts: LinkCommandOpts): Promise<LinkResults> {\n    this.logger.console(\n      `Linking components and core aspects to node_modules for workspaces: '${chalk.cyan(this.workspace.name)}'`\n    );\n\n    const linkOpts: WorkspaceLinkOptions = {\n      legacyLink: true,\n      rewire: opts.rewire,\n      linkCoreAspects: true,\n      linkTeambitBit: true,\n      linkToDir: opts.target,\n      fetchObject: !opts.skipFetchingObjects,\n    };\n    const linkResults = await this.install.link(linkOpts);\n    return linkResults;\n  }\n}\n"],"mappings":"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"}