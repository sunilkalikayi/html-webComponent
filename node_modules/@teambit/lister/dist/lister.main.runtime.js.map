{"version":3,"names":["ListerMain","constructor","logger","workspace","remoteList","scopeName","namespacesUsingWildcards","remote","getRemoteByName","consumer","setStatusLine","BEFORE_REMOTE_LIST","legacyListScopeResult","list","convertListScopeResultsFromLegacy","localList","showAll","showRemoteVersion","ConsumerNotFound","BEFORE_LOCAL_LIST","componentsList","ComponentsList","listAll","results","Promise","all","map","legacyResult","bitId","id","componentId","hasScope","resolveComponentId","ComponentID","fromLegacy","currentlyUsedVersion","remoteVersion","deprecated","laneReadmeOf","sort","a","b","toString","localeCompare","provider","cli","loggerMain","createLogger","ListerAspect","lister","register","ListCmd","CLIAspect","LoggerAspect","WorkspaceAspect","MainRuntime","addRuntime"],"sources":["lister.main.runtime.ts"],"sourcesContent":["import { CLIAspect, CLIMain, MainRuntime } from '@teambit/cli';\nimport { Logger, LoggerAspect, LoggerMain } from '@teambit/logger';\nimport WorkspaceAspect, { Workspace } from '@teambit/workspace';\nimport { BEFORE_LOCAL_LIST, BEFORE_REMOTE_LIST } from '@teambit/legacy/dist/cli/loader/loader-messages';\nimport { ComponentID } from '@teambit/component-id';\nimport { ConsumerNotFound } from '@teambit/legacy/dist/consumer/exceptions';\nimport { Remote } from '@teambit/legacy/dist/remotes';\nimport getRemoteByName from '@teambit/legacy/dist/remotes/get-remote-by-name';\nimport ComponentsList, {\n  ListScopeResult as ListScopeResultLegacy,\n} from '@teambit/legacy/dist/consumer/component/components-list';\nimport { ListCmd } from './list.cmd';\nimport { ListerAspect } from './lister.aspect';\n\nexport type ListScopeResult = {\n  id: ComponentID;\n  currentlyUsedVersion?: string | null | undefined;\n  remoteVersion?: string;\n  deprecated?: boolean;\n  laneReadmeOf?: string[];\n};\n\nexport class ListerMain {\n  constructor(private logger: Logger, private workspace?: Workspace) {}\n\n  async remoteList(scopeName: string, namespacesUsingWildcards?: string): Promise<ListScopeResult[]> {\n    const remote: Remote = await getRemoteByName(scopeName, this.workspace?.consumer);\n    this.logger.setStatusLine(BEFORE_REMOTE_LIST);\n    const legacyListScopeResult = await remote.list(namespacesUsingWildcards);\n    return this.convertListScopeResultsFromLegacy(legacyListScopeResult);\n  }\n\n  async localList(\n    showAll = false,\n    showRemoteVersion = false,\n    namespacesUsingWildcards?: string\n  ): Promise<ListScopeResult[]> {\n    if (!this.workspace) {\n      throw new ConsumerNotFound();\n    }\n    this.logger.setStatusLine(BEFORE_LOCAL_LIST);\n    const componentsList = new ComponentsList(this.workspace.consumer);\n    const legacyListScopeResult = await componentsList.listAll(showRemoteVersion, showAll, namespacesUsingWildcards);\n    return this.convertListScopeResultsFromLegacy(legacyListScopeResult);\n  }\n\n  private async convertListScopeResultsFromLegacy(\n    legacyListScopeResult: ListScopeResultLegacy[]\n  ): Promise<ListScopeResult[]> {\n    const results = await Promise.all(\n      legacyListScopeResult.map(async (legacyResult) => {\n        const bitId = legacyResult.id;\n        const componentId =\n          this.workspace && !bitId.hasScope()\n            ? await this.workspace.resolveComponentId(bitId)\n            : ComponentID.fromLegacy(bitId);\n        return {\n          id: componentId,\n          currentlyUsedVersion: legacyResult.currentlyUsedVersion,\n          remoteVersion: legacyResult.remoteVersion,\n          deprecated: legacyResult.deprecated,\n          laneReadmeOf: legacyResult.laneReadmeOf,\n        };\n      })\n    );\n    return results.sort((a, b) => a.id.toString().localeCompare(b.id.toString()));\n  }\n\n  static slots = [];\n  static dependencies = [CLIAspect, LoggerAspect, WorkspaceAspect];\n  static runtime = MainRuntime;\n  static async provider([cli, loggerMain, workspace]: [CLIMain, LoggerMain, Workspace]) {\n    const logger = loggerMain.createLogger(ListerAspect.id);\n    const lister = new ListerMain(logger, workspace);\n    cli.register(new ListCmd(lister));\n    return lister;\n  }\n}\n\nListerAspect.addRuntime(ListerMain);\n"],"mappings":"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"}