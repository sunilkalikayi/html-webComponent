{"version":3,"names":["Watch","constructor","stdin","stdout","config","_stdin","_stdout","_specFiles","specFiles","_onComplete","onComplete","findComponent","specFile","component","toArray","find","specs","paths","map","spec","path","includes","apply","jestHooks","onTestRunComplete","results","module","exports"],"sources":["watch.ts"],"sourcesContent":["import { Prompt, WatchPlugin, JestHookSubscriber, UsageData } from 'jest-watcher';\nimport { SpecFiles } from '@teambit/tester';\n\nexport type PluginConfig = {\n  onComplete: (testSuite: any) => void;\n  specFiles: SpecFiles;\n};\n\nclass Watch implements WatchPlugin {\n  _stdin: NodeJS.ReadStream;\n\n  _stdout: NodeJS.WriteStream;\n\n  _prompt: Prompt;\n\n  _testResults: any;\n\n  _usageInfo: UsageData;\n\n  _specFiles: SpecFiles;\n\n  _onComplete: (testSuite: any) => void;\n\n  constructor({\n    stdin,\n    stdout,\n    config,\n  }: {\n    stdin: NodeJS.ReadStream;\n    stdout: NodeJS.WriteStream;\n    config: PluginConfig;\n  }) {\n    this._stdin = stdin;\n    this._stdout = stdout;\n    this._specFiles = config.specFiles;\n    this._onComplete = config.onComplete;\n  }\n\n  private findComponent(specFile: string) {\n    const component = this._specFiles.toArray().find(([, specs]) => {\n      const paths = specs.map((spec) => spec.path);\n      if (paths.includes(specFile)) return true;\n      return false;\n    });\n    return component?.[0];\n  }\n\n  apply(jestHooks: JestHookSubscriber) {\n    // jestHooks.shouldRunTestSuite(async (testSuite) => {\n    //   const component = this.findComponent(testSuite.testPath);\n    //   if ((await component?.isModified()) || (await component?.isNew())) return true;\n    //   return false;\n    // });\n\n    jestHooks.onTestRunComplete((results) => {\n      this._onComplete(results);\n    });\n  }\n}\n\nmodule.exports = Watch;\n"],"mappings":";;;;;;;;;;;AAQA,MAAMA,KAAK,CAAwB;EAejCC,WAAW,CAAC;IACVC,KAAK;IACLC,MAAM;IACNC;EAKF,CAAC,EAAE;IAAA;IAAA;IAAA;IAAA;IAAA;IAAA;IAAA;IACD,IAAI,CAACC,MAAM,GAAGH,KAAK;IACnB,IAAI,CAACI,OAAO,GAAGH,MAAM;IACrB,IAAI,CAACI,UAAU,GAAGH,MAAM,CAACI,SAAS;IAClC,IAAI,CAACC,WAAW,GAAGL,MAAM,CAACM,UAAU;EACtC;EAEQC,aAAa,CAACC,QAAgB,EAAE;IACtC,MAAMC,SAAS,GAAG,IAAI,CAACN,UAAU,CAACO,OAAO,EAAE,CAACC,IAAI,CAAC,CAAC,GAAGC,KAAK,CAAC,KAAK;MAC9D,MAAMC,KAAK,GAAGD,KAAK,CAACE,GAAG,CAAEC,IAAI,IAAKA,IAAI,CAACC,IAAI,CAAC;MAC5C,IAAIH,KAAK,CAACI,QAAQ,CAACT,QAAQ,CAAC,EAAE,OAAO,IAAI;MACzC,OAAO,KAAK;IACd,CAAC,CAAC;IACF,OAAOC,SAAS,aAATA,SAAS,uBAATA,SAAS,CAAG,CAAC,CAAC;EACvB;EAEAS,KAAK,CAACC,SAA6B,EAAE;IACnC;IACA;IACA;IACA;IACA;;IAEAA,SAAS,CAACC,iBAAiB,CAAEC,OAAO,IAAK;MACvC,IAAI,CAAChB,WAAW,CAACgB,OAAO,CAAC;IAC3B,CAAC,CAAC;EACJ;AACF;AAEAC,MAAM,CAACC,OAAO,GAAG3B,KAAK"}